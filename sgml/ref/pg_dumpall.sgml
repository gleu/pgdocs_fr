<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/pg_dumpall.sgml,v 1.6 2005/03/14 06:03:53 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="APP-PG-DUMPALL">
 <refmeta>
  <refentrytitle id="APP-PG-DUMPALL-TITLE"><application>pg_dumpall</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_dumpall</refname>
  <refpurpose>extrait un groupe de bases de données
   <productname>PostgreSQL</productname> dans un fichier script
  </refpurpose>
 </refnamediv>

 <indexterm zone="app-pg-dumpall">
  <primary>pg_dumpall</primary>
 </indexterm>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_dumpall</command>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1 id="app-pg-dumpall-description">
  <title>Description</title>

  <para>
   <application>pg_dumpall</application> est un outil pour écrire
   (<quote>sauvegarder</quote>) toutes les bases de données
   <productname>PostgreSQL</> d'un groupe dans un fichier script. Celui-ci
   contient les commandes <acronym>SQL</acronym> pouvant être utilisées pour
   restaurer les bases de données avec <xref linkend="app-psql">. Il fait ceci
   en appelant <xref linkend="app-pgdump"> pour chaque base de données du
   groupe. <application>pg_dumpall</application> sauvegarde aussi les objets
   globaux, communs à toutes les bases de données.
   (<application>pg_dump</application> ne sauvegarde pas ces objets.) Cela
   inclut aussi les informations concernant les utilisateurs et groupes de la
   base de données ainsi que les droits d'accès s'appliquant aux bases de
   données.
  </para>

  <para>
   Du coup, <application>pg_dumpall</application> est une solution intégrée
   pour sauvegarder vos bases de données. Mais, notez une limitation&nbsp;: il
   ne peut pas sauvegarder les <quote>objets larges</quote>, car
   <application>pg_dump</application> ne peut pas sauvegarder de tels objets
   dans des fichiers texte. Si vous disposez de bases de données contenant des
   objets larges, elles devront être sauvegardées en utilisant un des modes de
   sorties non textuelles de <application>pg_dump</application>.
  </para>

  <para>
   Comme <application>pg_dumpall</application> lit les tables à partir de
   toutes les bases de données, vous vous connecterez plutôt en tant que
   superutilisateur d'une base de données pour avoir une sauvegarde complète. De
   plus, vous aurez besoin des droits superutilisateur pour produire une
   sauvegarde complète. Enfin, vous aurez besoin des droits superutilisateurs
   pour ajouter utilisateurs et groupes et pour créer des bases de données.
  </para>

  <para>
   Le script SQL écrira sur la sortie standard. Les opérateurs shell devront
   être utilisés pour la rediriger dans un fichier.
  </para>

  <para>
  <application>pg_dumpall</application> a besoin de se connecter plusieurs fois
   au serveur <productname>PostgreSQL</productname> (une fois par base de
   données). Si vous utilisez l'authentification par mot de passe, il pourrait
   avoir besoin de demander un mot de passe à chaque fois. Il est intéressant
   d'avoir un fichier <filename>~/.pgpass</> dans de tels cas. Voir <xref
   linkend="libpq-pgpass"> pour plus d'informations.
  </para>

 </refsect1>

 <refsect1>
  <title>Options</title>

   <para>
    Les options suivantes en ligne de commande contrôlent le contenu et le
    format de la sortie.

    <variablelist>
     <varlistentry>
      <term><option>-a</></term>
      <term><option>--data-only</></term>
      <listitem>
       <para>
	Sauvegarde seulement les données, pas le schéma (définition des
	données).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-c</option></term>
      <term><option>--clean</option></term>
      <listitem>
       <para>
	Inclut les commandes SQL pour nettoyer (supprimer) les bases de données
	avant de les recréer.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-d</option></term>
      <term><option>--inserts</option></term>
      <listitem>
       <para>
	Sauvegarde les données en tant que commandes <command>INSERT</command>
	(plutôt que des <command>COPY</command>). Ceci ralentira la
	restauration&nbsp;; c'est principalement utile pour créer des
	sauvegardes qui peuvent être chargées dans des bases de données autres
	que <productname>PostgreSQL</productname>. Notez que la restauration
	pourrait aussi échouer si vous avez modifié l'ordre des colonnes.
	L'option <option>-D</option> est plus sûre, bien que plus lente.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-D</option></term>
      <term><option>--column-inserts</option></term>
      <term><option>--attribute-inserts</option></term>
      <listitem>
       <para>
	Sauvegarde les données en tant que commandes <command>INSERT</command>
	avec les noms de colonnes explicites (<literal>INSERT INTO
	<replaceable>table</replaceable>
	(<replaceable>colonne</replaceable>, ...) VALUES
	...</literal>). Ceci ralentira la restauration&nbsp;; c'est
	principalement utile pour créer des sauvegardes qui peuvent être
	chargées dans des bases de données autres que
	<productname>PostgreSQL</productname>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-g</option></term>
      <term><option>--globals-only</option></term>
      <listitem>
       <para>
	Sauvegarde seulement les objets globaux (utilisateurs et groupes), pas
	les bases de données.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-i</></term>
      <term><option>--ignore-version</></term>
      <listitem>
       <para>
        Ignore la différence de version entre
        <application>pg_dumpall</application> et le serveur de bases de données.
       </para>

       <para>
        <application>pg_dumpall</application> peut gérer des bases de données à
	partir des versions précédentes de <productname>PostgreSQL</>, mais les
	très anciennes versions ne sont plus supportées (avant la 7.0). Utilisez
	cette option si vous avez besoin de surcharger la vérification de la
	version (et si <application>pg_dumpall</application> échoue, ne dites
	pas que vous n'avez pas été prévenu).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o</></term>
      <term><option>--oids</></term>
      <listitem>
       <para>
	Sauvegarde les identifieurs des objets (<acronym>OID</acronym>) comme
	faisant partie des données de chaque table. Utilisez cette option si
	votre application référence les colonnes d'une certaine façon (par
	exemple, dans une contrainte de clé étrangère). Sinon, cette option ne
	devrait pas être utilisée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-O</></term>
      <term><option>--no-owner</option></term>
      <listitem>
       <para>
        Ne donne pas les commandes pour configurer les propriétaires des objets
	correspondant à la base de données originale. Par défaut,
	<application>pg_dumpall</application> lance les instructions
	<command>ALTER OWNER</> ou <command>SET SESSION AUTHORIZATION</command>
	pour configurer le propriétaire des éléments créés. Ces instructions
	échoueront lorsque le script est lancé par un utilisateur ne disposant
	pas des droits des superutilisateurs (ou ne possédant pas les droits du
	propriétaire de tous les objets compris dans ce script). Pour que ce
	script puisse être restauré par n'importe quel utilisateur mais donne la
	propriété des objets à l'utilisateur l'exécutant, spécifiez
	<option>-O</>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <term><option>--schema-only</option></term>
      <listitem>
       <para>
	Sauvegarde seulement les définitions des objets (schéma), pas les
	données.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S <replaceable
	class="parameter">username</replaceable></option></term>
      <term><option>--superuser=<replaceable
	class="parameter">username</replaceable></option></term>
      <listitem>
       <para>
        Spécifie le nom du superutilisateur à utiliser lors de la désactivation
	des déclencheurs. Ceci est seulement pris en compte si
	<option>--disable-triggers</> est utilisé. (Habituellement, il est
	mieux de le laisser de côté et de lancer à la place le script résultant
	en tant que superutilisateur.)
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-v</></term>
      <term><option>--verbose</></term>
      <listitem>
       <para>
	Spécifie le mode verbeux. Ceci fait que
	<application>pg_dumpall</application> affiche les temps de
	démarrage/arrêt dans le fichier de sauvegarde et les messages de
	progression sur la sortie standard. Il activera aussi la sortie verbeuse
	dans <application>pg_dump</>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-x</></term>
      <term><option>--no-privileges</></term>
      <term><option>--no-acl</></term>
      <listitem>
       <para>
	Empêche la sauvegarde des droits d'accès (commandes grant/revoke).
       </para>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term><option>-X disable-dollar-quoting</></term>
      <term><option>--disable-dollar-quoting</></term>
      <listitem>
       <para>
        Cette option désactive l'utilisation du dollar comme guillemet pour 
	les corps des fonctions et le force à être entre guillemet en utilisant
	la syntaxe standard du SQL.
       </para>
     </listitem>
    </varlistentry>

     <varlistentry>
      <term><option>-X disable-triggers</></term>
      <term><option>--disable-triggers</></term>
      <listitem>
       <para>
        Cette option est utile uniquement lors de la création d'une sauvegarde
	des données seules. Elle indique à <application>pg_dumpall</application>
	d'inclure les commandes pour désactiver temporairement les déclencheurs
	sur les tables cibles alors que les données sont rechargées. Utilisez
	ceci si vous avez des vérifications d'intégrité incrémentale ou d'autres
	déclencheurs sur les tables que vous ne voulez pas appeler lors du
	rechargement des données.
       </para>

       <para>
        Actuellement, les commandes émises pour <option>--disable-triggers</>
	doivent être lançées en tant que superutilisateur. Donc, vous devriez
	aussi spécifier un nom de superutilisateur avec <option>-S</> ou, encore
	mieux, lancer le script résultant en tant que superutilisateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-X use-set-session-authorization</></term>
      <term><option>--use-set-session-authorization</></term>
      <listitem>
       <para>
        Affiche les commandes SET SESSION AUTHORIZATION du standard SQL à la
	place des commandes OWNER TO. Ceci rend la sauvegarde plus compatible
	avec les standards mais, suivant l'historique des objets dans la
	sauvegarde, pourrait ne pas être restauré proprement.
       </para>
      </listitem>
     </varlistentry>

    </variablelist>
   </para>

  <para>
   Les options suivantes en ligne de commande contrôlent les paramètres de
   connexion à la base de données.

   <variablelist>
     <varlistentry>
      <term>-h <replaceable>hôte</replaceable></term>
      <listitem>
       <para>
	Spécifie le nom de l'hôte de la machine où le serveur de bases de
	données est en cours d'exécution. Si la valeur commence avec un slash,
	elle est utilisée comme répertoire du socket de domaine Unix. La valeur
	par défaut est prise à partir de la variable d'environnement
	<envar>PGHOST</envar>, si elle est initialisée, sinon une connexion
	socket de domaine Unix est tentée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-p <replaceable>port</replaceable></term>
      <listitem>
       <para>
	Spécifie le port TCP ou l'extension du fichier socket de domaine Unix
	local où le serveur est en écoute des connexions. La valeur par défaut
	est la variable d'environnement <envar>PGPORT</envar>, si elle est
	initialisée, ou la valeur compilée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-U <replaceable>nomutilisateur</replaceable></term>
      <listitem>
       <para>
        Se connecter en tant que cet utilisateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-W</term>
      <listitem>
       <para>
        Force une demande de mot de passe. Ceci devrait arriver automatiquement
	si le serveur réclame une authentification par mot de passe.
       </para>
      </listitem>
     </varlistentry>
   </variablelist>
  </para>
 </refsect1>


 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Paramètres de connexion par défaut
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>


 <refsect1>
  <title>Notes</title>

  <para>
   Comme <application>pg_dumpall</application> appelle
   <application>pg_dump</application> en interne, certains messages de
   diagnostique se réfèrent en fait à <application>pg_dump</application>.
  </para>

  <para>
   Une fois restauré, il est conseillé de lancer <command>ANALYZE</> sur chaque
   base de données, de façon à ce que l'optimiseur dispose de statistiques
   utiles. Vous pouvez aussi lancer <command>vacuumdb -a -z</> pour analyser
   toutes les bases de données.
  </para>

 </refsect1>


 <refsect1 id="app-pg-dumpall-ex">
  <title>Exemples</title>
  <para>
   Pour sauvegarder toutes les bases de données&nbsp;:

<screen>
<prompt>$</prompt> <userinput>pg_dumpall &gt; db.out</userinput>
</screen>
  </para>

  <para>
   Pour recharger cette base de données, utilisez par exemple&nbsp;:
<screen>
<prompt>$</prompt> <userinput>psql -f db.out template1</userinput>
</screen>
   (La base de données à laquelle vous vous connectez n'a pas d'importance ici
   car le fichier de script créé par <application>pg_dumpall</application>
   contiendra les commandes appropriées pour se créer et se connecter aux bases
   de données sauvegardées.)
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <para>
    <xref linkend="app-pgdump">. Vérifiez ici les détails sur les conditions
    d'erreurs possibles.
  </para>
 </refsect1>   

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
