<!--
$PostgreSQL: pgsql/doc/src/sgml/ref/rollback_to.sgml,v 1.5.4.1 2005/01/26 23:20:36 tgl Exp $
PostgreSQL documentation
-->

<refentry id="SQL-ROLLBACK-TO">
 <refmeta>
  <refentrytitle id="SQL-ROLLBACK-TO-TITLE">ROLLBACK TO SAVEPOINT</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>ROLLBACK TO SAVEPOINT</refname>
  <refpurpose>annule jusqu'à un point de sauvegarde</refpurpose>
 </refnamediv>

 <indexterm zone="sql-rollback-to">
  <primary>ROLLBACK TO SAVEPOINT</primary>
 </indexterm>

 <indexterm zone="sql-rollback-to">
  <primary>point de sauvegarde</primary>
  <secondary>annulation</secondary>
 </indexterm>

 <refsynopsisdiv>
<synopsis>
ROLLBACK [ WORK | TRANSACTION ] TO [ SAVEPOINT ] <replaceable>nom_pointsauvegarde</replaceable>
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>

  <para>
   Annule toutes les commandes qui ont été exécutées après l'établissement du
   point de sauvegarde. Le point de sauvegarde reste valide et peut être annulé
   de nouveau plus tard si nécessaire.
  </para>

  <para>
   <command>ROLLBACK TO SAVEPOINT</> détruit implicitement tous les points de
   sauvegarde qui ont été établis après le point de sauvegarde indiqué.
  </para>
 </refsect1>

 <refsect1>
  <title>Paramètres</title>

  <variablelist>
   <varlistentry>
    <term><replaceable class="PARAMETER">nom_pointsauvegarde</></term>
    <listitem>
     <para>
      Le point de sauvegarde où retourner.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Utilisez <xref linkend="SQL-RELEASE-SAVEPOINT"
   endterm="SQL-RELEASE-SAVEPOINT-TITLE"> pour détruire un point de sauvegarde
   sans annuler les effets de commandes exécutées après son établissement.
  </para>

  <para>
   Spécifier un nom de point de sauvegarde inexistant est une erreur.
  </para>

  <para>
   Les curseurs ont un comportement quelque peu non transactionnels en ce qui
   concerne les points de sauvegarde. Tout curseur ouvert à l'intérieur d'un
   point de sauvegarde sera fermé lorsque le point de sauvegarde est annulé. Si
   un curseur ouvert précédemment est affecté à une commande <command>FETCH</>
   à l'intérieur d'un point de sauvegarde annulé un peu plus tard, la position
   du curseur reste à la position que <command>FETCH</> lui a donné (c'est-à-dire
   que <command>FETCH</> n'est pas annulé). Fermer un curseur n'est pas défait
   par une annulation. Un curseur dont l'exécution impose l'annulation d'une
   transaction est placé dans un état non exécutable pour que, tant que la
   transaction n'est pas restaurée avec <command>ROLLBACK TO SAVEPOINT</>, le
   curseur ne soit plus utilisé.
  </para>
 </refsect1>

 <refsect1>
  <title>Exemples</title>

  <para>
   Pour annuler les effets des commandes exécutées après l'établissement de
   <literal>mon_pointsauvegarde</literal>&nbsp;:
<programlisting>
ROLLBACK TO SAVEPOINT mon_pointsauvegarde;
</programlisting>
  </para>

  <para>
   Les positions du curseur ne sont pas affectées par l'annulation des points
   de sauvegarde&nbsp;:
<programlisting>
BEGIN;

DECLARE foo CURSOR FOR SELECT 1 UNION SELECT 2;

SAVEPOINT foo;

FETCH 1 FROM foo;
 ?column? 
----------
        1

ROLLBACK TO SAVEPOINT foo;

FETCH 1 FROM foo;
 ?column? 
----------
        2

COMMIT;
</programlisting>
   </para>


 </refsect1>

 <refsect1>
  <title>Compatibilité</title>

  <para>
   Le standard SQL:2003 spécifie que le mot clé
   <literal>SAVEPOINT</> est obligatoire mais <productname>PostgreSQL</>
   et <productname>Oracle</> autorisent son omission. SQL:2003 autorise
   seulement <literal>WORK</>, pas <literal>TRANSACTION</>, comme mot après
   <literal>ROLLBACK</>. De plus, SQL:2003 dispose d'une clause optionnelle
   <literal>AND [ NO ] CHAIN</> qui n'est actuellement pas supportée par
   <productname>PostgreSQL</>. Sinon, cette commande est conforme au standard
   SQL.
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="sql-begin" endterm="sql-begin-title"></member>
   <member><xref linkend="sql-commit" endterm="sql-commit-title"></member>
   <member><xref linkend="sql-release-savepoint" endterm="sql-release-savepoint-title"></member>
   <member><xref linkend="sql-rollback" endterm="sql-rollback-title"></member>
   <member><xref linkend="sql-savepoint" endterm="sql-savepoint-title"></member>
  </simplelist>
 </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
