<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/postgres-ref.sgml,v 1.5.2.1 2005/03/14 06:03:03 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="APP-POSTGRES">
 <refmeta>
  <refentrytitle id="APP-POSTGRES-TITLE"><application>postgres</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>postgres</refname>
  <refpurpose>lance un serveur <productname>PostgreSQL</productname> dans un
  mode simple utilisateur</refpurpose>
 </refnamediv>

 <indexterm zone="app-postgres">
  <primary>postgres (le programme)</primary>
 </indexterm>

 <refsynopsisdiv>
  <cmdsynopsis>
   <!-- standalone call -->
   <command>postgres</command>
   <arg>-A <group choice="plain"><arg>0</arg><arg>1</arg></group></arg>
   <arg>-B <replaceable>nombre_de_tampons</replaceable></arg>
   <arg>-c
<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></arg>
   <arg>-d <replaceable>niveau-débogage</replaceable></arg>
   <arg>--describe-config</arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-e</arg>
   <arg>-E</arg>
   <arg>-f<group
choice="plain"><arg>s</arg><arg>i</arg><arg>t</arg><arg>n</arg><arg>m</arg><arg>
h</arg></group></arg>
   <arg>-F</arg>
   <arg>-N</arg>
   <arg>-o <replaceable>nom_fichier</replaceable></arg>
   <arg>-O</arg>
   <arg>-P</arg>
   <group>
    <arg>-s</arg>
    <arg>-t<group
choice="plain"><arg>pa</arg><arg>pl</arg><arg>ex</arg></group></arg>
   </group>
   <arg>-S <replaceable>sort-mem</replaceable></arg>
   <arg>-W <replaceable>secondes</replaceable></arg>
   <arg>--<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></arg>
   <arg choice="plain"><replaceable>base_de_données</replaceable></arg>
   <sbr>
   <!-- postmaster fork -->
   <command>postgres</command>
   <arg>-A <group choice="plain"><arg>0</arg><arg>1</arg></group></arg>
   <arg>-B <replaceable>nombre_de_tampons</replaceable></arg>
   <arg>-c
<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></arg>
   <arg>-d <replaceable>niveau-débogage</replaceable></arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-e</arg>
   <arg>-f<group choice="plain"><arg>s</arg><arg>i</arg><arg>t</arg><arg>n</arg><arg>m</arg><arg>h</arg></group></arg>
   <arg>-F</arg>
   <arg>-o <replaceable>nom_fichier</replaceable></arg>
   <arg>-O</arg>
   <arg>-p <replaceable>base_de_données</replaceable></arg>
   <arg>-P</arg>
   <group>
    <arg>-s</arg>
    <arg>-t<group choice="plain"><arg>pa</arg><arg>pl</arg><arg>ex</arg></group></arg>
   </group>
   <arg>-S <replaceable>sort-mem</replaceable></arg>
   <arg>-v <replaceable>protocole</replaceable></arg>
   <arg>-W <replaceable>secondes</replaceable></arg>
   <arg>--<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>

  <para>
   L'exécutable <command>postgres</command> est le processus serveur
   réel <productname>PostgreSQL</productname> qui traite les requêtes. Il n'est
   pas normalement appelé directement&nbsp;; à la place, un serveur
   multi-utilisateurs <xref linkend="app-postmaster"> est lancé.
  </para>

  <para>
   La deuxième forme ci-dessus est la façon dont <command>postgres</command> est
   appelé par <xref linkend="app-postmaster"> (seulement conceptuellement, car
   <filename>postmaster</filename> et <filename>postgres</filename> sont en fait
   le même programme)&nbsp;; il ne devrait pas être appelé directement de cette
   façon. La première forme appelle le serveur directement dans un mode
   interactif simple utilisateur. La principale utilisation pour ce mode est le
   morceau du démarrage par <xref linkend="app-initdb">. Quelque fois, il est
   utilisé pour le débogage ou la récupération du disastre.
  </para>

  <para>
   Lorsqu'il est appelé en mode interactif à partir du shell, l'utilisateur
   peut entrer les requêtes et les résultats seront affichés à l'écran mais dans
   une forme qui est plus utile pour les développeurs que pour les
   utilisateurs. Mais notez que lancer un serveur en simple utilisateur n'est
   pas vraiment convenable pour le débogage du serveur car il n'y a pas de
   communications interprocessus réalistes et qu'aucun verrou n'aura lieu.
  </para>

  <para>
   Lors de l'utilisation d'un serveur en mono utilisateur, l'utilisateur de la 
   session sera initialisé avec l'ID 1. Cet utilisateur n'a pas besoin
   d'exister, de façon à ce qu'un serveur en mode mono utilisateur puisse être
   utilisé pour récupérer manuellement à partir de certains types de dommages
   accidentels pour les catalogues systèmes. Les pouvoirs implicites du
   super-utilisateur sont donnés à l'utilisateur d'ID 1 dans le mode
   mono-utilisateur.
  </para>
 </refsect1>

 <refsect1>
  <title>Options</title>

   <para>
    Quand <command>postgres</command> est lancé par un <xref
    linkend="app-postmaster">, alors il hérite de toutes les options
    initialisées par ce dernier. En plus, les options spécifiques par
    <command>postgres</command> peuvent être passées de
    <command>postmaster</command> avec l'option <option>-o</option>.
   </para>

   <para>
    Vous pouvez éviter d'avoir à saisir ces options en initialisant un fichier
    de configuration. Voir <xref linkend="runtime-config"> pour plus de détails.
    Quelques options (sûres) peuvent aussi être initialisées à partir du client 
    se connectant d'une façon dépendante de l'application. Par exemple, si la
    variable d'environnement <envar>PGOPTIONS</envar> est initialisée, alors les
    clients basés sur <application>libpq</> passeront cette chaîne au serveur,
    qui l'interprèteront comme des options en ligne de commande
    <command>postgres</command>.
   </para>

   <refsect2>
    <title>But général</title>

    <para>
     Les options <option>-A</option>, <option>-B</option>,
     <option>-c</option>, <option>-d</option>, <option>-D</option>,
     <option>-F</option> et <option>--<replaceable>name</></option> ont les
     mêmes significations que <xref linkend="app-postmaster"> sauf que
     <literal>-d 0</> empêche le niveau de traces du serveur du
     <command>postmaster</> d'être propagé à <command>postgres</>.
    </para>

    <variablelist>
     <varlistentry>
      <term><option>-e</option></term>
      <listitem>
       <para>
        Initialise le style de date par défaut à <quote>European</quote>,
	c'est-à-dire l'ordre <literal>DMY</> des champs de date d'entrée. Ceci
	fait aussi que le jour est affiché avant le mois dans certains formats
	de sortie des dates. Voir <xref linkend="datatype-datetime"> pour plus
	d'informations.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o</option> <replaceable
	class="parameter">nom_fichier</replaceable></term>
      <listitem>
       <para>
        Envoie toutes les traces du serveur dans <replaceable
	class="parameter">nom_fichier</replaceable>. Si
	<command>postgres</command> est exécuté sous
	<command>postmaster</command>, cette option est ignorée et la sortie
	standard des erreurs, <systemitem>stderr</>, héritée de
	<command>postmaster</command> est utilisée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-P</option></term>
      <listitem>
       <para>
	Ignore les index système lors de la lecture des tables systèmes (mais
	met toujours à jour les index lors de la modification des tables). Ceci
	est utile lors de la récupération des index systèmes endommagés.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <listitem>
       <para>
	Affiche l'information de l'heure et les autres statistiques à la fin de
	chaque commande. C'est utile pour connaître les performances ou pour
	faire une utilisation d'une configuration fine du nombre de tampons.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S</option> <replaceable class="parameter">sort-mem</replaceable></term>
      <listitem>
       <para>
	Spécifie les tailles mémoire à utiliser par les tris internes et les
	hachages avant le tri des fichiers temporaires du disque. La valeur est
	spécifiée en Ko et vaut par défaut 1024. Notez que, pour une requête
	complexe, plusieurs tris et/ou hachages pourraient être lancés en
	parallèle et chacune sera autorisée à utiliser au plus <replaceable
	class="parameter">sort-mem</replaceable>&nbsp;Ko avant qu'il commence à
	placer des données dans des fichiers temporaires.
       </para>
      </listitem>
     </varlistentry>

    </variablelist>
   </refsect2>

   <refsect2>
    <title>Options pour le mode autonome</title>

    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">base_de_données</replaceable></term>
      <listitem>
       <para>
	Spécifie le nom de la base de données à accéder. S'il est omis, il
	prend comme valeur par défaut le nom de l'utilisateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-E</option></term>
      <listitem>
       <para>
	Affiche toutes les commandes.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-N</option></term>
      <listitem>
       <para>
	Désactive l'utilisation des retours chariot comme délimiteur d'une
	instruction.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </refsect2>

   <refsect2>
    <title>Options semi-internes</title>

    <para>
     Il existe plusieurs autres options qui pourraient être spécifiées,
     utilisées principalement dans des buts de débogage. Elles sont listées ici
     pour être utilisées par les développeurs du système
     <productname>PostgreSQL</productname>. <emphasis>Utiliser une de ces
     options est hautement découragé.</emphasis> De plus, une de ces options
     pourrait disparaître ou changer dans une version future sans prévenir.
   </para>
    <variablelist>

     <varlistentry>
      <term><option>-f</option> <literal>{ s | i | m | n | h }</literal></term>
      <listitem>
       <para>
	Interdit l'utilisation de méthodes de parcours et de jointure
	particulières&nbsp;: <literal>s</literal> et <literal>i</literal>
	désactivent respectivement les parcours séquentiels et d'index alors que
	<literal>n</literal>, <literal>m</literal> et <literal>h</literal>
	désactivent respectivement les jointures à boucles imbriquées, les
	jointures d'assemblage et de découpage.
       </para>
	
	<note>
	 <para>
	  Ni les parcours séquentiels ni les jointures de boucles imbriquées
	  peuvent être complètement désactivés&nbsp;; les options
	  <literal>-fs</literal> et <literal>-fn</literal> découragent
	  simplement l'optimiseur d'utiliser ces types de plan s'il n'y a pas
	  d'autres alternatives.
	 </para>
	</note>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-O</option></term>
      <listitem>
       <para>
	Permet la modification de la structure des tables système. Ceci est
	utilisé par <command>initdb</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-p</option> <replaceable
	class="parameter">base_de_données</replaceable></term>
      <listitem>
       <para>
	Indique que ce processus a été lancé par un
	<command>postmaster</command> et spécifie la base de données à utiliser,
	etc.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-t</option> <literal>pa[rser] | pl[anner] | e[xecutor]</literal></term>
      <listitem>
       <para>
	Affiche les statistiques temporelles pour chaque requête en relation
	avec chacun des modules système majeurs. Cette option ne peut pas être
	utilisée avec l'option <option>-s</option>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-v</option> <replaceable
	class="parameter">protocole</replaceable></term>
      <listitem>
       <para>
	Spécifie le numéro de version du protocole client/serveur à utiliser
	pour cette session particulière.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-W</option> <replaceable
	class="parameter">secondes</replaceable></term>
      <listitem>
       <para>
	Dès que cette option est rencontrée, le processus dort pendant le temps
	spécifié ici en secondes. Ceci donne aux développeurs le temps
	d'attacher un débogueur sur le processus serveur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--describe-config</option></term>
      <listitem>
       <para>
        Cette option sauvegarde les variables internes de configuration du
	serveur ainsi que les descriptions et a comme valeur par défaut le
	format <command>COPY</> délimité par des tabulations. Elle est conçue
	principalement pour être utilisé par des outils d'administration.
       </para>
      </listitem>
     </varlistentry>

    </variablelist>
   </refsect2>
 </refsect1>

 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGDATA</envar></term>

    <listitem>
     <para>
      Emplacement du répertoire de données par défaut.
     </para>
    </listitem>
   </varlistentry>

  </variablelist>

  <para>
   Pour les autres, qui ont peu d'influence lors d'un mode mono utilisateur,
   voir <xref linkend="app-postmaster">.
  </para>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Pour annuler une requête en cours d'exécution, envoyez le signal
   <literal>SIGINT</literal> au processus <command>postgres</command> exécutant
   cette commande.
  </para>

  <para>
   Pour indiquer à <command>postgres</command> de recharger les fichiers de
   configuration, envoyez un signal <literal>SIGHUP</literal>. Normalement, il
   est mieux de lancer <literal>SIGHUP</literal> à
   <command>postmaster</command>&nbsp;; le <command>postmaster</command> lancera
   à son tour <literal>SIGHUP</literal> à chacun de ces enfants. Mais dans
   certains cas, il pourrait être désirable d'avoir seulement un processus
   <command>postgres</command> pour recharger les fichiers de configuration.
  </para>

  <para>
   Le <command>postmaster</command> utilise <literal>SIGTERM</literal> pour
   indiquer qu'un processus <command>postgres</command> quitte normalement et
   qu'un <literal>SIGQUIT</literal> termine sans le nettoyage normal. Ces
   signaux <emphasis>ne devraient pas</emphasis> être utilisés par les
   utilisateurs. Il est aussi déconseillé d'envoyer <literal>SIGKILL</literal> à
   un processus <command>postgres</command> --- le <command>postmaster</command>
   interprètera ceci comme un arrêt brutal dans <command>postgres</command> et
   forcera tous les processus <command>postgres</command> à quitter en faisant
   part de sa procédure standard de récupération de panne.
  </para>

 </refsect1>

 <refsect1>
  <title>Usage</title>

   <para>
    Lance un serveur en mode autonome avec une commande
<screen>
<userinput>postgres -D /usr/local/pgsql/data <replaceable>other-options</> my_database</userinput>
</screen>
    Fournit le chemin correct au répertoire de la base de données avec
    <option>-D</> ou en s'assurant que la variable d'environnement
    <envar>PGDATA</> est configurée. Spécifiez aussi le nom de la base de
    données particulière avec laquelle vous souhaitez travailler.
   </para>

   <para>
    Normalement, le serveur en mode mono utilisateur traite les retours chariot
    comme le terminateur d'entrée de commande&nbsp;; il n'y a pas de
    compréhension des points virgules comme c'est le cas dans
    <application>psql</>. Pour continuer une commande sur plusieurs lignes, vous
    devez tapez un antislash avant chaque nouvelle ligne sauf la dernière.
   </para>

   <para>
    Mais si vous utilisez l'option <option>-N</> en ligne de commande, alors un
    retour chariot ne termine pas l'entrée de la commande. Dans ce cas, le
    serveur lira l'entrée standard jusqu'au marqueur de fin de fichier
    (<acronym>EOF</>), alors il traite l'entrée comme une seule chaîne de
    commande. Les retours chariots avec antislash ne sont pas traités de façon
    spéciale dans ce cas.
   </para>

   <para>
    Pour quitter la session, tapez <acronym>EOF</acronym> (habituellement,
    <keycombo action="simul"><keycap>Control</><keycap>D</></>). Si vous avez
    utilisé <option>-N</>, deux <acronym>EOF</> consécutifs sont nécessaires
    pour quitter.
   </para>

   <para>
    Notez que le serveur en mode autonome ne fournit pas de fonctions avancées
    d'édition de ligne (pas d'historique de commandes, par exemple).
   </para>

 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <para>
   <xref linkend="app-initdb">,
   <xref linkend="app-ipcclean">,
   <xref linkend="app-postmaster">
  </para>
 </refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
