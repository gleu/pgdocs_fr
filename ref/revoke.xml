<?xml version="1.0" encoding="UTF-8"?>
<!-- Dernière modification
     le       $Date$
     par      $Author$
     révision $Revision$ -->

<refentry id="sql-revoke">
 <refmeta>
  <refentrytitle id="sql-revoke-title">REVOKE</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage </refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>REVOKE</refname>
  <refpurpose>supprime les droits d'accès</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<synopsis>REVOKE [ GRANT OPTION FOR ]
    { { SELECT | INSERT | UPDATE | DELETE | REFERENCES | TRIGGER }
    [,...] | ALL [ PRIVILEGES ] }
    ON [ TABLE ] <replaceable class="parameter">nom_table</replaceable> [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ GRANT OPTION FOR ]
    { { USAGE | SELECT | UPDATE }
    [,...] | ALL [ PRIVILEGES ] }
    ON SEQUENCE <replaceable class="parameter">nom_séquence</replaceable> [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ GRANT OPTION FOR ]
    { { CREATE | CONNECT | TEMPORARY | TEMP } [,...] | ALL [ PRIVILEGES ] }
    ON DATABASE <replaceable>nom_base</replaceable> [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ GRANT OPTION FOR ]
    { EXECUTE | ALL [ PRIVILEGES ] }
    ON FUNCTION <replaceable>nomfonction</replaceable> ( [ [ <replaceable class="parameter">modearg</replaceable> ] [ <replaceable class="parameter">nomarg</replaceable> ] <replaceable class="parameter">typearg</replaceable> [, ...] ] ) [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ GRANT OPTION FOR ]
    { USAGE | ALL [ PRIVILEGES ] }
    ON LANGUAGE <replaceable>nom_langage</replaceable> [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ GRANT OPTION FOR ]
    { { CREATE | USAGE } [,...] | ALL [ PRIVILEGES ] }
    ON SCHEMA <replaceable>nom_schéma</replaceable> [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ GRANT OPTION FOR ]
    { CREATE | ALL [ PRIVILEGES ] }
    ON TABLESPACE <replaceable>nom_espacelogique</replaceable> [, ...]
    FROM { [ GROUP ] <replaceable class="PARAMETER">nom_role</replaceable> | PUBLIC } [, ...]
    [ CASCADE | RESTRICT ]

REVOKE [ ADMIN OPTION FOR ]
    <replaceable class="PARAMETER">role</replaceable> [, ...] FROM <replaceable class="PARAMETER">nom_role</replaceable> [, ...]
    [ CASCADE | RESTRICT ]
</synopsis>
 </refsynopsisdiv>

 <refsect1 id="sql-revoke-description">
  <title>Description</title>
  <indexterm zone="sql-revoke">
   <primary>REVOKE</primary>
  </indexterm>


  <para>
   La commande <command>REVOKE</command> retire des droits précédemment
   attribués à un ou plusieurs rôles.
   Le mot clé <literal>PUBLIC</literal> fait référence au groupe implicitement
   défini de tous les rôles.
  </para>

  <para>
   Voir la description de la commande <xref linkend="sql-grant"
   endterm="sql-grant-title"/> pour connaître la signification des types de
   droits.
  </para>

  <para>
   Notez qu'un rôle possède la somme des droits qui lui ont été donnés
   directement, des droits qui ont été donnés à un rôle dont il est membre
   et des droits donnés à <literal>PUBLIC</literal>.
   Du coup, par exemple, retirer les droits de <literal>SELECT</literal> à 
   <literal>PUBLIC</literal> ne veut pas nécessairement dire que plus aucun rôle
   n'a le droit de faire de <literal>SELECT</literal> sur l'objet&nbsp;: ceux qui en
   avaient obtenu le droit directement ou via un autre rôle l'ont toujours.
  </para>

  <para>
   Si <literal>GRANT OPTION FOR</literal> est précisé, seul l'option
   de transmission de droit (grant option) est supprimée, pas le
   droit lui même. Sinon, le droit et l'option de transmission de droits sont
   révoqués.
  </para>

  <para>
   Si un utilisateur détient un privilège avec le droit de le transmettre,
   et qu'il l'a transmis à d'autres utilisateurs, alors les droits de 
   ceux-ci sont appelés des droits dépendants.
   Si les droits ou le droit de transmettre du premier utilisateur sont
   supprimés, et que des droits dépendants existent, alors ces droits 
   dépendants sont aussi supprimés si l'option <literal>CASCADE</literal>
   est utilisée. Dans le cas contraire, la suppression de droits est refusée.
   Cette révocation récursive n'affecte que les droits qui avaient
   été attribués à travers une chaîne d'utilisateurs traçable jusqu'à 
   l'utilisateur qui subit la commande <literal>REVOKE</literal>.
   Du coup, les utilisateurs affectés peuvent finalement garder le droit s'il 
   avait aussi été attribué via d'autres utilisateurs.
  </para>

  <para>
   Lors de la révocation de l'appartenance d'un rôle, <literal>GRANT OPTION</literal>
   est appelé <literal>ADMIN OPTION</literal> mais le comportement est similaire.
   Notez aussi que cette forme de la commande ne permet pas le mot <literal>GROUP</literal>.
  </para>
 </refsect1>

 <refsect1 id="sql-revoke-notes">
  <title>Notes</title>

  <para>
   Utilisez la commande <command>\z</command> de <xref linkend="app-psql"/>
   pour afficher les droits donnés sur des objets existants.
   Voir <xref linkend="sql-grant" endterm="sql-grant-title"/>
   pour des informations sur le format.
  </para>

  <para>
   Un utilisateur ne peut révoquer que les droits qu'il a donnés
   directement. Si, par exemple, un utilisateur A a donné un droit
   et la possibilité de le transmettre à un utilisateur B, et que
   B à son tour l'a donné à C, alors A ne peut pas retirer directement
   le droit de C. À la place, il peut supprimer le droit de transmettre à B et
   utiliser l'option <literal>CASCADE</literal> pour que le droit soit 
   automatiquement supprimé à C. Autre exemple, si A et B ont donné le même
   droit à C, A peut révoquer son propre don de droit mais pas celui de B, donc
   C dispose toujours de ce droit.
  </para>

   <para>
    Lorsqu'un utilisateur, non propriétaire de l'objet, essaie de révoquer
    (<command>REVOKE</command>) des droits sur l'objet, la commande échoue si
    l'utilisateur n'a aucun droit sur l'objet. Tant que certains droits sont
    disponibles, la commande s'exécute mais ne sont supprimés que les
    droits dont l'utilisateur a l'option de transmission. La forme
    <command>REVOKE ALL PRIVILEGES</command> affiche un message d'avertissement si
    les options de transmissions pour un des droits nommés spécifiquement dans
    la commande ne sont pas possédés. (En principe, ces instructions
    s'appliquent aussi au propriétaire de l'objet mais comme le propriétaire est
    toujours traité comme celui détenant toutes les options de transmission, ces
    cas n'arrivent jamais.)
   </para>

   <para>
    Si un superutilisateur choisit d'exécuter une commande <command>GRANT</command> 
    ou <command>REVOKE</command>, la commande est exécutée comme si elle était
    lancée par le propriétaire de l'objet affecté.
    Comme tous les droits proviennent du propriétaire d'un objet (directement
    ou via une chaîne de transmissions de droits), un superutilisateur
    peut supprimer tous les droits sur un objet mais cela peut nécessiter
    l'utilisation de <literal>CASCADE</literal> comme expliqué précédemment.
   </para>

   <para>
    <command>REVOKE</command> peut aussi être effectué par un rôle qui n'est pas le
    propriétaire de l'objet affecté mais qui est un membre du rôle qui possède
    l'objet ou qui est un membre d'un rôle qui détient les droits
    <literal>WITH GRANT OPTION</literal> sur cet objet. Dans ce cas, la commande
    est exécutée comme si elle avait été exécutée par le rôle qui possède
    réellement l'objet ou détient les droits <literal>WITH GRANT
    OPTION</literal>. Par exemple, si la table <literal>t1</literal> est possédée par
    le rôle <literal>g1</literal>, dont le rôle <literal>u1</literal> est membre, alors
    <literal>u1</literal> peut supprimer des droits sur <literal>t1</literal> qui sont
    enregistrés comme donnés par <literal>g1</literal>. Ceci incluera les dons de
    droits effectués par <literal>u1</literal> ainsi que ceux effectués par les
    autres membres du rôle <literal>g1</literal>.
   </para>

   <para>
    Si le rôle exécutant <command>REVOKE</command> détient les droits indirectement
    via plus d'un chemin d'appartenance, le rôle indiqué comme ayant effectué
    la commande est non déterminable à l'avance. Dans de tels cas, il est
    préférable d'utiliser <command>SET ROLE</command> pour devenir le rôle que vous
    souhaitez voir exécuter la commande <command>REVOKE</command>. Ne pas faire cela
    peut avoir comme résultat de supprimer des droits autres que ceux que vous
    vouliez, voire même de ne rien supprimer du tout.
   </para>
 </refsect1>

 <refsect1 id="sql-revoke-examples">
  <title>Exemples</title>

  <para>
   Enlève au groupe public le droit d'insérer des lignes dans la table
   <literal>films</literal>&nbsp;:

<programlisting>REVOKE INSERT ON films FROM PUBLIC;
</programlisting>
  </para>

  <para>
   Supprime tous les droits de l'utilisateur <literal>manuel</literal> sur la
   vue <literal>genres</literal>&nbsp;:

<programlisting>REVOKE ALL PRIVILEGES ON genres FROM manuel;
</programlisting>

   Notez que ceci signifie en fait <quote>révoque tous les droits que j'ai
   donné</quote>.
  </para>

  <para>
   Supprime l'appartenance de l'utilisateur <literal>joe</literal> au rôle
   <literal>admins</literal>&nbsp;:

<programlisting>REVOKE admins FROM joe;
</programlisting>
  </para>
 </refsect1>

 <refsect1 id="sql-revoke-compatibility">
  <title>Compatibilité</title>

   <para>
    La note de compatibilité de la commande <xref linkend="sql-grant"
    endterm="sql-grant-title"/> s'applique par analogie à 
    <command>REVOKE</command>. Les mots clés <literal>RESTRICT</literal>
    ou <literal>CASCADE</literal> sont requis d'après le standard, mais 
    <productname>PostgreSQL</productname> utilise <literal>RESTRICT</literal> par
    défaut.
   </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simpara>
   <xref linkend="sql-grant" endterm="sql-grant-title"/>
  </simpara>
 </refsect1>

</refentry>
