<?xml version="1.0" encoding="UTF-8"?>
<!-- Dernière modification
     le       $Date$
     par      $Author$
     révision $Revision$ -->

<chapter id="charset">
 <title>Localisation</title>

 <para>
  Ce chapitre décrit, du point de vue de l'administrateur, les fonctionnalités
  de régionalisation (ou localisation) disponibles.
  <productname>PostgreSQL</productname> fournit deux approches
  différentes pour la gestion de la localisation&nbsp;:

   <itemizedlist>
    <listitem>
     <para>
      l'utilisation des fonctionnalités de locales du système d'exploitation pour 
      l'ordonnancement du tri, le formatage des chiffres, les messages
      traduits et autres aspects spécifiques à la locale&nbsp;;
     </para>
    </listitem>

    <listitem>
     <para>
      la fourniture d'un certain nombre d'encodages différents pour permettre
      le stockage de texte dans toutes les langues et fournir la traduction de
      l'encodage entre serveur et client.
     </para>
    </listitem>
   </itemizedlist>
  </para>


 <sect1 id="locale">
  <title>Support des locales</title>
  
  <indexterm zone="locale"><primary>locale</primary></indexterm>

  <para>
   Le support des <firstterm>locales</firstterm> fait référence à une application
   respectant les préférences culturelles au regard des alphabets,
   du tri, du format des nombres, etc.  <productname>PostgreSQL</productname> utilise
   les possibilités offertes par C et <acronym>POSIX</acronym> du standard
   ISO fournies par le système d'exploitation du serveur. Pour plus d'informations,
   consulter la documentation du système.
  </para>

  <sect2>
   <title>Aperçu</title>

   <para>
    Le support des locales est automatiquement déclenché lorsqu'un cluster de 
    base de données est créé avec <command>initdb</command>.
    <command>initdb</command> initialise le cluster avec la valeur des
    locales de son environnement d'exécution par défaut. Si le système est
    déjà paramétré pour utiliser la locale souhaitée pour le cluster, il n'y
    a donc rien d'autre à faire. Si une locale différente est souhaitée (ou
    que celle utilisée par le serveur n'est pas connue avec certitude), il
    est possible d'indiquer à <command>initdb</command> la locale à
    utiliser à l'aide de l'option <option>--locale</option>.
    Par exemple&nbsp;:
<screen>initdb --locale=sv_SE</screen>
   </para>

   <para>
    Cet exemple pour les systèmes Unix positionne la locale au suédois
    (<literal>sv</literal>) tel que parlé en
    Suède (<literal>SE</literal>). Parmi les autres possibilités, on peut
    envisager <literal>en_US</literal> (l'anglais américain) ou
    <literal>fr_CA</literal> (français canadien). Si plusieurs encodages
    s'avèrent utiles pour une même locale, alors l'indication peut
    ressembler à&nbsp;: <literal>cs_CZ.ISO8859-2</literal>. Les locales
    disponibles et leurs noms dépendent de l'éditeur du système d'exploitation
    et de ce qui est installé. Sur la plupart des systèmes Unix, la commande
    <literal>locale -a</literal> fournit la liste des locales disponibles.
    Windows utilise des noms de locale plus verbeux, comme
    <literal>German_Germany</literal> ou <literal>Swedish_Sweden.1252</literal>
    mais le principe est le même.
   </para>

   <para>
    Il est parfois utile de mélanger les règles de plusieurs
    locales, par exemple d'utiliser les règles de tri anglais avec des messages en
    espagnol. Pour cela, des sous-catégories de locales existent
    qui ne contrôlent qu'un aspect particulier des règles de localisation&nbsp;:

    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colwidth="0.4*"/>
     <colspec colnum="2" colwidth="1.6*"/>
      <tbody>
       <row>
        <entry><envar>LC_COLLATE</envar></entry>
        <entry>Ordre de tri des chaînes de caractères</entry>
       </row>
       <row>
        <entry><envar>LC_CTYPE</envar></entry>
        <entry>Classification de caractères (Qu'est-ce qu'une lettre&nbsp;?
         La majuscule équivalente&nbsp;?)</entry>
       </row>
       <row>
        <entry><envar>LC_MESSAGES</envar></entry>
        <entry>Langue des messages</entry>
       </row>
       <row>
        <entry><envar>LC_MONETARY</envar></entry>
        <entry>Formatage des valeurs monétaires</entry>
       </row>
       <row>
        <entry><envar>LC_NUMERIC</envar></entry>
        <entry>Formatage des nombres</entry>
       </row>
       <row>
        <entry><envar>LC_TIME</envar></entry>
        <entry>Formatage des dates et heures</entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>

    Les noms des catégories se traduisent en noms d'options
    <command>initdb</command> pour surcharger le choix de locale
    pour une catégorie donnée. Par exemple, pour utiliser la locale
    français canadien avec des règles américaines pour le
    formatage monétaire, on utilise
    <literal>initdb --locale=fr_CA --lc-monetary=en_US</literal>.
   </para>

   <para>
    Pour bénéficier d'un système qui se comporte comme s'il ne disposait pas du
    support des locales, on utilise les locales spéciales <literal>C</literal> ou
    <literal>POSIX</literal>.
   </para>

   <para>
    La nature de certaines catégories de locales oblige à les fixer lors de la
    création de la base de données. Vous pouvez utiliser des paramétrages
    différents pour chaque bases de données. Par contre, une fois que la base
    est créée, les paramétrages de locales ne peuvent plus être modifiés.
    <literal>LC_COLLATE</literal> et <literal>LC_CTYPE</literal> sont de
    cette catégorie. Elles affectent l'ordre de tri des index et doivent donc
    rester inchangées, les index sur les colonnes de texte risquant d'être
    corrompus dans le cas contraire. La valeur par défaut pour ces catégories
    est déterminée lors de l'exécution d'<command>initdb</command>. Ces valeurs
    sont utilisées quand de nouvelles bases de données sont créées, sauf si
    d'autres valeurs sont indiquées avec la commande <command>CREATE
    DATABASE</command>.
   </para>

   <para>
    Les autres catégories de locale peuvent être modifiées à n'importe quel
    moment en configurant les variables d'environnement de même nom (voir la
    <xref linkend="runtime-config-client-format"/> pour de plus amples
    détails). Les valeurs par défaut choisies par
    <command>initdb</command> sont en fait écrites dans le fichier de
    configuration <filename>postgresql.conf</filename> pour servir de
    valeurs par défaut au démarrage du serveur. Si ces déclarations sont
    supprimées du fichier <filename>postgresql.conf</filename>, le serveur
    hérite des paramètres de son environnement d'exécution.
   </para>

   <para>
    Le comportement des locales du serveur est déterminé par les
    variables d'environnement vues par le serveur, pas par celles de
    l'environnement d'un quelconque client. Il est donc important de 
    configurer les bons paramètres de locales avant le démarrage du serveur.
    Cela a pour conséquence que, si les locales du client et du serveur
    diffèrent, les messages peuvent apparaître dans des langues différentes
    en fonction de leur provenance.
   </para>

   <note>
    <para>
     Hériter la locale de l'environnement d'exécution signifie, sur la 
     plupart des systèmes d'exploitation, la chose suivante&nbsp;:
     pour une catégorie de locales donnée (l'ordonnancement par exemple)
     les variables d'environnement <envar>LC_ALL</envar>,
     <envar>LC_COLLATE</envar> (ou la variable qui correspond à la catégorie)
     et <envar>LANG</envar> sont consultées dans cet ordre jusqu'à en
     trouver une qui est fixée. Si aucune de ces variables n'est fixée,
     c'est la locale par défaut, <literal>C</literal>, qui est utilisée.
    </para>

    <para>
     Certaines bibliothèques de localisation regardent aussi la variable
     d'environnement <envar>LANGUAGE</envar> qui surcharge tout autre
     paramètre pour fixer la langue des messages. En cas de doute, 
     lire la documentation du système d'exploitation,
     en particulier la partie concernant <application>gettext</application>.
    </para>
   </note>

   <para>
    Pour permettre la traduction des messages dans la langue préférée de
    l'utilisateur, <acronym>NLS</acronym> doit avoir été activé pendant la
    compilation (<literal>configure --enable-nls</literal>). Tout autre support
    de la locale est construit automatiquement.
   </para>
  </sect2>

  <sect2>
   <title>Comportement</title>

   <para>
    Le paramétrage de la locale influence les fonctionnalités SQL
    suivantes&nbsp;:

    <itemizedlist>
     <listitem>
      <para>
       l'ordre de tri dans les requêtes utilisant <literal>ORDER BY</literal>
       ou les opérateurs de comparaison standards sur des données de type
       texte&nbsp;;
       <indexterm><primary>ORDER BY</primary><secondary>et locales</secondary></indexterm>
      </para>
     </listitem>

     <listitem>
      <para>
       la possibilité d'utiliser des index avec les clauses
       <literal>LIKE</literal>&nbsp;;
       <indexterm><primary>LIKE</primary><secondary>et locales</secondary></indexterm>
      </para>
     </listitem>

     <listitem>
      <para>
       les fonctions <function>upper</function>, <function>lower</function> et
       <function>initcap</function>&nbsp;;
       <indexterm><primary>upper</primary><secondary>et locales</secondary></indexterm>
       <indexterm><primary>lower</primary><secondary>et locales</secondary></indexterm>
       <indexterm><primary>initcap</primary><secondary>et locales</secondary></indexterm>
      </para>
     </listitem>

     <listitem>
      <para>
       la famille de fonctions <function>to_char</function>.
       <indexterm><primary>to_char</primary><secondary>et locales</secondary></indexterm>
      </para>
     </listitem>
    </itemizedlist>
   </para>

   <para>
    Le support des locales autres que <literal>C</literal> ou
    <literal>POSIX</literal> dans <productname>PostgreSQL</productname> a
    pour inconvénient son impact sur les performances. Il ralentit la gestion
    des caractères et empêche l'utilisation des index ordinaires par
    <literal>LIKE</literal>. Pour cette raison, il est préférable de
    n'utiliser les locales qu'en cas de réel besoin.
   </para>

   <para>
    Toutefois, pour permettre à <productname>PostgreSQL</productname> d'utiliser
    des index avec les clauses <literal>LIKE</literal> et une locale
    différente de <literal>C</literal>, il existe plusieurs classes
    d'opérateurs personnalisées. Elles permettent
    la création d'un index qui réalise une stricte comparaison caractère par
    caractère, ignorant les règles de comparaison des locales. Se référer à
    la <xref linkend="indexes-opclass"/> pour plus d'informations.
   </para>
  </sect2>

  <sect2>
   <title>Problèmes</title>

   <para>
    Si le support des locales ne fonctionne pas au regard des explications ci-dessus,
    il faut vérifier que le support des locales du système d'exploitation est
    correctement configuré. Pour vérifier les locales installées sur
    le système, on peut utiliser la commande <literal>locale -a</literal>,
    si elle est fournie avec le système d'exploitation.
   </para>

   <para>
    Il faut vérifier que <productname>PostgreSQL</productname> utilise
    effectivement la locale supposée. Les paramètres <envar>LC_COLLATE</envar>
    et <envar>LC_CTYPE</envar> sont déterminés lors de la création de la base
    de données et ne peuvent pas être modifiés sauf en créant une nouvelle
    base de données.
    D'autres paramètres de locale, y compris <envar>LC_MESSAGES</envar> et
    <envar>LC_MONETARY</envar>, sont déterminés initialement par
    l'environnement dans lequel le serveur est lancé mais peuvent être
    modifiés pendant l'exécution. Pour vérifier le paramétrage
    de la locale active on utilise la commande <command>SHOW</command>.
   </para>

   <para>
    Le répertoire <filename>src/test/locale</filename> de la distribution 
    source contient une série de tests pour le support des locales dans
    <productname>PostgreSQL</productname>.
   </para>

   <para>
    Les applications clientes qui gèrent les erreurs en provenance du
    serveur par l'analyse du texte du message d'erreur vont certainement
    éprouver des difficultés lorsque les messages du serveur sont dans une langue
    différente. Les auteurs de telles applications sont
    invités à utiliser le schéma de code d'erreur à la place.
   </para>

   <para>
    Le maintien de catalogues de traductions de messages nécessitent les
    efforts permanents de beaucoup de volontaires qui souhaitent voir
    <productname>PostgreSQL</productname> parler correctement leur langue 
    préférée. Si certains messages dans une langue ne sont pas disponibles ou
    pas complètement traduits, toute aide est la bienvenue. Pour apporter
    son aide à ce projet, consulter le <xref linkend="nls"/> ou écrire à
    la liste de diffusion des développeurs.
   </para>
  </sect2>
 </sect1>


 <sect1 id="multibyte">
  <title>Support des jeux de caractères</title>

  <indexterm zone="multibyte"><primary>jeu de caractère</primary></indexterm>

  <para>
   Le support des jeux de caractères dans <productname>PostgreSQL</productname>
   permet d'insérer du texte dans différents jeux de caractères (aussi appelés
   encodages), dont
   ceux mono-octet tels que la série ISO 8859 et ceux multi-octets tels que
   <acronym>EUC</acronym> (Extended Unix Code), UTF-8 ou le codage interne Mule.
   Tous les jeux de caractères supportés peuvent être utilisés de façon
   transparente par les clients mais certains ne sont pas supportés par le
   serveur (c'est-à-dire comme encodage du serveur).
   Le jeu de caractères par défaut est sélectionné pendant l'initialisation
   du cluster de base de données avec <command>initdb</command>. Ce choix peut
   être surchargé à la création de la base. Il est donc possible de disposer
   de bases utilisant chacune un jeu de caractères différent.
  </para>

  <para>
   Il existe, cependant une importante restriction&nbsp;: le jeu de caractère
   de la base de données doit être compatible avec les variables
   d'environnement <envar>LC_CTYPE</envar> et <envar>LC_COLLATE</envar> de la base
   de données. Pour les locales <literal>C</literal> ou <literal>POSIX</literal>, tous
   les jeux de caractères sont autorisés, mais pour les locales,
   il n'y a qu'un seul jeux de caractères qui fonctionne correctement.
   (Néanmoins, sur Windows, l'encodage UTF-8 peut être utilisé avec toute
   locale.)
  </para>

   <sect2 id="multibyte-charset-supported">
    <title>Jeux de caractères supportés</title>

    <para>
     Le <xref linkend="charset-table"/> présente les jeux de caractères
     utilisables avec <productname>PostgreSQL</productname>.
    </para>

     <table id="charset-table">
      <title>Jeux de caractères de <productname>PostgreSQL</productname></title>
      <tgroup cols="5">
       <colspec colnum="1" colwidth="0.8*"/>
       <colspec colnum="2" colwidth="1.4*"/>
       <colspec colnum="3" colwidth="1*"/>
       <colspec colnum="4" colwidth="0.2*"/>
       <colspec colnum="5" colwidth="0.7*"/>
       <colspec colnum="6" colwidth="1.1*"/>
       <thead>
        <row>
         <entry>Nom</entry>
         <entry>Description</entry>
         <entry>Langue</entry>
         <entry>Serveur&nbsp;?</entry>
         <!--
          The Bytes/Char field is populated by looking at the values returned
          by pg_wchar_table.mblen function for each encoding.
         -->
         <entry>Octets/Caractère</entry>
         <entry>Alias</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry><literal>BIG5</literal></entry>
         <entry>Big Five</entry>
         <entry>Chinois traditionnel</entry>
         <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>WIN950</literal>, <literal>Windows950</literal></entry>
        </row>
        <row>
         <entry><literal>EUC_CN</literal></entry>
         <entry>Code-CN Unix étendu</entry>
         <entry>Chinois simplifié</entry>
         <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_JP</literal></entry>
         <entry>Code-JP Unix étendu</entry>
         <entry>Japonais</entry>
         <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_JIS_2004</literal></entry>
         <entry>Code-JP Unix étendu, JIS X 0213</entry>
         <entry>Japonais</entry>
         <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_KR</literal></entry>
         <entry>Code-KR Unix étendu</entry>
         <entry>Coréen</entry>
         <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_TW</literal></entry>
         <entry>Code-TW Unix étendu</entry>
         <entry>Chinois traditionnel, taïwanais</entry>
         <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>GB18030</literal></entry>
         <entry>Standard national</entry>
         <entry>Chinois</entry>
         <entry>Non</entry>
         <entry>1-2</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>GBK</literal></entry>
         <entry>Standard national étendu</entry>
         <entry>Chinois simplifié</entry>
         <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>WIN936</literal>, <literal>Windows936</literal></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_5</literal></entry>
         <entry>ISO 8859-5, <acronym>ECMA</acronym> 113</entry>
         <entry>Latin/Cyrillique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_6</literal></entry>
         <entry>ISO 8859-6, <acronym>ECMA</acronym> 114</entry>
         <entry>Latin/Arabe</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_7</literal></entry>
         <entry>ISO 8859-7, <acronym>ECMA</acronym> 118</entry>
         <entry>Latin/Grec</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_8</literal></entry>
         <entry>ISO 8859-8, <acronym>ECMA</acronym> 121</entry>
         <entry>Latin/Hébreu</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>JOHAB</literal></entry>
         <entry><acronym>JOHAB</acronym></entry>
         <entry>Koréen (Hangul)</entry>
         <entry>Non</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>KOI8</literal></entry>
         <entry><acronym>KOI</acronym>8-R(U)</entry>
         <entry>Cyrillique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>KOI8R</literal></entry>
        </row>
        <row>
         <entry><literal>KOI8R</literal></entry>
         <entry><acronym>KOI</acronym>8-R</entry>
         <entry>Cyrillique (Russie)</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>KOI8</literal></entry>
        </row>
        <row>
         <entry><literal>KOI8U</literal></entry>
         <entry><acronym>KOI</acronym>8-U</entry>
         <entry>Cyrillique (Ukraine)</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>LATIN1</literal></entry>
         <entry>ISO 8859-1, <acronym>ECMA</acronym> 94</entry>
         <entry>Europe de l'ouest</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88591</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN2</literal></entry>
         <entry>ISO 8859-2, <acronym>ECMA</acronym> 94</entry>
         <entry>Europe centrale</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88592</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN3</literal></entry>
         <entry>ISO 8859-3, <acronym>ECMA</acronym> 94</entry>
         <entry>Europe du sud</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88593</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN4</literal></entry>
         <entry>ISO 8859-4, <acronym>ECMA</acronym> 94</entry>
         <entry>Europe du nord</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88594</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN5</literal></entry>
         <entry>ISO 8859-9, <acronym>ECMA</acronym> 128</entry>
         <entry>Turque</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88599</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN6</literal></entry>
         <entry>ISO 8859-10, <acronym>ECMA</acronym> 144</entry>
         <entry>Nordique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885910</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN7</literal></entry>
         <entry>ISO 8859-13</entry>
         <entry>Baltique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885913</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN8</literal></entry>
         <entry>ISO 8859-14</entry>
         <entry>Celtique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885914</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN9</literal></entry>
         <entry>ISO 8859-15</entry>
         <entry>LATIN1 avec l'Euro et les accents</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry>ISO885915</entry>
        </row>
        <row>
         <entry><literal>LATIN10</literal></entry>
         <entry>ISO 8859-16, <acronym>ASRO</acronym> SR 14111</entry>
         <entry>Roumain</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885916</literal></entry>
        </row>
        <row>
         <entry><literal>MULE_INTERNAL</literal></entry>
         <entry>Code interne Mule</entry>
         <entry>Emacs multi-langues</entry>
         <entry>Oui</entry>
         <entry>1-4</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>SJIS</literal></entry>
         <entry>Shift JIS</entry>
         <entry>Japonais</entry>
         <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>Mskanji</literal>, <literal>ShiftJIS</literal>, <literal>WIN932</literal>, <literal>Windows932</literal></entry>
        </row>
        <row>
         <entry><literal>SHIFT_JIS_2004</literal></entry>
         <entry>Shift JIS, JIS X 0213</entry>
               <entry>Japonais</entry>
         <entry>Non</entry>
         <entry>1-2</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>SQL_ASCII</literal></entry>
         <entry>non spécifié (voir le texte)</entry>
         <entry><emphasis>tout</emphasis></entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>UHC</literal></entry>
         <entry>Code unifié Hangul</entry>
         <entry>Koréen</entry>
         <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>WIN949</literal>, <literal>Windows949</literal></entry>
        </row>
        <row>
         <entry><literal>UTF8</literal></entry>
         <entry>Unicode, 8-bit</entry>
         <entry><emphasis>tous</emphasis></entry>
         <entry>Oui</entry>
         <entry>1-4</entry>
         <entry><literal>Unicode</literal></entry>
        </row>
        <row>
         <entry><literal>WIN866</literal></entry>
         <entry>Windows CP866</entry>
         <entry>Cyrillique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ALT</literal></entry>
        </row>
        <row>
         <entry><literal>WIN874</literal></entry>
         <entry>Windows CP874</entry>
         <entry>Thai</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1250</literal></entry>
         <entry>Windows CP1250</entry>
         <entry>Europe centrale</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1251</literal></entry>
         <entry>Windows CP1251</entry>
         <entry>Cyrillique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>WIN</literal></entry>
        </row>
        <row>
         <entry><literal>WIN1252</literal></entry>
         <entry>Windows CP1252</entry>
         <entry>Europe de l'ouest</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1253</literal></entry>
         <entry>Windows CP1253</entry>
         <entry>Grec</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1254</literal></entry>
         <entry>Windows CP1254</entry>
         <entry>Turque</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1255</literal></entry>
         <entry>Windows CP1255</entry>
         <entry>Hébreux</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1256</literal></entry>
         <entry>Windows CP1256</entry>
         <entry>Arabe</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1257</literal></entry>
         <entry>Windows CP1257</entry>
         <entry>Baltique</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1258</literal></entry>
         <entry>Windows CP1258</entry>
         <entry>Vietnamien</entry>
         <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ABC</literal>, <literal>TCVN</literal>, <literal>TCVN5712</literal>, <literal>VSCII</literal></entry>
        </row>
       </tbody>
      </tgroup>
     </table>

     <para>
      Toutes les <acronym>API</acronym> ne supportent pas tous les jeux de caractères de
      la liste. Le pilote JDBC de <productname>PostgreSQL</productname>, par
      exemple, ne supporte pas <literal>MULE_INTERNAL</literal>,
      <literal>LATIN6</literal>, <literal>LATIN8</literal> et
      <literal>LATIN10</literal>.
     </para>

     <para>
      <literal>SQL_ASCII</literal> se comporte de façon considérablement
      différente des autres valeurs. Quand le jeu de caractères du
      serveur est <literal>SQL_ASCII</literal>, le serveur interprète les valeurs
      des octets 0-127 suivant le standard ASCII alors que les valeurs
      d'octets 128-255 sont considérées comme des caractères non interprétés.
      Aucune conversion de codage n'est effectuée avec
      <literal>SQL_ASCII</literal>. De ce fait, cette valeur ne déclare pas
      tant un encodage spécifique que l'ignorance de l'encodage. Dans la
      plupart des cas, si des données non ASCII doivent être traitées, il est
      déconseillé d'utiliser la valeur <literal>SQL_ASCII</literal> car
      <productname>PostgreSQL</productname> est alors
      incapable de convertir ou de valider les caractères non ASCII.
     </para>
    </sect2>

   <sect2>
    <title>Choisir le jeu de caractères</title>

    <para>
     <command>initdb</command> définit le jeu de caractères par défaut
     pour un cluster. Par exemple,

<screen>initdb -E EUC_JP</screen>

     paramètre le jeu de caractères (encodage) à
     <literal>EUC_JP</literal> (Extended Unix Code for Japanese). 
     L'option <option>--encoding</option> peut aussi être utilisée à la
     place de <option>-E</option> (options longues). Si aucune option
     <option>-E</option> ou <option>--encoding</option> n'est
     donnée, <command>initdb</command> tente de déterminer l'encodage approprié
     en fonction de la locale indiquée ou de celle par défaut.
    </para>

    <para>
     Vous pouvez indiquer un encodage autre que celui par défaut lors de la
     création de la base de données, à condition que l'encodage soit compatible
     avec la locale sélectionnée&nbsp;:

<screen>createdb -E EUC_KR -T template0 --lc-collate=ko_KR.euckr --lc-ctype=ko_KR.euckr korean</screen>

     Cela crée une base de données appelée <literal>korean</literal> qui
     utilise le jeu de caractères <literal>EUC_KR</literal>, et la locale
     <literal>ko_KR</literal>. Un autre moyen de réaliser cela est d'utiliser
     la commande SQL suivante&nbsp;:

<programlisting>CREATE DATABASE korean WITH ENCODING 'EUC_KR' LC_COLLATE='ko_KR.euckr' LC_CTYPE='ko_KR.euckr' TEMPLATE=template0;
</programlisting>

     Notez que les commandes ci-dessus précisent de copier la base de données
     <literal>template0</literal>. Lors de la copie d'une autre base, les
     paramètres d'encodage et de locale ne peuvent pas être modifiés de ceux de
     la base de données source car cela pourrait corrompre les données. Pour
     plus d'informations, voir <xref linkend="manage-ag-templatedbs"/>.
    </para>

    <para>
     L'encodage de la base de données est conservé dans le catalogue système
     <literal>pg_database</literal>.  Cela est visible à l'aide de 
     l'option <option>-l</option> ou de la commande <command>\l</command> de
     <command>psql</command>.

<screen>$ <userinput>psql -l</userinput>
                                         List of databases
   Name    |  Owner   | Encoding  |  Collation  |    Ctype    |          Access Privileges          
-----------+----------+-----------+-------------+-------------+-------------------------------------
 clocaledb | hlinnaka | SQL_ASCII | C           | C           | 
 englishdb | hlinnaka | UTF8      | en_GB.UTF8  | en_GB.UTF8  | 
 japanese  | hlinnaka | UTF8      | ja_JP.UTF8  | ja_JP.UTF8  | 
 korean    | hlinnaka | EUC_KR    | ko_KR.euckr | ko_KR.euckr | 
 postgres  | hlinnaka | UTF8      | fi_FI.UTF8  | fi_FI.UTF8  | 
 template0 | hlinnaka | UTF8      | fi_FI.UTF8  | fi_FI.UTF8  | {=c/hlinnaka,hlinnaka=CTc/hlinnaka}
 template1 | hlinnaka | UTF8      | fi_FI.UTF8  | fi_FI.UTF8  | {=c/hlinnaka,hlinnaka=CTc/hlinnaka}
(7 rows)</screen>
    </para>

    <important>
     <para>
      Sur la plupart des systèmes d'exploitation modernes,
      <productname>PostgreSQL</productname> peut déterminer le jeu de
      caractères impliqué par la variable <envar>LC_CTYPE</envar>,
      et s'assure que l'encodage correspondant de la base de données est
      utilisé. Sur les systèmes plus anciens, il est de la responsabilité de
      l'utilisateur de s'assurer que l'encodage attendu par la locale est bien
      utilisé. Une erreur à ce niveau risque fort de conduire à un comportement
      étrange des opérations liées à la locale, tel le tri.
     </para>    

     <para>
      <productname>PostgreSQL</productname> autorise les superutilisateurs à créer des bases de données
      avec le jeu de caractère <literal>SQL_ASCII</literal> même lorsque la variable <envar>LC_CTYPE</envar>
      n'est pas à <literal>C</literal> ou <literal>POSIX</literal>.
      Comme indiqué plus haut,
      <literal>SQL_ASCII</literal> n'impose aucun encodage particulier aux
      données stockées en base, ce qui rend ce paramétrage vulnérable aux
      comportements erratiques lors d'opérations liées à la locale. 
      Cette combinaison de paramètres est dépréciée et pourrait un jour être
      interdite.
     </para>
    </important>
   </sect2>

   <sect2>
    <title>Conversion automatique d'encodage entre serveur et client</title>

    <para>
     <productname>PostgreSQL</productname> automatise la conversion
     de jeux de caractères entre client et serveur pour
     certaines combinaisons de jeux de caractères. Les informations de conversion sont
     conservées dans le catalogue système <literal>pg_conversion</literal>.
     <productname>PostgreSQL</productname> est livré avec certaines
     conversions prédéfinies, conversions listées dans le
     <xref linkend="multibyte-translation-table"/>. Une nouvelle
     conversion peut être créée en utilisant la commande SQL
     <command>CREATE CONVERSION</command>.
    </para>

     <table id="multibyte-translation-table">
      <title>Conversion de jeux de caractères client/serveur</title>
      <tgroup cols="2">
       <colspec colnum="1" colwidth="0.5*"/>
       <colspec colnum="2" colwidth="1.5*"/>
       <thead>
        <row>
         <entry>Jeu de caractères serveur</entry>
         <entry>Jeux de caractères client disponibles</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry><literal>BIG5</literal></entry>
         <entry><emphasis>non supporté comme encodage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_CN</literal></entry>
         <entry><emphasis>EUC_CN</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_JP</literal></entry>
         <entry><emphasis>EUC_JP</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>SJIS</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_KR</literal></entry>
         <entry><emphasis>EUC_KR</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_TW</literal></entry>
         <entry><emphasis>EUC_TW</emphasis>,
         <literal>BIG5</literal>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>GB18030</literal></entry>
         <entry><emphasis>non supporté comme encodage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>GBK</literal></entry>
         <entry><emphasis>non supporté comme encodage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_5</literal></entry>
         <entry><emphasis>ISO_8859_5</emphasis>,
         <literal>KOI8R</literal>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>,
         <literal>WIN866</literal>,
         <literal>WIN1251</literal>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_6</literal></entry>
         <entry><emphasis>ISO_8859_6</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_7</literal></entry>
         <entry><emphasis>ISO_8859_7</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_8</literal></entry>
         <entry><emphasis>ISO_8859_8</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>JOHAB</literal></entry>
         <entry><emphasis>JOHAB</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>KOI8R</literal></entry>
         <entry><emphasis>KOI8R</emphasis>,
         <literal>ISO_8859_5</literal>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>,
         <literal>WIN866</literal>,
         <literal>WIN1251</literal>
         </entry>
        </row>
        <row>
         <entry><literal>KOI8U</literal></entry>
         <entry><emphasis>KOI8U</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>LATIN1</literal></entry>
         <entry><emphasis>LATIN1</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN2</literal></entry>
         <entry><emphasis>LATIN2</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>,
         <literal>WIN1250</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN3</literal></entry>
         <entry><emphasis>LATIN3</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN4</literal></entry>
         <entry><emphasis>LATIN4</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN5</literal></entry>
         <entry><emphasis>LATIN5</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN6</literal></entry>
         <entry><emphasis>LATIN6</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN7</literal></entry>
         <entry><emphasis>LATIN7</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN8</literal></entry>
         <entry><emphasis>LATIN8</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN9</literal></entry>
         <entry><emphasis>LATIN9</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN10</literal></entry>
         <entry><emphasis>LATIN10</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>MULE_INTERNAL</literal></entry>
         <entry><emphasis>MULE_INTERNAL</emphasis>,
          <literal>BIG5</literal>,
          <literal>EUC_CN</literal>,
          <literal>EUC_JP</literal>,
          <literal>EUC_KR</literal>,
          <literal>EUC_TW</literal>,
          <literal>ISO_8859_5</literal>,
          <literal>KOI8R</literal>,
          <literal>LATIN1</literal> vers <literal>LATIN4</literal>,
          <literal>SJIS</literal>,
          <literal>WIN866</literal>,
          <literal>WIN1250</literal>,
          <literal>WIN1251</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>SJIS</literal></entry>
         <entry><emphasis>non supporté comme encodage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>SQL_ASCII</literal></entry>
         <entry><emphasis>tous (aucune conversion n'est réalisée)</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>UHC</literal></entry>
         <entry><emphasis>non supporté comme encodage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>UTF8</literal></entry>
         <entry><emphasis>tout encodage supporté</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>WIN866</literal></entry>
         <entry><emphasis>WIN866</emphasis>,
          <literal>ISO_8859_5</literal>,
          <literal>KOI8R</literal>,
          <literal>MULE_INTERNAL</literal>,
          <literal>UTF8</literal>,
          <literal>WIN1251</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN874</literal></entry>
         <entry><emphasis>WIN874</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1250</literal></entry>
         <entry><emphasis>WIN1250</emphasis>,
          <literal>LATIN2</literal>,
          <literal>MULE_INTERNAL</literal>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1251</literal></entry>
         <entry><emphasis>WIN1251</emphasis>,
          <literal>ISO_8859_5</literal>,
          <literal>KOI8R</literal>,
          <literal>MULE_INTERNAL</literal>,
          <literal>UTF8</literal>,
          <literal>WIN866</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1252</literal></entry>
         <entry><emphasis>WIN1252</emphasis>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1253</literal></entry>
         <entry><emphasis>WIN1253</emphasis>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1254</literal></entry>
         <entry><emphasis>WIN1254</emphasis>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1255</literal></entry>
         <entry><emphasis>WIN1255</emphasis>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1256</literal></entry>
         <entry><emphasis>WIN1256</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1257</literal></entry>
         <entry><emphasis>WIN1257</emphasis>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1258</literal></entry>
         <entry><emphasis>WIN1258</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </table>

    <para>
     Pour activer la conversion automatique des jeux de caractères, il
     est nécessaire d'indiquer à <productname>PostgreSQL</productname>
     le jeu de caractères (encodage) souhaité côté client. Il y a plusieurs
     façons de le faire&nbsp;:

     <itemizedlist>
      <listitem>
       <para>
        en utilisant la commande <command>\encoding</command> dans
        <application>psql</application>.
        <command>\encoding</command> permet de changer l'encodage
        client à la volée. Par exemple, pour changer le codage en
        <literal>SJIS</literal>, taper&nbsp;:

<programlisting>\encoding SJIS</programlisting>
       </para>
      </listitem>

      <listitem>
       <para>
        <application>la libpq</application> (<xref linkend="libpq-control"/>)
        a des fonctions de contrôle de l'encodage client&nbsp;;
       </para>
      </listitem>

      <listitem>
       <para>
        en utilisant <command>SET client_encoding TO</command>.

        L'encodage client peut être fixé avec la commande SQL suivante&nbsp;:

<programlisting>SET CLIENT_ENCODING TO '<replaceable>valeur</replaceable>';</programlisting>

        La syntaxe SQL plus standard <literal>SET NAMES</literal> peut
        également être utilisée pour cela&nbsp;:

<programlisting>SET NAMES '<replaceable>valeur</replaceable>';</programlisting>

        Pour connaître l'encodage client courant&nbsp;:

<programlisting>SHOW client_encoding;</programlisting>

        Pour revenir à l'encodage par défaut&nbsp;:

<programlisting>RESET client_encoding;</programlisting>
       </para>
      </listitem>

      <listitem>
       <para>
        en utilisant <envar>PGCLIENTENCODING</envar>.
        Si la variable d'environnement <envar>PGCLIENTENCODING</envar> est définie
        dans l'environnement client, l'encodage client est automatiquement 
        sélectionné lors de l'établissement d'une connexion au serveur (cette
        variable peut être surchargée à l'aide de toute autre méthode
        décrite ci-dessus)&nbsp;;
       </para>
      </listitem>

      <listitem>
      <para>
      en utilisant la variable de configuration
      <xref linkend="guc-client-encoding"/>.
      Si la variable <varname>client_encoding</varname> est définie,
      l'encodage client est automatiquement sélectionné lors de
      l'établissement d'une connexion au serveur (cette variable peut être
      surchargée à l'aide de toute autre méthode décrite ci-dessus).
       </para>
      </listitem>

     </itemizedlist>
    </para>

    <para>
     Si la conversion d'un caractère particulier n'est pas possible &mdash;
     dans le cas d'encodages <literal>EUC_JP</literal> pour le serveur 
     et <literal>LATIN1</literal> pour le client, par exemple, certains caractères
     japonais n'ont pas de représentation en <literal>LATIN1</literal>
     &mdash; une erreur est remontée.
    </para>

    <para>
     Si l'encodage client est défini en tant que
     <literal>SQL_ASCII</literal>, la conversion de l'encodage est désactivée quelque
     soit celui du serveur. Comme pour le serveur, 
     <literal>SQL_ASCII</literal> est déconseillé sauf à ne travailler qu'avec
     des données ASCII.
    </para>
   </sect2>

   <sect2>
    <title>Pour aller plus loin</title>

    <para>
     Il existe quelques sources intéressantes pour commencer à maîtriser les différents 
     jeux de caractères.

     <variablelist>
      <varlistentry>
       <term><ulink url="ftp://ftp.ora.com/pub/examples/nutshell/ujip/doc/cjk.inf"></ulink></term>

       <listitem>
        <para>
         Des explications détaillées de <literal>EUC_JP</literal>,
         <literal>EUC_CN</literal>, <literal>EUC_KR</literal>,
         <literal>EUC_TW</literal> apparaissent dans la section 3.2.
        </para>
       </listitem>
      </varlistentry>

      <varlistentry>
       <term><ulink url="http://www.unicode.org/"></ulink></term>

       <listitem>
        <para>
         Le site web du Unicode Consortium.
        </para>
       </listitem>
      </varlistentry>

      <varlistentry>
       <term>RFC 3629</term>

       <listitem>
        <para>
         <acronym>UTF</acronym>-8 est défini ici.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </para>
   </sect2>

  </sect1>

</chapter>
