<?xml version="1.0" encoding="UTF-8"?>
<refentry id="app-pgrestore">
 <indexterm zone="app-pgrestore">
  <primary>pg_restore</primary>
 </indexterm>

 <refmeta>
  <refentrytitle>pg_restore</refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_restore</refname>

  <refpurpose>
   restaure une base de données <productname>PostgreSQL</productname> à partir
   d'un fichier d'archive créé par <application>pg_dump</application>
  </refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_restore</command>
   <arg rep="repeat"><replaceable>option_connexion</replaceable></arg>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
   <arg choice="opt"><replaceable>nom_fichier</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1 id="app-pgrestore-description">
  <title>Description</title>

  <para>
   <application>pg_restore</application> est un outil pour restaurer une base
   de données <productname>PostgreSQL</productname> à partir d'une archive
   créée par <xref linkend="app-pgdump"/> dans un des formats non textuel. Il
   lance les commandes nécessaires pour reconstruire la base de données dans
   l'état où elle était au moment de sa sauvegarde. Les fichiers d'archive
   permettent aussi à <application>pg_restore</application> d'être sélectif
   sur ce qui est restauré ou même de réordonner les éléments à restaurer. Les
   fichiers d'archive sont conçus pour être portables entre les architectures.
  </para>

  <para>
   <application>pg_restore</application> peut opérer dans deux modes. Si un
   nom de base de données est spécifié, <application>pg_restore</application>
   se connecte à cette base de données et restaure le contenu de l'archive
   directement dans la base de données. Sinon, un script contenant les
   commandes SQL nécessaires pour reconstruire la base de données est créé et
   écrit dans un fichier ou sur la sortie standard. La sortie du script est
   équivalente à celles créées par le format en texte plein de
   <application>pg_dump</application>. Quelques-unes des options contrôlant la
   sortie sont du coup analogues aux options de
   <application>pg_dump</application>.
  </para>

  <para>
   De toute évidence, <application>pg_restore</application> ne peut pas
   restaurer l'information qui ne se trouve pas dans le fichier d'archive.
   Par exemple, si l'archive a été réalisée en utilisant l'option donnant les
   <quote>données sauvegardées par des commandes
    <command>INSERT</command></quote>, <application>pg_restore</application> ne
   sera pas capable de charger les données en utilisant des instructions
   <command>COPY</command>.
  </para>
 </refsect1>

 <refsect1 id="app-pgrestore-options">
  <title>Options</title>

  <para>
   <application>pg_restore</application> accepte les arguments suivants en
   ligne de commande.

   <variablelist>
    <varlistentry>
     <term><replaceable class="parameter">nom_fichier</replaceable></term>
     <listitem>
      <para>
       Spécifie l'emplacement du fichier d'archive (ou du répertoire pour une
       archive au format « directory ») à restaurer. S'il n'est pas spécifié,
       l'entrée standard est utilisée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-a</option></term>
     <term><option>--data-only</option></term>
     <listitem>
      <para>
       Restaure seulement les données, pas les schémas (définitions des
       données). Les données des tables, les Large Objects, et les valeurs des
       séquences sont restaurées si elles sont présentes dans l'archive.
      </para>

      <para>
       Cette option est similaire à <option>--section=data</option> mais, pour
       des raisons historiques, elle n'est pas identique.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-c</option></term>
     <term><option>--clean</option></term>
     <listitem>
      <para>
       Nettoie (supprime) les objets de la base de données avant de les créer.
       (Sauf si <option>--if-exists</option> est utilisé, ceci pourrait
       générer quelques messages d'erreur sans conséquence, si certains objets
       ne sont pas présents dans la base de données de destination.)
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-C</option></term>
     <term><option>--create</option></term>
     <listitem>
      <para>
       Crée la base de données avant de la restaurer. Si l'option
       <option>--clean</option> est aussi indiquée, supprime puis crée de
       nouveau la base de données cible avant de s'y connecter.
      </para>

      <para>
       Avec <option>--create</option>, <application>pg_restore</application>
       restaure aussi le commentaire de la base de données, s'il a été
       configuré, et toutes variables de configuration spécifiques à cette
       base, autrement dit toutes les commandes <command>ALTER DATABASE ...
        SET ...</command> et <command>ALTER ROLE ... IN DATABASE ... SET
        ...</command> qui mentionnent cette base. Les droits d'accès à la base
       elle-même sont aussi restaurés sauf si <option>--no-acl</option> est
       spécifié.
      </para>

      <para>
       Quand cette option est utilisée, la base de données nommée via l'option
       <option>-d</option> est utilisée seulement pour exécuter les commandes
       <command>DROP DATABASE</command> et <command>CREATE DATABASE</command>.
       Toutes les données sont restaurées dans la base dont le nom se trouve
       dans l'archive.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-d <replaceable
       class="parameter">nom_base</replaceable></option></term>
     <term><option>--dbname=<replaceable
       class="parameter">nom_base</replaceable></option></term>
     <listitem>
      <para>
       Se connecte à la base de données <replaceable
       class="parameter">nom_base</replaceable> et restaure directement dans
       la base de données. Ce nom de base peut être remplacé par une <link
       linkend="libpq-connstring">chaîne de connexion</link>. Dans ce cas, les
       paramètres de la chaîne de connexion surchargeront toutes les options
       en ligne de commande conflictuelles.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-e</option></term>
     <term><option>--exit-on-error</option></term>
     <listitem>
      <para>
       Quitte si une erreur est rencontrée lors de l'envoi des commandes SQL à
       la base de données. La valeur par défaut est de continuer et d'afficher
       le nombre d'erreurs à la fin de la restauration.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-f <replaceable>nom_fichier</replaceable></option></term>
     <term><option>--file=<replaceable>filename</replaceable></option></term>
     <listitem>
      <para>
       Spécifie le fichier en sortie pour le script généré ou pour la liste
       lorsqu'elle est utilisée avec <option>-l</option>. Utilisez
       <literal>-</literal> pour <systemitem>stdout</systemitem>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-F <replaceable class="parameter">format</replaceable></option></term>
     <term><option>--format=<replaceable class="parameter">format</replaceable></option></term>
     <listitem>
      <para>
       Spécifie le format de l'archive. Il n'est pas nécessaire de le
       spécifier car <application>pg_restore</application> détermine le format
       automatiquement. Si spécifié, il peut être un des suivants&nbsp;:

       <variablelist>
        <varlistentry>
         <term><literal>c</literal></term>
         <term><literal>custom</literal></term>
         <listitem>
          <para>
           L'archive est dans le format personnalisé de
           <application>pg_dump</application>.
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>d</literal></term>
         <term><literal>directory</literal></term>
         <listitem>
          <para>
           L'archive est un répertoire
           (<foreignphrase>directory</foreignphrase>).
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>t</literal></term>
         <term><literal>tar</literal></term>
         <listitem>
          <para>
           L'archive est une archive <command>tar</command>.
          </para>
         </listitem>
        </varlistentry>
       </variablelist>
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-I <replaceable class="parameter">index</replaceable></option></term>
     <term><option>--index=<replaceable class="parameter">index</replaceable></option></term>
     <listitem>
      <para>
       Restaure uniquement la définition des index nommés. Plusieurs index
       peuvent être donnés en utilisant autant de fois l'option
       <option>-I</option>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-j <replaceable class="parameter">nombre-de-jobs</replaceable></option></term>
     <term><option>--jobs=<replaceable class="parameter">nombre-de-jobs</replaceable></option></term>
     <listitem>
      <para>
       Exécute les parties les plus consommatrices en temps de
       <application>pg_restore</application> &mdash; celles des chargements de
       données, créations d'index et créations de contraintes &mdash; en
       parallèle, utilisant jusqu'à <replaceable
       class="parameter">nombre-de-jobs</replaceable> sessions parallèles.
       Cette option peut réduire de beaucoup le temps pour restaurer une
       grosse base de données pour un serveur fonctionnant sur une machine
       multi-processus. Cette option est ignorée lors de la création d'un
       script, plutôt que lors d'une connexion directe à un serveur de bases
       de données.
      </para>

      <para>
       Chaque job est un processus ou un thread, suivant le système
       d'exploitation, et utilise une connexion séparée au serveur.
      </para>

      <para>
       La valeur optimale pour cette option dépend de la configuration
       matérielle du serveur, du client et du réseau. Les facteurs incluent le
       nombre de c&oelig;urs CPU et la configuration disque. Un bon moyen pour
       commencer est le nombre de c&oelig;urs CPU du serveur, mais une valeur
       plus grande que ça peut amener des temps de restauration encore
       meilleurs dans de nombreux cas. Bien sûr, les valeurs trop hautes
       apporteront des performances en baisse.
      </para>

      <para>
       Seuls les formats d'archivage personnalisé et répertoire sont supportés
       avec cette option. Le fichier en entrée doit être un fichier standard
       (pas un tube, pas l'entrée standard). De plus,
       plusieurs jobs ne peuvent pas être utilisés ensemble si vous voulez
       l'option <option>--single-transaction</option>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-l</option></term>
     <term><option>--list</option></term>
     <listitem>
      <para>
       Liste le contenu de l'archive. Le résultat de cette opération peut être
       utilisé en entrée de l'option <option>-L</option>. Notez que, si vous
       utilisez des options de filtre telles que <option>-n</option> ou
       <option>-t</option> avec l'option <option>-l</option>, elles
       restreignent les éléments listés.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-L <replaceable
       class="parameter">fichier_liste</replaceable></option></term>
     <term><option>--use-list=<replaceable
       class="parameter">fichier_liste</replaceable></option></term>
     <listitem>
      <para>
       Restaure seulement les objets qui sont listés dans le fichier
       <replaceable class="parameter">fichier_liste</replaceable>, et les
       restaure dans l'ordre où elles apparaissent dans le fichier. Notez que,
       si des options de filtre comme <option>-n</option> et
       <option>-t</option> sont utilisées avec <option>-L</option>, elles
       ajouteront cette restriction aux éléments restaurés.
      </para>

      <para>
       <replaceable class="parameter">fichier_liste</replaceable> est
       normalement créé en éditant la sortie d'une précédente opération
       <option>-l</option>. Les lignes peuvent être déplacées ou supprimées,
       et peuvent aussi être mise en commentaire en ajoutant un point-virgule
       (<literal>;</literal>) au début de la ligne. Voir ci-dessous pour des
       exemples.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-n <replaceable class="parameter">nom_schema</replaceable></option></term>
     <term><option>--schema=<replaceable class="parameter">nom_schema</replaceable></option></term>
     <listitem>
      <para>
       Restaure seulement les objets qui sont dans le schéma nommé. Plusieurs
       schémas peuvent être donnés en utilisant autant de fois l'option
       <option>-n</option>. Elle peut être combinée avec l'option
       <option>-t</option> pour ne restaurer qu'une seule table.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-N <replaceable class="parameter">nom_schema</replaceable></option></term>
     <term><option>--exclude-schema=<replaceable class="parameter">nom_schema</replaceable></option></term>
     <listitem>
      <para>
       Ne pas restaurer les objets qui sont dans le schéma nommé. Plusieurs
       schémas à exclure peuvent être spécifiés grâce à de multiples
       commutateurs <option>-N</option>.
      </para>

      <para>
       Si les commutateurs <option>-n</option> et <option>-N</option> sont
       tous deux présents pour le même schéma, le commutateur
       <option>-N</option> sera prépondérant et le schéma exclu.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-O</option></term>
     <term><option>--no-owner</option></term>
     <listitem>
      <para>
       Ne pas donner les commandes initialisant les propriétaires des objets
       pour correspondre à la base de données originale. Par défaut,
       <application>pg_restore</application> lance des instructions
       <command>ALTER OWNER</command> ou <command>SET SESSION
        AUTHORIZATION</command> pour configurer le propriétaire des éléments du
       schéma créé. Ces instructions échouent sauf si la connexion initiale à
       la base de données est réalisée par un superutilisateur (ou le même
       utilisateur que le propriétaire des objets du script). Avec
       <option>-O</option>, tout nom d'utilisateur peut être utilisé pour la
       connexion initiale et cet utilisateur est le propriétaire des objets
       créés.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-P <replaceable class="parameter">nom_fonction(argtype [,
        ...])</replaceable></option></term>
     <term><option>--function=<replaceable
       class="parameter">nom_fonction(argtype [,
        ...])</replaceable></option></term>
     <listitem>
      <para>
       Restaure seulement la fonction nommée. Faites attention à épeler le nom
       de la fonction et les arguments exactement comme ils apparaissent dans
       la table des matières du fichier de sauvegarde. Plusieurs fonctions
       peuvent être données en utilisant autant de fois l'option
       <option>-P</option>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-r</option></term>
     <term><option>--no-reconnect</option></term>
     <listitem>
      <para>
       Cette option est obsolète mais est toujours acceptée pour des raisons
       de compatibilité ascendante.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-s</option></term>
     <term><option>--schema-only</option></term>
     <listitem>
      <para>
       Restaure seulement le schéma (autrement dit, la définition des
       données), mais pas les données, à condition que cette définition est
       présente dans l'archive.
      </para>

      <para>
       Cette option est l'inverse de <option>--data-only</option>. Elle est
       similaire, mais pas identique (pour des raisons historiques), à
       <option>--section=pre-data --section=post-data</option>.
      </para>

      <para>
       (Ne pas la confondre avec l'option <option>--schema</option> qui
       utilise le mot <quote>schema</quote> dans un contexte différent.)
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-S <replaceable
       class="parameter">nom_utilisateur</replaceable></option></term>
     <term><option>--superuser=<replaceable
       class="parameter">nom_utilisateur</replaceable></option></term>
     <listitem>
      <para>
       Spécifie le nom d'utilisateur du superutilisateur à utiliser pour
       désactiver les déclencheurs. Ceci est seulement nécessaire si
       <option>--disable-triggers</option> est utilisé.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-t <replaceable class="parameter">table</replaceable></option></term>
     <term><option>--table=<replaceable class="parameter">table</replaceable></option></term>
     <listitem>
      <para>
       Restaure la définition et/ou les données de la table nommée uniquement.
       Dans ce cadre, <quote>table</quote> inclut les vues, les vues
       matérialisées, les séquences et les tables distantes. Plusieurs tables
       peuvent être sélectionnées en ajoutant plusieurs options
       <option>-t</option>. Cette option peut être combinée avec l'option
       <option>-n</option> pour indiquer les tables d'un schéma particulier.
      </para>

      <note>
       <para>
        Quand l'option <option>-t</option> est indiquée,
        <application>pg_restore</application> ne tente pas de restaurer les
        autres objets de la base de données qui pourraient être liés à la
        table sélectionnée. De ce fait, il n'y a aucune garantie qu'une
        restauration d'une table spécifique dans une base propre réussira.
       </para>
      </note>

      <note>
       <para>
        Cette option ne se comporte pas de la même façon que l'option
        <option>-t</option> de <application>pg_dump</application>. Il n'existe
        pas actuellement de support pour la recherche de motifs dans
        <application>pg_restore</application>. De plus, vous ne pouvez pas
        inclure un nom de schéma dans <option>-t</option>. Et, pendant que
        l'option <option>-t</option> de <application>pg_dump</application>
        sauvegardera aussi les objets liés (comme les index) des tables
        sélectionnées, l'option <option>-t</option> de
        <application>pg_restore</application> n'incluera pas les objets liés.
       </para>
      </note>

      <note>
       <para>
        Dans les versions de <productname>PostgreSQL</productname> antérieures
        à la 9.6, cette option correspondant seulement aux tables, pas aux
        autres types de relation.
       </para>
      </note>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-T <replaceable class="parameter">trigger</replaceable></option></term>
     <term><option>--trigger=<replaceable class="parameter">trigger</replaceable></option></term>
     <listitem>
      <para>
       Restaure uniquement le trigger nommé. Plusieurs triggers peuvent être
       donnés en utilisant autant de fois l'option <option>-T</option>..
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-v</option></term>
     <term><option>--verbose</option></term>
     <listitem>
      <para>
       Spécifie le mode verbeux.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-V</option></term>
     <term><option>--version</option></term>
     <listitem>
      <para>
       Affiche la version de <application>pg_restore</application>, puis
       quitte.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-x</option></term>
     <term><option>--no-privileges</option></term>
     <term><option>--no-acl</option></term>
     <listitem>
      <para>
       Empêche la restauration des droits d'accès (commandes grant/revoke).
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-1</option></term>
     <term><option>--single-transaction</option></term>
     <listitem>
      <para>
       Exécute la restauration en une seule transaction (autrement dit, toutes
       les commandes de restauration sont placées entre un
       <command>BEGIN</command> et un <command>COMMIT</command>). Ceci assure
       l'utilisateur que soit toutes les commandes réussissent, soit aucun
       changement n'est appliqué. Cette option implique
       <option>--exit-on-error</option>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--disable-triggers</option></term>
     <listitem>
      <para>
       Cette option n'est pertinente que lors d'une restauration des données
       seules. Elle demande à <application>pg_restore</application> d'exécuter
       des commandes pour désactiver temporairement les triggers sur les
       tables cibles pendant que les données sont rechargées. Utilisez ceci si
       vous avez des vérifications d'intégrité référentielle sur les tables
       que vous ne voulez pas appeler lors du rechargement des données.
      </para>

      <para>
       Actuellement, les commandes émises pour
       <option>--disable-triggers</option> doivent être exécutées par un
       superutilisateur. Donc, vous devriez aussi spécifier un nom de
       superutilisateur avec <option>-S</option> ou, de préférence, lancer
       <application>pg_restore</application> en tant que superutilisateur
       <productname>PostgreSQL</productname>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--enable-row-security</option></term>
     <listitem>
      <para>
       Cette option n'est adéquate que lors de la restauration du contenu du
       table disposant de l'option RLS. Par défaut,
       <application>pg_restore</application> configurera <xref
       linkend="guc-row-security"/> à off, pour s'assurer que toutes les
       données sont restaurées dans la table. Si l'utilisateur n'a pas les
       droits nécessaires pour contourner la sécurité au niveau ligne, alors
       une erreur est levée. Ce paramètre demande à
       <application>pg_restore</application> de configurer <xref
       linkend="guc-row-security"/> à on, permettant à l'utilisateur d'essayer
       de restaurer le contenu de la table avec la sécurité au niveau ligne
       activée. Ceci pourrait échouer si l'utilisateur n'a pas le droit
       d'insérer des lignes dans la table.
      </para>

      <para>
       Notez que cette option requiert aussi actuellement que la sauvegarde
       soit au format <command>INSERT</command> car <command>COPY
        FROM</command> n'est pas supportée par la sécurité au niveau ligne.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--if-exists</option></term>
     <listitem>
      <para>
       Utilise les commandes conditionnelles (autrement dit, ajoute la clause
       <literal>IF EXISTS</literal>) pour supprimer les objets. Cette option
       n'est pas valide, sauf si <option>--clean</option> est lui-aussi
       indiqué.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-comments</option></term>
     <listitem>
      <para>
       Ne génère pas les commande de restauration des commentaires même si
       l'archive les contient.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-data-for-failed-tables</option></term>
     <listitem>
      <para>
       Par défaut, les données de la table sont restaurées même si la commande
       de création de cette table a échoué (par exemple parce qu'elle existe
       déjà). Avec cette option, les données de cette table seront ignorées.
       Ce comportement est utile si la base cible contient déjà des données
       pour cette table. Par exemple, les tables supplémentaires des
       extensions de <productname>PostgreSQL</productname> comme
       <productname>PostGIS</productname> pourraient avoir déjà été créées et
       remplies sur la base cible&nbsp;; indiquer cette option empêche l'ajout
       de données dupliquées ou obsolètes.
      </para>

      <para>
       Cette option est seulement efficace lors de la restauration directe
       d'une base, pas lors de la réalisation d'une sortie de script SQL.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-publications</option></term>
     <listitem>
      <para>
       Ne pas afficher les commandes pour restaurer les publications,
       même si l'archive les contient.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-security-labels</option></term>
     <listitem>
      <para>
       Ne récupère pas les commandes de restauration des labels de sécurité,
       même si l'archive les contient.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-subscriptions</option></term>
     <listitem>
      <para>
       Ne pas afficher les commandes pour restaurer les souscriptions, même si
       l'archive les contient.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-tablespaces</option></term>
     <listitem>
      <para>
       Ne sélectionne pas les tablespaces. Avec cette option, tous les objets
       seront créés dans le tablespace par défaut lors de la restauration.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--section=<replaceable class="parameter">nom_section</replaceable></option></term>
     <listitem>
      <para>
       Restaure seulement la section nommée. Le nom de la section peut être
       <option>pre-data</option>, <option>data</option> ou
       <option>post-data</option>. Cette option peut être spécifiée plus d'une
       fois pour sélectionner plusieurs sections. La valeur par défaut est
       toutes les sections.
      </para>

      <para>
       La section data contient toutes les données des tables ainsi que la
       définition des Large Objects. Les éléments post-data consistent en la
       définition des index, triggers, règles et contraintes (autres que les
       contraintes de vérification). Les éléments pre-data consistent en tous
       les autres éléments de définition.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--strict-names</option></term>
     <listitem>
      <para>
       Requiert que chaque qualificateur de schéma (<option>-n</option> /
       <option>--schema</option>) et table (<option>-t</option> /
       <option>--table</option>) correspond à au moins un schéma/table dans le
       fichier de sauvegarde.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--use-set-session-authorization</option></term>
     <listitem>
      <para>
       Affiche les commandes <command>SET SESSION AUTHORIZATION</command> du
       standard SQL à la place des commandes <command>ALTER OWNER</command>
       pour déterminer le propriétaire de l'objet. Ceci rend la sauvegarde
       plus compatible avec les standards mais, suivant l'historique des
       objets dans la sauvegarde, pourrait restaurer correctement.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-?</option></term>
     <term><option>--help</option></term>
     <listitem>
      <para>
       Affiche l'aide sur les arguments en ligne de commande de
       <application>pg_restore</application>, puis quitte.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>

  <para>
   <application>pg_restore</application> accepte aussi les arguments suivants
   en ligne de commande pour les paramètres de connexion&nbsp;:

   <variablelist>
    <varlistentry>
     <term><option>-h <replaceable
       class="parameter">hôte</replaceable></option></term>
     <term><option>--host=<replaceable
       class="parameter">hôte</replaceable></option></term>
     <listitem>
      <para>
       Spécifie le nom d'hôte de la machine sur lequel le serveur est en cours
       d'exécution. Si la valeur commence par un slash, elle est utilisée
       comme répertoire du socket de domaine Unix. La valeur par défaut est
       prise dans la variable d'environnement <envar>PGHOST</envar>, si elle
       est initialisée, sinon une connexion socket de domaine Unix est tentée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-p <replaceable class="parameter">port</replaceable></option></term>
     <term><option>--port=<replaceable class="parameter">port</replaceable></option></term>
     <listitem>
      <para>
       Spécifie le port TCP ou l'extension du fichier socket de domaine Unix
       sur lequel le serveur écoute les connexions. Par défaut, l'outil
       utilise la variable d'environnement <envar>PGPORT</envar>, si elle est
       configurée, sinon il utilise la valeur indiquée à la compilation.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-U
       <replaceable>nom_utilisateur</replaceable></option></term>
     <term><option>--username=<replaceable class="parameter">nom_utilisateur</replaceable></option></term>
     <listitem>
      <para>
       Se connecte en tant que cet utilisateur
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-w</option></term>
     <term><option>--no-password</option></term>
     <listitem>
      <para>
       Ne demande jamais un mot de passe. Si le serveur en réclame un pour
       l'authentification et qu'un mot de passe n'est pas disponible d'une
       autre façon (par exemple avec le fichier <filename>.pgpass</filename>),
       la tentative de connexion échouera. Cette option peut être utile pour
       les scripts où aucun utilisateur n'est présent pour saisir un mot de
       passe.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-W</option></term>
     <term><option>--password</option></term>
     <listitem>
      <para>
       Force <application>pg_restore</application> à demander un mot de passe
       avant la connexion à une base de données.
      </para>

      <para>
       Cette option n'est jamais obligatoire car
       <application>pg_restore</application> demandera automatiquement un mot
       de passe si le serveur exige une authentification par mot de passe.
       Néanmoins, <application>pg_restore</application> perdra une tentative
       de connexion pour trouver que le serveur veut un mot de passe. Dans
       certains cas, il est préférable d'ajouter l'option <option>-W</option>
       pour éviter la tentative de connexion.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--role=<replaceable class="parameter">nom_rôle</replaceable></option></term>
     <listitem>
      <para>
       Indique un nom de rôle utilisé pour la restauration. Cette option fait
       que <application>pg_restore</application> exécute un <command>SET
        ROLE</command> <replaceable class="parameter">nom_rôle</replaceable>
       après connexion à la base de données. C'est utile quand l'utilisateur
       authentifié (indiqué par l'option <option>-U</option>) n'a pas les
       droits demandés par <application>pg_restore</application>, mais peut
       devenir le rôle qui a les droits requis. Certains installations ont une
       politique contre la connexion en super-utilisateur directement, et
       utilisent cette option pour permettre aux restaurations de se faire
       sans violer cette règle.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
 </refsect1>


 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGOPTIONS</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Paramètres de connexion par défaut
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>PG_COLOR</envar></term>
    <listitem>
     <para>
      Indique s'il faut utiliser les couleurs dans les messages de diagnostic.
      Les valeurs possibles sont <literal>always</literal>,
      <literal>auto</literal>, <literal>never</literal>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Cet outil, comme la plupart des autres outils
   <productname>PostgreSQL</productname>, utilise aussi les variables
   d'environnement supportées par la bibliothèque
   <application>libpq</application> (voir <xref linkend="libpq-envars"/>).
   Néanmoins, il ne lit pas la variable <envar>PGDATABASE</envar> quand le nom
   d'une base n'est pas fournie.
  </para>
 </refsect1>


 <refsect1 id="app-pgrestore-diagnostics">
  <title>Diagnostiques</title>

  <para>
   Quand une connexion directe à la base de données est spécifiée avec
   l'option <option>-d</option>, <application>pg_restore</application> exécute
   en interne des instructions <acronym>SQL</acronym>. Si vous avez des
   problèmes en exécutant <application>pg_restore</application>, assurez-vous
   d'être capable de sélectionner des informations à partir de la base de
   données en utilisant, par exemple à partir de <xref linkend="app-psql"/>.
   De plus, tout paramètre de connexion par défaut et toute variable
   d'environnement utilisé par la bibliothèque
   <application>libpq</application> s'appliqueront.
  </para>
 </refsect1>

 <refsect1 id="app-pgrestore-notes">
  <title>Notes</title>

  <para>
   Si votre installation dispose d'ajouts locaux à la base de données
   <literal>template1</literal>, faites attention à charger la sortie de
   <application>pg_restore</application> dans une base de données réellement
   vide&nbsp;; sinon, vous avez des risques d'obtenir des erreurs dûes aux
   définitions dupliquées des objets ajoutés. Pour créer une base de données
   vide sans ajout local, copiez à partir de <literal>template0</literal>, et
   non pas de <literal>template1</literal>, par exemple&nbsp;:
   <programlisting>CREATE DATABASE foo WITH TEMPLATE template0;
   </programlisting>
  </para>

  <para>
   Les limitations de <application>pg_restore</application> sont détaillées
   ci-dessous.

   <itemizedlist>
    <listitem>
     <para>
      Lors de la restauration des données dans une table pré-existante et que
      l'option <option>--disable-triggers</option> est utilisée,
      <application>pg_restore</application> émet des commandes pour désactiver
      les déclencheurs sur les tables utilisateur avant d'insérer les données,
      puis émet les commandes pour les réactiver après l'insertion des
      données. Si la restauration est stoppée en plein milieu, les catalogues
      système pourraient être abandonnés dans le mauvais état.
     </para>
    </listitem>

    <listitem>
     <para>
      <application>pg_restore</application> ne peut pas restaurer les « large
      objects » de façon sélective, par exemple seulement ceux d'une table
      précisée. Si une archive contient des « large objects », alors tous les
      « large objects » seront restaurées (ou aucun s'ils sont exclus avec
      l'option <option>-L</option>, l'option <option>-t</option> ou encore
      d'autres options.
     </para>
    </listitem>

   </itemizedlist>
  </para>

  <para>
   Voir aussi la documentation de <xref linkend="app-pgdump"/> pour les
   détails sur les limitations de <application>pg_dump</application>.
  </para>

  <para>
   Une fois la restauration terminée, il est conseillé de lancer
   <command>ANALYZE</command> sur chaque table restaurée de façon à ce que
   l'optimiseur dispose de statistiques utiles&nbsp;; voir <xref
   linkend="vacuum-for-statistics"/> et <xref linkend="autovacuum"/> pour plus
   d'informations.
  </para>

 </refsect1>

 <refsect1 id="app-pgrestore-examples">
  <title>Exemples</title>

  <para>
   Supposons que nous avons sauvegardé une base nommée
   <literal>ma_base</literal> dans un fichier de sauvegarde au format
   personnalisé&nbsp;:

   <screen>
<prompt>$</prompt> <userinput>pg_dump -Fc ma_base &gt; ma_base.dump</userinput>
   </screen>
  </para>

  <para>
   Pour supprimer la base et la re-créer à partir de la sauvegarde&nbsp;:

   <screen>
<prompt>$</prompt> <userinput>dropdb ma_base</userinput>
<prompt>$</prompt> <userinput>pg_restore -C -d postgres ma_base.dump</userinput>
   </screen>

   La base nommée avec l'option <option>-d</option> peut être toute base de
   données existante dans le cluster&nbsp;;
   <application>pg_restore</application> l'utilise seulement pour exécuter la
   commande <command>CREATE DATABASE</command> pour
   <literal>ma_base</literal>.  Avec <option>-C</option>, les données sont
   toujours restaurées dans le nom de la base qui apparaît dans le fichier de
   sauvegarde.
  </para>

  <para>
   Pour charger la sauvegarde dans une nouvelle base nommée
   <literal>nouvelle_base</literal>&nbsp;:

   <screen>
<prompt>$</prompt> <userinput>createdb -T template0 newdb</userinput>
<prompt>$</prompt> <userinput>pg_restore -d newdb db.dump</userinput>
   </screen>

   Notez que nous n'utilisons pas <option>-C</option> et que nous nous sommes
   connectés directement sur la base à restaurer. De plus, notez que nous
   clonons la nouvelle base à partir de <literal>template0</literal> et non
   pas de <literal>template1</literal>, pour s'assurer qu'elle est vide.
  </para>

  <para>
   Pour réordonner les éléments de la base de données, il est tout d'abord
   nécessaire de sauvegarder la table des matières de l'archive&nbsp;:
   <screen><prompt>$</prompt> <userinput>pg_restore -l ma_base.dump &gt; ma_base.liste</userinput>
   </screen>
   Le fichier de liste consiste en un en-tête et d'une ligne par élément, par
   exemple&nbsp;:
   <programlisting>;
; Archive created at Mon Sep 14 13:55:39 2009
;     dbname: DBDEMOS
;     TOC Entries: 81
;     Compression: 9
;     Dump Version: 1.10-0
;     Format: CUSTOM
;     Integer: 4 bytes
;     Offset: 8 bytes
;     Dumped from database version: 8.3.5
;     Dumped by pg_dump version: 8.3.8
;
;
; Selected TOC Entries:
;
3; 2615 2200 SCHEMA - public pasha
1861; 0 0 COMMENT - SCHEMA public pasha
1862; 0 0 ACL - public pasha
317; 1247 17715 TYPE public composite pasha
319; 1247 25899 DOMAIN public domain0 pasha
   </programlisting>
   Les points virgules commencent un commentaire et les numéros au début des
   lignes se réfèrent à l'ID d'archive interne affectée à chaque élément.
  </para>

  <para>
   Les lignes dans le fichier peuvent être commentées, supprimées et
   réordonnées. Par exemple&nbsp;:
   <programlisting>10; 145433 TABLE map_resolutions postgres
;2; 145344 TABLE species postgres
;4; 145359 TABLE nt_header postgres
6; 145402 TABLE species_records postgres
;8; 145416 TABLE ss_old postgres
   </programlisting>
   peut être utilisé en entrée de <application>pg_restore</application> et ne
   restaure que les éléments 10 et 6 dans cet ordre&nbsp;:
   <screen><prompt>$</prompt> <userinput>pg_restore -L mabase.liste mabase.fichier</userinput>
   </screen>
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="app-pgdump"/></member>
   <member><xref linkend="app-pg-dumpall"/></member>
   <member><xref linkend="app-psql"/></member>
  </simplelist>
 </refsect1>
</refentry>
