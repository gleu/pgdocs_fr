<?xml version="1.0" encoding="UTF-8"?>
<!-- Dernière modification
     le       $Date$
     par      $Author$
     révision $Revision$ -->

<refentry id="app-pgdump">
 <refmeta>
  <refentrytitle>pg_dump</refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_dump</refname>

  <refpurpose>
   sauvegarder une base de données <productname>PostgreSQL</productname> dans un
   script ou tout autre fichier d'archive
  </refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_dump</command>
   <arg rep="repeat"><replaceable>option_connexion</replaceable></arg>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
   <arg choice="opt"><replaceable>nom_base</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>


 <refsect1 id="pg-dump-description">
  <title>
   Description
  </title>
  <indexterm zone="app-pgdump">
   <primary>pg_dump</primary>
  </indexterm>


  <para>
   <application>pg_dump</application> est un outil de sauvegarde d'une base de
   données <productname>PostgreSQL</productname>. Les sauvegardes 
   réalisées sont cohérentes, même lors d'accès concurrents à la base de données.
   <application>pg_dump</application> ne bloque pas l'accès des autres
   utilisateurs (ni en lecture ni en écriture).
  </para>

  <para>
   Les extractions peuvent être réalisées sous la forme de scripts ou de fichiers d'archive.
   Les scripts sont au format texte et contiennent les commandes SQL
   nécessaires à la reconstruction de la base de données dans l'état où elle était au
   moment de la sauvegarde. La restauration s'effectue en chargeant ces scrits avec
   <xref linkend="app-psql"/>. Ces scripts permettent de reconstruire la base de
   données sur d'autres machines et d'autres architectures, et même, au prix de
   quelques modifications, sur d'autres bases de données SQL.
  </para>

  <para>
   La reconstruction de la base de données à partir d'autres formats de fichiers archive
   est obtenue avec <xref linkend="app-pgrestore"/>. 
   <application>pg_restore</application> permet, à partir de ces formats, de sélectionner
   les éléments à restaurer, voire de les réordonner avant restauration.
   Les fichiers d'archive sont conçus pour être portables au travers d'architectures différentes.
  </para>

  <para>
   Utilisé avec un des formats de fichier d'archive et combiné
   avec <application>pg_restore</application>,
   <application>pg_dump</application> fournit un mécanisme d'archivage
   et de transfert flexible. <application>pg_dump</application> peut être utilisé pour
   sauvegarder une base de données dans son intégralité&nbsp;;
   <application>pg_restore</application> peut alors être utilisé pour examiner
   l'archive et/ou sélectionner les parties de la base de données à
   restaurer. Le format de fichier de sortie le plus flexible est le format
   <quote>personnalisé</quote> (<foreignphrase>custom</foreignphrase> en anglais, <option>-Fc</option>).
   Compressé par défaut, il permet de sélectionner et réordonner les éléments archivés.
  </para>

  <para>
   Lors de l'exécution de <application>pg_dump</application>, il est utile de 
   surveiller les messages d'avertissement (affichés sur la sortie erreur standard), 
   en particulier en ce qui concerne les limitations indiquées ci-dessous.
  </para>

 </refsect1>

 <refsect1 id="pg-dump-options">
  <title>Options</title>

  <para>
   Les options suivantes de la ligne de commande contrôlent le contenu et le
   format de la sortie.

    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">nom_base</replaceable></term>
      <listitem>
       <para>
	Le nom de la base de données à sauvegarder. En l'absence de précision, 
	la variable d'environnement <envar>PGDATABASE</envar> est utilisée. 
        Si cette variable n'est pas positionnée, le nom de l'utilisateur de la connexion est utilisé.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-a</option></term>
      <term><option>--data-only</option></term>
      <listitem>
       <para>
        Seules les données sont sauvegardées, pas le schéma (définition des données).
        Les données des tables, les Large Objects, et les valeurs des séquences
        sont sauvegardées.
       </para>

       <para>
        Cette option est similaire à <option>--section=data</option> mais, pour
        des raisons historiques, elle n'est pas identique.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-b</option></term>
      <term><option>--blobs</option></term>
      <listitem>
       <para>
        Inclut les objets larges dans la sauvegarde. C'est le comportement par
        défaut, sauf si une des options suivantes est ajoutée&nbsp;:
        <option>--schema</option>, <option>--table</option> ou
        <option>--schema-only</option>. L'option <option>-b</option>
        n'est utile que pour ajouter les objets larges aux
        sauvegardes sélectives.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-c</option></term>
      <term><option>--clean</option></term>
      <listitem>
       <para>
        Les commandes de nettoyage (suppression) des objets de la base
        sont écrites avant les commandes de création.
        (La restauration peut générer des erreurs sans gravité.)
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte. Pour les
	formats archive, l'option est précisée à l'appel de
	<command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-C</option></term>
      <term><option>--create</option></term>
      <listitem>
       <para>
        La sortie débute par une commande de création de la base de données
	et de connexion à cette base. Peu importe, dans ce cas, la base de données
        à laquelle la connexion est faite avant la restauration.
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte. Pour les
	formats archive, l'option est précisée à l'appel de
	<command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-f <replaceable class="parameter">file</replaceable></option></term>
      <term><option>--file=<replaceable class="parameter">file</replaceable></option></term>
      <listitem>
       <para>
        La sortie est redirigée vers le fichier indiqué. Ce paramètre peut être omis pour les sorties
        en mode fichier, dans ce cas la sortie standard sera utilisée.
        Par contre, il doit être fourni pour le format 'directory' (répertoire), où
        il spécifie le répertoire cible plutôt qu'un fichier. Dans ce cas, le répertoire est
        créé par <command>pg_dump</command> et ne doit pas exister auparavant.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
	  <term><option>-E <replaceable class="parameter">codage</replaceable></option></term>
	  <term><option>--encoding=<replaceable class="parameter">codage</replaceable></option></term>
	  <listitem>
	   <para>
	    La sauvegarde est créée dans l'encodage indiqué. Par défaut, la sauvegarde utilise celui
	    de la base de données. Le même résultat peut être obtenu en positionnant 
	    la variable d'environnement <envar>PGCLIENTENCODING</envar> avec le codage désiré pour la
	    sauvegarde.
	   </para>
	  </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-F <replaceable class="parameter">format</replaceable></option></term>
      <term><option>--format=<replaceable class="parameter">format</replaceable></option></term>
      <listitem>
       <para>
        Le format de la sortie.
	    <replaceable>format</replaceable> correspond à un des éléments suivants&nbsp;:

       <variablelist>
        <varlistentry>
         <term><literal>p</literal></term>
         <listitem>
          <para>
           fichier de scripts <acronym>SQL</acronym> en texte simple
	   (défaut)&nbsp;;
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>c</literal></term>
         <listitem>
          <para>
           archive personnalisée utilisable par <application>pg_restore</application>.
	   Avec le format de sortie répertoire, c'est le format le plus souple, car
	   il permet la sélection manuelle et le réordonnancement des objets archivés
	   au moment de la restauration. Ce format est aussi compressé par défaut.
           default.
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>d</literal></term>
         <term><literal>directory</literal></term>
         <listitem>
          <para>
	   Produire une archive au format répertoire utilisable en entrée
	   de de <application>pg_restore</application>. Cela créera un répertoire
	   avec un fichier pour chaque table et blob exporté, ainsi qu'un fichier appelé
	   Table of Contents (Table des matières) décrivant les objets exportés dans
	   un format machine que <application>pg_restore</application> peut lire. Une
	   archive au format répertoire peut être manipulée avec des outils Unix standard;
	   par exemple, les fichiers d'une archive non-compressée peuvent être compressés avec
	   l'outil <application>gzip</application>. Ce format est compressé par défaut.
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>t</literal></term>
         <listitem>
          <para>
           archive <command>tar</command> utilisable par <application>pg_restore</application>.
	   Le format tar est compatible avec le format répertoire; l'extraction d'une archive au
	   format tar produit une archive au format répertoire valide.
	   Toutefois, le format tar ne supporte pas la compression et a une limite de 8Go sur
	   la taille des tables individuelles. Par ailleurs, l'ordre de restauration des données
	   des tables ne peut pas être changé au moment de la restauration.
          </para>
         </listitem>
        </varlistentry>

       </variablelist>
       </para>

      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-i</option></term>
      <term><option>--ignore-version</option></term>
      <listitem>
       <para>
        Une option obsolète qui est maintenant ignorée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-n <replaceable class="parameter">schéma</replaceable></option></term>
      <term><option>--schema=<replaceable class="parameter">schéma</replaceable></option></term>
      <listitem>
       <para>
        Sauvegarde uniquement les schémas correspondant à <replaceable
        class="parameter">schema</replaceable>&nbsp;; la sélection se fait à
        la fois sur le schéma et sur les objets qu'il contient. Quand cette
        option n'est pas indiquée, tous les schémas non système de la base cible
        sont sauvegardés. Plusieurs schémas peuvent être indiqués en utilisant
        plusieurs fois l'option <option>-n</option>. De plus, le paramètre
        <replaceable class="parameter">schéma</replaceable> est interprété comme
        un modèle selon les règles utilisées par les commandes
        <literal>\d</literal> de <application>psql</application> (voir <xref
        linkend="app-psql-patterns"/>). Du
        coup, plusieurs schémas peuvent être sélectionnés en utilisant des
        caractères joker dans le modèle. Lors de l'utilisation de ces caractères,
        il faut faire attention à placer le modèle entre guillemets, si
	    nécessaire, pour empêcher le shell de remplacer les jokers;  see
        <xref linkend="pg-dump-examples" endterm="pg-dump-examples-title"/>.
       </para>

       <note>
        <para>
         Quand <option>-n</option> est indiqué, <application>pg_dump</application>
         ne sauvegarde aucun autre objet de la base que ceux dont les schémas
         sélectionnés dépendent. Du coup, il n'est pas garanti que la sauvegarde
         d'un schéma puisse être restaurée avec succès dans une base vide.
        </para>
       </note>

       <note>
        <para>
         Les objets qui ne font pas partie du schéma comme les objets larges ne
         sont pas sauvegardés quand <option>-n</option> est précisé. Ils
	 peuvent être rajouter avec l'option <option>--blobs</option>.
        </para>
       </note>

      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-N <replaceable class="parameter">schéma</replaceable></option></term>
      <term><option>--exclude-schema=<replaceable class="parameter">schéma</replaceable></option></term>
      <listitem>
       <para>
        Ne sauvegarde pas les schémas correspondant au modèle <replaceable
        class="parameter">schéma</replaceable>. Le modèle est interprété selon
        les même règles que <option>-n</option>. <option>-N</option> peut aussi
        être indiqué plus d'une fois pour exclure des schémas correspondant à
        des modèles différents.
       </para>

       <para>
        Quand les options <option>-n</option> et <option>-N</option> sont
        indiquées, seuls sont sauvegardés les schémas qui correspondent à au moins
        une option <option>-n</option> et à aucune option
        <option>-N</option>. Si <option>-N</option> apparaît sans
        <option>-n</option>, alors les schémas correspondant à <option>-N</option>
        sont exclus de ce qui est une sauvegarde normale.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o</option></term>
      <term><option>--oids</option></term>
      <listitem>
       <para>
	Les identifiants d'objets (<acronym>OID</acronym>) sont sauvegardés comme
	données des tables. Cette option est utilisée dans le cas d'applications
	utilisant des références aux colonnes <acronym>OID</acronym> 
	(dans une contrainte de clé étrangère, par exemple). Elle ne devrait pas être
	utilisée dans les autres cas.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-O</option></term>
      <term><option>--no-owner</option></term>
      <listitem>
       <para>
        Les commandes d'initialisation des possessions des objets au regard de
	la base de données originale ne sont pas produites. Par défaut, 
	<application>pg_dump</application> engendre des instructions
	<command>ALTER OWNER</command> ou 
	<command>SET SESSION AUTHORIZATION</command> pour
	fixer ces possessions. 
	Ces instructions échouent lorsque le script n'est pas
	lancé par un superutilisateur (ou par l'utilisateur
	qui possède tous les objets de ce script). L'option <option>-O</option>
	est utilisée pour créer un script qui puisse être restauré par n'importe 
	quel utilisateur. En revanche, c'est cet utilisateur qui devient 
	propriétaire de tous les objets.
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte.
	Pour les formats archive, l'option est précisée à l'appel de <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-R</option></term>
      <term><option>--no-reconnect</option></term>
      <listitem>
       <para>
        Cette option, obsolète, est toujours acceptée pour des raisons
	de compatibilité ascendante.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <term><option>--schema-only</option></term>
      <listitem>
       <para>
	Seule la définition des objets (le schéma) est sauvegardée, pas les
	données.
       </para>
       <para>
        Cette option est l'inverse de <option>--data-only</option>. Elle est
        similaire, mais pas identique (pour des raisons historiques), à
        <option>--section=pre-data --section=post-data</option>.
        </para>
        <para>
        (Ne pas la confondre avec l'option <option>--schema</option> qui utilise
        le mot <quote>schema</quote> dans un contexte différent.)
       </para>
       <para>
        Pour exclure les données de la table pour seulement un sous-ensemble des
        tables de la base de données, voir <option>--exclude-table-data</option>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S <replaceable 	class="parameter">nomutilisateur</replaceable></option></term>
      <term><option>--superuser=<replaceable 	class="parameter">nomutilisateur</replaceable></option></term>
      <listitem>
       <para>
        Le nom du superutilisateur à utiliser lors de la désactivation
	des déclencheurs. Cela n'a d'intérêt que si l'option
	<option>--disable-triggers</option> est précisée. (En règle générale, 
	il est préférable de ne pas utiliser cette option et de lancer le script
	produit en tant que superutilisateur.)
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-t <replaceable class="parameter">table</replaceable></option></term>
      <term><option>--table=<replaceable class="parameter">table</replaceable></option></term>
      <listitem>
       <para>
        Sauvegarde uniquement les tables (ou vues ou séquences or tables distantes) correspondant
        à <replaceable class="parameter">table</replaceable>. Plusieurs tables
        sont sélectionnables en utilisant plusieurs fois l'option
        <option>-t</option>. De plus, le paramètre
        <replaceable class="parameter">table</replaceable> est interprété comme
        un modèle suivant les règles utilisées par les commandes
        <literal>\d</literal> de <application>psql</application> (voir <xref
        linkend="app-psql-patterns"/>). Du
        coup, plusieurs tables peuvent être sélectionnées en utilisant des
        caractères joker dans le modèle. Lors de l'utilisation de ces caractères,
        il faut faire attention à placer le modèle entre guillemets, si
        nécessaire, pour empêcher le shell de remplacer les jokers;  see
        <xref linkend="pg-dump-examples" endterm="pg-dump-examples-title"/>.
       </para>

       <para>
        Les options <option>-n</option> et <option>-N</option> n'ont aucun effet
        quand l'option <option>-t</option> est utilisée car les tables
        sélectionnées par <option>-t</option> sont sauvegardées quelle que soit
        la valeur des options relatives aux schémas. Les objets qui ne sont
        pas des tables ne sont pas sauvegardés.
       </para>

       <note>
        <para>
         Quand <option>-t</option> est indiqué, <application>pg_dump</application>
         ne sauvegarde aucun autre objet de la base dont la (ou les) table(s)
         sélectionnée(s) pourrai(en)t dépendre. Du coup, il n'est pas garanti que la sauvegarde
         spécifique d'une table puisse être restaurée avec succès dans une base vide.
        </para>
       </note>

       <note>
        <para>
         Le comportement de l'option <option>-t</option> n'est pas entièrement
         compatible avec les versions de <productname>PostgreSQL</productname>
         antérieures à la 8.2. Auparavant, écrire <literal>-t tab</literal>
         sauvegardait toutes les tables nommées <literal>tab</literal>, mais
         maintenant, seules sont sauvegardées celles qui sont visibles dans le
         chemin de recherche des objets. Pour retrouver l'ancien comportement,
	 il faut écrire <literal>-t '*.tab'</literal>. De plus, il faut
         écrire quelque chose comme <literal>-t sch.tab</literal> pour sélectionner
         une table dans un schéma particulier plutôt que l'ancienne syntaxe
         <literal>-n sch -t tab</literal>.
        </para>
       </note>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-T <replaceable class="parameter">table</replaceable></option></term>
      <term><option>--exclude-table=<replaceable class="parameter">table</replaceable></option></term>
      <listitem>
       <para>
        Ne sauvegarde pas les tables correspondant au modèle <replaceable
        class="parameter">table</replaceable>. Le modèle est interprété selon
        les même règles que <option>-t</option>. <option>-T</option> peut aussi
        être indiqué plusieurs pour exclure des tables correspondant à
        des modèles différents.
       </para>

       <para>
        Quand les options <option>-t</option> et <option>-T</option> sont
        indiquées, seules sont sauvegardées les tables qui correspondent à au moins
        une option <option>-t</option> et à aucune option
        <option>-T</option>. Si <option>-T</option> apparaît sans
        <option>-t</option>, alors les tables correspondant à <option>-T</option>
        sont exclues de ce qui est une sauvegarde normale.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-v</option></term>
      <term><option>--verbose</option></term>
      <listitem>
       <para>
	Mode verbeux. <application>pg_dump</application> affiche des commentaires
	détaillés sur les objets et les heures de début et de fin dans le fichier de
	sauvegarde. Des messages de progression sont également affichés sur la 
	sortie d'erreur standard.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
       <term><option>-V</option></term>
       <term><option>--version</option></term>
       <listitem>
       <para>
         Affiche la version de <application>pg_dump</application> puis
         quitte.
       </para>
       </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-x</option></term>
      <term><option>--no-privileges</option></term>
      <term><option>--no-acl</option></term>
      <listitem>
       <para>
	Les droits d'accès (commandes grant/revoke) ne sont pas sauvegardés.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-Z <replaceable class="parameter">0..9</replaceable></option></term>
      <term><option>--compress=<replaceable class="parameter">0..9</replaceable></option></term>
      <listitem>
       <para>
        Indique le niveau de compression à utiliser. Zéro signifie sans
        compression. Pour le format d'archive personnalisé, cela signifie la
        compression des segments individuels des données des tables. Par
	défaut, la compression se fait à un niveau modéré. Pour le format texte,
        indiquer une valeur différente de zéro implique une compression du
	fichier complet, comme s'il était passé à 
        <application>gzip</application>&nbsp;; mais par défaut, la sortie n'est
        pas compressée. Le format d'archive tar ne supporte pas du tout la
        compression.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--binary-upgrade</option></term>
      <listitem>
       <para>
        Cette option est destinée à être utilisée pour une mise à jour en ligne.
        Son utilisation dans d'autres buts n'est ni recommandée ni supportée.
        Le comportement de cette option peut changer dans les futures versions
        sans avertissement.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--column-inserts</option></term>
      <term><option>--attribute-inserts</option></term>
      <listitem>
       <para>
        Extraire les données en tant que commandes <command>INSERT</command>
        avec des noms de colonnes explicites (<literal>INSERT INTO
        <replaceable>table</replaceable>
        (<replaceable>colonne</replaceable>, ...) VALUES
        ...</literal>). Ceci rendra la restauration très lente&nbsp;;
        c'est surtout utile pour créer des extractions qui
        puissent être chargées dans des bases de données autres que
	<productname>PostgreSQL</productname>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--disable-dollar-quoting</option></term>
      <listitem>
       <para>
        Cette option désactive l'utilisation du caractère dollar comme délimiteur
        de corps de fonctions, et force leur délimitation en tant que chaîne
        SQL standard.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--disable-triggers</option></term>
      <listitem>
       <para>
        Cette option ne s'applique que dans le cas d'une extraction de données
        seules. Ceci demande à <application>pg_dump</application> d'inclure
        des commandes pour désactiver temporairement les triggers sur les tables
        cibles pendant que les données sont rechargées. Utilisez ceci si, sur les
        tables, vous avez des contraintes d'intégrité ou des triggers que vous ne
        voulez pas invoquer pendant le rechargement.
       </para>

       <para>
        À l'heure actuelle, les commandes émises pour <option>--disable-triggers</option>
        doivent être exécutées en tant que superutilisateur. Par conséquent,
        vous devez aussi spécifier un nom de superutilisateur avec <option>-S</option>,
        ou préférablement faire attention à lancer le script résultat en tant que
        superutilisateur.
       </para>

       <para>
        Cette option n'a de sens que pour le format texte simple. Pour les formats
        d'archive, vous pouvez spécifier cette option quand vous appelez
        <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--exclude-table-data=<replaceable class="parameter">table</replaceable></option></term>
      <listitem>
       <para>
        Ne sauvegarde pas les données pour toute table correspondant au motif
        indiqué par <replaceable class="parameter">table</replaceable>. Le motif
        est interprété selon les même règles que pour l'option <option>-t</option>.
        <option>--exclude-table-data</option> peut être utilisé plusieurs fois
        pour exclure des tables dont le nom correspond à des motifs différents.
        Cette option est utile quand vous avez besoin de la définition d'une
        table particulière mais pas de ses données.
       </para>
       <para>
        Pour exclure les données de toutes les tables de la base, voir
        <option>--schema-only</option>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--inserts</option></term>
      <listitem>
       <para>
        Extraire les données en tant que commandes <command>INSERT</command>
        (plutôt que <command>COPY</command>). Ceci rendra la restauration très
        lente&nbsp;; c'est surtout utile pour créer des extractions qui
        puissent être chargées dans des bases de données autres que
	<productname>PostgreSQL</productname>.
        Notez que la restauration peut échouer complètement si vous avez changé
        l'ordre des colonnes. L'option <option>--column-inserts</option> est
        plus sûre, mais encore plus lente.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--lock-wait-timeout=<replaceable class="parameter">expiration</replaceable></option></term>
      <listitem>
       <para>
        Ne pas attendre indéfiniment l'acquisition de verrous partagés
        sur table au démarrage de l'extraction. Échouer à la place s'il est
        impossible de verrouiller une table dans le temps
        d'<replaceable class="parameter">expiration</replaceable> indiqué.
        L'expiration peut être spécifiée dans tous les formats acceptés par
        <command>SET statement_timeout</command>, les valeurs autorisées dépendant
        de la version du serveur sur laquelle vous faites l'extraction, mais
        une valeur entière en millisecondes est acceptée par toutes les versions
        depuis la 7.3. Cette option est ignorée si vous exportez d'une version
        antérieure à la 7.3.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--no-security-labels</option></term>
      <listitem>
       <para>
        Ne sauvegarde pas les labels de sécurité.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--no-tablespaces</option></term>
      <listitem>
       <para>
        Ne pas générer de commandes pour créer des tablespace, ni sélectionner
        de tablespace pour les objets.
        Avec cette option, tous les objets seront créés dans le tablespace
        par défaut durant la restauration.
       </para>

       <para>
        Cette option n'a de sens que pour le format texte simple. Pour les formats
        d'archive, vous pouvez spécifier cette option quand vous appelez
        <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

      <varlistentry>
      <term><option>--no-unlogged-table-data</option></term>
      <listitem>
       <para>
        Ne pas exporter le contenu des tables non journalisées (unlogged). Cette
	option n'a aucun effet sur le fait que la définition (schéma) des tables
	soit exportée ou non; seul l'export des données de la table est supprimé.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--quote-all-identifiers</option></term>
      <listitem>
       <para>
        Force la mise entre guillemets de tous les identifiants. Ceci peut être utile
	si vous exportez votre base en vue d'une migration dans une nouvelle version qui
	aurait introduit de nouveaux mots clés.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
       <term><option>--section=<replaceable class="parameter">sectionname</replaceable></option></term>
       <listitem>
         <para>
          Sauvegarde seulement la section nommée. Le nom de la section peut être
          <option>pre-data</option>, <option>data</option> ou
          <option>post-data</option>. Cette option peut être spécifiée plus
          d'une fois pour sélectionner plusieurs sections. La valeur par
          défaut est toutes les sections.
         </para>
         <para>
          La section data contient toutes les données des tables ainsi que la
          définition des Large Objects. Les éléments post-data consistent en la
          définition des index, triggers, règles et constraintes (autres que
          les contraintes de vérification). Les éléments pre-data consistent en
          tous les autres éléments de définition.
         </para>
       </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--serializable-deferrable</option></term>
      <listitem>
       <para>
        Utiliser une transaction <literal>sérialisable</literal> pour l'export,
	pour garantir que l'instantané utilisé est cohérent avec les états futurs
	de la base; mais ceci est effectué par l'attente d'un point dans le flux
	des transactions auquel aucune anomalie ne puisse être présente,
	afin qu'il n'y ait aucun risque que l'export échoue ou cause l'annulation
	d'une autre transaction pour <literal>erreur de sérialisation</literal>.
	Voyez <xref linkend="mvcc"/> pour davantage d'informations sur l'isolation
	des transactions et le contrôle d'accès concurrent.
       </para>

       <para>
        Cette option est inutile pour un dump qui ne sera utilisé qu'en cas
	de récupération après sinistre. Elle pourrait être utile pour un dump
	utilisé pour charger une copie de la base pour du reporting ou toute
	autre activité en lecture seule tandis que la base originale continue à
	être mise à jour. Sans cela, le dump serait dans un état incohérent
	avec l'exécution sérielle des transactions qui auront été finalement
	validées. Par exemple, si un traitement de type batch est exécuté, un
	batch pourrait apparaître comme terminé dans le dump sans que tous les
	éléments du batch n'apparaissent.
       </para>

       <para>
        Cette option ne fera aucune différence si aucune transaction
	en lecture-écriture n'est active au lancement de pg_dupm. Si des transactions
	en lecture-écriture sont actives, le démarrage du dump pourrait être retardé
	pour une durée indéterminée. Une fois qu'il sera démarré, la performance est
	identique à celle d'un dump sans cette option.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--use-set-session-authorization</option></term>
      <listitem>
       <para>
        Émettre des commandes SQL standard <command>SET SESSION AUTHORIZATION</command>
        à la place de commandes <command>ALTER OWNER</command> pour déterminer
        l'appartenance d'objet. Ceci rend l'extraction davantage compatible
        avec les standards, mais, suivant l'historique des objets de l'extraction,
        peut ne pas se restaurer correctement. Par ailleurs, une extraction
        utilisant <command>SET SESSION AUTHORIZATION</command> nécessitera
        certainement des droits superutilisateur pour se restaurer correctement,
        alors que <command>ALTER OWNER</command> nécessite des droits moins
        élevés.
       </para>
      </listitem>
     </varlistentry>

    <varlistentry>
      <term><option>-?</option></term>
      <term><option>--help</option></term>
      <listitem>
      <para>
        Affiche l'aide sur les arguments en ligne de commande de
        <application>pg_dump</application>, puis quitte
      </para>
      </listitem>
    </varlistentry>
    </variablelist>
   </para>

   <para>
    Les options de ligne de commande suivantes gèrent les paramètres de connexion&nbsp;:

    <variablelist>
     <varlistentry>
      <term><option>-h <replaceable	class="parameter">hôte</replaceable></option></term>
      <term><option>--host <replaceable	class="parameter">hôte</replaceable></option></term>
      <listitem>
       <para>
        Le nom d'hôte de la machine sur laquelle le serveur de bases
        de données est exécuté. Si la valeur commence par une barre oblique (/),
        elle est utilisée comme répertoire pour le socket de domaine Unix.
	La valeur par défaut est fournie par la variable d'environnement
	<envar>PGHOST</envar>, si elle est initialisée. Dans le cas contraire, 
	une connexion sur la socket de domaine Unix est tentée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-p <replaceable class="parameter">port</replaceable></option></term>
      <term><option>--port <replaceable class="parameter">port</replaceable></option></term>
      <listitem>
       <para>
        Le port TCP ou le fichier local de socket de domaine Unix
        sur lequel le serveur écoute les connexions.
	La valeur par défaut est fournie par la variable d'environnement
	<envar>PGPORT</envar>, si elle est initialisée. Dans le cas contraire,
	il s'agit de la valeur fournie à la compilation.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-U <replaceable class="parameter">nomutilisateur</replaceable></option></term>
      <term><option>--username <replaceable class="parameter">nomutilisateur</replaceable></option></term>
      <listitem>
       <para>
        Le nom d'utilisateur utilisé pour la connexion.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-w</option></term>
      <term><option>--no-password</option></term>
      <listitem>
       <para>
        Ne demande jamais un mot de passe. Si le serveur en réclame un pour
        l'authentification et qu'un mot de passe n'est pas disponible d'une autre
        façon (par exemple avec le fichier <filename>.pgpass</filename>), la
        tentative de connexion échouera. Cette option peut être utile pour les
        scripts où aucun utilisateur n'est présent pour saisir un mot de passe.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-W</option></term>
      <term><option>--password</option></term>
      <listitem>
       <para>
        Force <application>pg_dump</application> à demander un mot de passe
	avant la connexion à une base de données.
       </para>

       <para>
        Cette option n'est jamais nécessaire car
        <application>pg_dump</application> demande automatiquement un
	mot de passe si le serveur exige une authentification par mot de
	passe. Néanmoins, <application>pg_dump</application> perd une
	tentative de connexion pour tester si le serveur demande un mot de
	passe. Dans certains cas, il est préférable d'ajouter l'option
        <option>-W</option> pour éviter la tentative de connexion.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--role=<replaceable class="parameter">nomrole</replaceable></option></term>
      <listitem>
       <para>
        Spécifie un rôle à utiliser pour créer l'extraction.
        Avec cette option, <application>pg_dump</application> émet une commande
        <command>SET ROLE</command> <replaceable
        class="parameter">nomrole</replaceable> après s'être connecté à la base.
        C'est utile quand l'utilisateur authentifié (indiqué par
        <option>-U</option>) n'a pas les droits dont <application>pg_dump</application>
        a besoin, mais peut basculer vers un rôle qui les a. Certaines installations
        ont une politique qui est contre se connecter directement en tant que superutilisateur,
        et l'utilisation de cette option permet que les extractions soient
        faites sans violer cette politique.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>
 </refsect1>

 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGDATABASE</envar></term>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGOPTIONS</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Paramètres de connexion par défaut.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Cet outil, comme la plupart des autres outils <productname>PostgreSQL</productname>,
   utilise les variables d'environnement supportées par la bibliothèque
   <application>libpq</application> (voir <xref linkend="libpq-envars"/>).
  </para>

 </refsect1>

 <refsect1 id="app-pgdump-diagnostics">
  <title>Diagnostiques</title>

  <para>
   <application>pg_dump</application> exécute intrinsèquement des instructions
   <command>SELECT</command>. Si des problèmes apparaissent à l'exécution de
   <application>pg_dump</application>, <xref linkend="app-psql"/> peut être 
   utilisé pour s'assurer qu'il est possible de sélectionner des informations
   dans la base de données. De plus,
   tout paramètre de connexion par défaut et toute variable d'environnement
   utilisé par la bibliothèque <application>libpq</application> s'appliquent.
  </para>

  <para>
   L'activité générée par <application>pg_dump</application> dans la base de
   données est normalement collectée par le collecteur de statistiques. Si c'est
   gênant, vous pouvez positionner le paramètre <varname>track_counts</varname>
   à false via <envar>PGOPTIONS</envar> ou la commande <literal>ALTER USER</literal>.
  </para>
 </refsect1>


 <refsect1 id="pg-dump-notes">
  <title>Notes</title>

  <para>
   Si des ajouts locaux à la base <literal>template1</literal> ont été
   effectués, il est impératif de s'assurer que la 
   sortie de <application>pg_dump</application> est effectivement restaurée
   dans une base vide&nbsp;; dans le cas contraire, il est fort probable 
   que la duplication des définitions des objets ajoutés engendre des erreurs.
   Pour obtenir une base vide de tout ajout local, on utilise <literal>template0</literal>
   à la place de <literal>template1</literal> comme modèle.
   Par exemple&nbsp;:
<programlisting>CREATE DATABASE foo WITH TEMPLATE template0;
</programlisting>
  </para>

  <para>
   Quand une sauvegarde des seules données est sélectionnée et que l'option
   <option>--disable-triggers</option> est utilisée,
   <application>pg_dump</application> engendre des commandes de désactivation
   des déclencheurs sur les tables utilisateur avant l'insertion des données, puis
   après coup, des commandes de réactivation après l'insertion. Si la restauration est
   interrompue, il se peut que les catalogues systèmes conservent cette
   position.
  </para>

  <para>
   Les fichiers d'une archive tar sont limités à une taille inférieure à
   8&nbsp;Go. (C'est une limitation inhérente au format des fichiers tar.) 
   Ce format ne peut donc pas être utilisé si la représentation textuelle
   d'une table dépasse cette taille. La taille totale d'une archive tar et de
   tout autre format de sortie n'est pas limitée, sauf peut-être par le système
   d'exploitation.
  </para>

  <para>
   Le fichier de sauvegarde produit par <application>pg_dump</application> ne
   contient pas les statistiques utilisées par l'optimiseur pour la
   planification des requêtes. Il est donc conseillé, pour assurer des
   performances optimales, de lancer <command>ANALYZE</command> après
   la restauration d'une sauvegarde&nbsp;; voir <xref
   linkend="vacuum-for-statistics"/> et <xref linkend="autovacuum"/> pour plus
   d'informations. Le fichier de sauvegarde ne contient pas
   non plus de commandes <command>ALTER DATABASE ... SET</command>&nbsp;; ces
   paramètres sont sauvegardés par <xref linkend="app-pg-dumpall"/>, avec les
   utilisateurs et les paramètres globaux à l'installation.
  </para>

  <para>
   Parce que <application>pg_dump</application> est utilisé pour transférer des
   données vers des nouvelles versions de <productname>PostgreSQL</productname>,
   la sortie de <application>pg_dump</application> devra pouvoir se charger dans
   les versions du serveur <productname>PostgreSQL</productname> plus récentes
   que la version de <application>pg_dump</application>.
   <application>pg_dump</application> peut aussi extraire des données de serveurs
   <productname>PostgreSQL</productname> plus anciens que sa propre version.
   (À l'heure actuelle, les versions de serveurs supportées vont jusqu'à la 7.0.)
   Toutefois, <application>pg_dump</application> ne peut pas réaliser d'extraction
   de serveurs <productname>PostgreSQL</productname> plus récents que sa propre 
   version majeure&nbsp;; il refusera même d'essayer, plutôt que de risquer de
   fournir une extraction invalide. Par ailleurs, il n'est pas garanti que la sortie
   de <application>pg_dump</application> puisse être chargée dans un serveur d'une
   version majeure plus ancienne&nbsp;&mdash; pas même si l'extraction a été faite
   à partir d'un serveur dans cette version. Charger un fichier d'extraction dans un serveur
   de version plus ancienne pourra requérir une édition manuelle du fichier
   pour supprimer les syntaxe incomprises de l'ancien serveur.
  </para>
 </refsect1>

 <refsect1 id="pg-dump-examples">
  <title id="pg-dump-examples-title">Exemples</title>

  <para>
   Sauvegarder une base appelée <literal>ma_base</literal> dans un script
   SQL&nbsp;:
<screen><prompt>$</prompt> <userinput>pg_dump ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   To dump a database into a directory-format archive:

<screen>
<prompt>$</prompt> <userinput>pg_dump -Fd mydb -f dumpdir</userinput>
</screen>
  </para>

  <para>
   Charger ce script dans une base nouvellement créée et nommée
   <literal>nouvelle_base</literal>:

<screen><prompt>$</prompt> <userinput>psql -d nouvelle_base -f base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder une base dans un fichier au format personnalisé&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -Fc ma_base &gt; base.dump</userinput>
</screen>
  </para>

  <para>
   Charger un fichier d'archive dans une nouvelle base nommée
   <literal>nouvelle_base</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_restore -d nouvelle_base base.dump</userinput>
</screen>
  </para>

  <para>
   Sauvegarder la table nommée <literal>mytab</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -t ma_table ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder toutes les tables du schéma <literal>detroit</literal> et
   dont le nom commence par <literal>emp</literal> sauf la table nommée
   <literal>traces_employes</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -t 'detroit.emp*' -T detroit.traces_employes ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder tous les schémas dont le nom commence par <literal>est</literal> ou
   <literal>ouest</literal> et se termine par <literal>gsm</literal>, en excluant les schémas
   dont le nom contient le mot <literal>test</literal>&nbsp;:

<screen>
<prompt>$</prompt> <userinput>pg_dump -n 'est*gsm' -n 'ouest*gsm' -N '*test*' ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Idem mais en utilisant des expressions rationnelles dans les options&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -n '(est|ouest)*gsm' -N '*test*' ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder tous les objets de la base sauf les tables dont le nom
   commence par <literal>ts_</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -T 'ts_*' ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Pour indiquer un nom qui comporte des majuscules dans les options
   <option>-t</option> et assimilées, il faut ajouter des guillemets
   doubles&nbsp;; sinon le nom est converti en minuscules (voir<xref
   linkend="app-psql-patterns"/>). Les
   guillemets doubles sont interprétés par le shell et doivent dont être placés
   entre guillemets. Du coup, pour sauvegarder une seule table dont le nom
   comporte des majuscules, on utilise une commande du style&nbsp;:

<screen>
<prompt>$</prompt> <userinput>pg_dump -t '"NomAMajuscule"' ma_base &gt; ma_base.sql</userinput>
</screen>
  </para>

 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="app-pg-dumpall"/></member>
   <member><xref linkend="app-pgrestore"/></member>
   <member><xref linkend="app-psql"/></member>
  </simplelist>
 </refsect1>

</refentry>
