<?xml version="1.0" encoding="UTF-8"?>
<refentry id="app-pg-dumpall">
 <indexterm zone="app-pg-dumpall">
  <primary>pg_dumpall</primary>
 </indexterm>

 <refmeta>
  <refentrytitle><application>pg_dumpall</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_dumpall</refname>
  <refpurpose>exporter une instance de bases de données
   <productname>PostgreSQL</productname> dans un script SQL
  </refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_dumpall</command>
   <arg rep="repeat"><replaceable>option_connexion</replaceable></arg>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1 id="app-pg-dumpall-description">
  <title>Description</title>

  <para>
   <application>pg_dumpall</application> est un outil permettant d'exporter
   l'ensemble des bases de données d'une instance
   <productname>PostgreSQL</productname> sous la forme d'un script SQL.
   Le résultat contient des commandes <acronym>SQL</acronym> pouvant être utilisées
   comme entrée de <xref linkend="app-psql"/> pour restaurer les bases de données.
   Pour cela, <application>pg_dumpall</application> appelle
   <xref linkend="app-pgdump"/> pour chaque base de données de l'instance.
   <application>pg_dumpall</application> exporte également les objets globaux
   communs à toutes les bases, à savoir les rôles, les tablespaces,
   et les droits d'accès sur les paramètres de configuration.
   (<application>pg_dump</application> n'exporte pas ces objets.)
  </para>

  <para>
   Puisque <application>pg_dumpall</application> lit les tables de toutes les
   bases de données, il est généralement nécessaire de disposer des droits
   de superutilisateur de la base pour produire un export complet. Par ailleurs,
   il faut également être superutilisateur pour pouvoir exécuter le script
   généré, notamment afin de créer des rôles et des bases de données.
  </para>

  <para>
   Le script SQL est écrit sur la sortie standard. Utilisez l'option
   <option>-f</option>/<option>--file</option> ou les opérateurs shell pour le
   rediriger vers un fichier.
  </para>

  <para>
   <application>pg_dumpall</application> se connecte plusieurs fois au serveur
   <productname>PostgreSQL</productname> (une fois par base de données).
   Si l'authentification par mot de passe est utilisée, un mot de passe sera
   demandé à chaque connexion. Il est alors pratique de disposer d'un fichier
   <filename>~/.pgpass</filename>.
   Voir <xref linkend="libpq-pgpass"/> pour plus d'informations.
  </para>

  <warning>
   <para>
    Restaurer une sauvegarde fait que la destination exécute du code arbitraire.
    Les sauvegardes et restaurations partielles ne limitent pas cela. S'il n'est
    pas possible de faire confiance aux superutilisateurs de la source, les
    requêtes SQL de restauration doivent être inspectées avant d'être exécutées.
    Notez que le client exécutant la sauvegarde et la restauration n'a pas
    besoin de faire confiance aux superutilisateurs source et destination.
   </para>
  </warning>
 </refsect1>

 <refsect1>
  <title>Options</title>

  <para>
   Les options suivantes en ligne de commande contrôlent le contenu et le
   format de la sortie.

   <variablelist>
    <varlistentry>
     <term><option>-a</option></term>
     <term><option>--data-only</option></term>
     <listitem>
      <para>
       Seules les données sont exportées, et non le schéma (définitions des
       données) ni les statistiques.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-c</option></term>
     <term><option>--clean</option></term>
     <listitem>
      <para>
       Émet des commandes SQL <command>DROP</command> pour supprimer toutes les
       bases de données, rôles et tablespaces exportés, avant de les recréer.
       Cette option est utile lorsque la restauration doit écraser une instance
       existante. Si certains objets n'existent pas dans l'instance de destination,
       des messages d'erreur (sans conséquence) seront affichés lors de la
       restauration, sauf si l'option <option>--if-exists</option> est également
       spécifiée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-E <replaceable class="parameter">encoding</replaceable></option></term>
     <term><option>--encoding=<replaceable class="parameter">encoding</replaceable></option></term>
     <listitem>
      <para>
       Crée l'export dans l'encodage indiqué. Par défaut, l'export utilise
       celui de la base de données. Le même résultat peut être obtenu en
       définissant la variable d'environnement <envar>PGCLIENTENCODING</envar>
       avec l'encodage souhaité.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-f <replaceable class="parameter">nomfichier</replaceable></option></term>
     <term><option>--file=<replaceable class="parameter">nomfichier</replaceable></option></term>
     <listitem>
      <para>
       Envoie la sortie dans le fichier indiqué. Si cette option est omise,
       la sortie standard est utilisée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-g</option></term>
     <term><option>--globals-only</option></term>
     <listitem>
      <para>
       Exporte seulement les objets globaux (rôles et tablespaces), pas les
       bases de données.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-O</option></term>
     <term><option>--no-owner</option></term>
     <listitem>
      <para>
       N'émet pas de commandes pour rétablir les propriétaires d'origine des objets.
       Par défaut, <application>pg_dumpall</application> génère des instructions
       <command>ALTER OWNER</command> ou <command>SET SESSION
        AUTHORIZATION</command> pour attribuer aux éléments créés les mêmes
       propriétaires que dans la base d'origine. Ces instructions échoueront si
       le script est exécuté par un utilisateur autre qu'un superutilisateur,
       ou que le propriétaire de tous les objets. Pour générer un script pouvant
       être restauré par n'importe quel utilisateur, qui deviendra alors
       propriétaire de tous les objets, utilisez l'option <option>-O</option>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-r</option></term>
     <term><option>--roles-only</option></term>
     <listitem>
      <para>
       Exporte seulement les rôles, pas les bases ni les tablespaces.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-s</option></term>
     <term><option>--schema-only</option></term>
     <listitem>
      <para>
       Exporte seulement les définitions des objets (le schéma), pas les données.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-S <replaceable class="parameter">username</replaceable></option></term>
     <term><option>--superuser=<replaceable class="parameter">username</replaceable></option></term>
     <listitem>
      <para>
       Précise le nom du superutilisateur à utiliser pour la désactivation des
       triggers. Cela n'a d'intérêt que lorsque
       <option>--disable-triggers</option> est utilisé. (Il est généralement
       préférable de ne pas utiliser cette option, et d'exécuter le script
       résultant directement en tant que superutilisateur.)
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-t</option></term>
     <term><option>--tablespaces-only</option></term>
     <listitem>
      <para>
       Exporte seulement les tablespaces, pas les bases de données ni les rôles.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-v</option></term>
     <term><option>--verbose</option></term>
     <listitem>
      <para>
       Active le mode verbeux. Dans ce mode,
       <application>pg_dumpall</application> inscrit les heures de
       début et de fin dans le fichier d'export, et affiche les messages de
       progression sur la sortie d'erreur standard. Si l'option est répétée,
       des messages de débogage supplémentaires seront affichés sur la sortie
       d'erreur standard. Cette option est également transmise à
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-V</option></term>
     <term><option>--version</option></term>
     <listitem>
      <para>
       Affiche la version de <application>pg_dumpall</application> puis
       quitte.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-x</option></term>
     <term><option>--no-privileges</option></term>
     <term><option>--no-acl</option></term>
     <listitem>
      <para>
       N'exporte pas les droits d'accès (commandes grant/revoke).
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--binary-upgrade</option></term>
     <listitem>
      <para>
       Cette option est destinée à être utilisée par les utilitaires de mise à
       jour en ligne. Son utilisation à d'autres fins n'est ni recommandée ni
       supportée. Le comportement de cette option peut changer sans préavis
       dans de futures versions.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--column-inserts</option></term>
     <term><option>--attribute-inserts</option></term>
     <listitem>
      <para>
       Extrait les données en tant que commandes <command>INSERT</command>
       avec des noms de colonnes explicites (<literal>INSERT INTO
        <replaceable>table</replaceable> (<replaceable>colonne</replaceable>,
        ...) VALUES ...</literal>). Ceci rendra la restauration très
       lente&nbsp;; c'est surtout utile pour créer des exports qui
       puissent être chargés dans des bases de données autres que
       <productname>PostgreSQL</productname>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--disable-dollar-quoting</option></term>
     <listitem>
      <para>
       Cette option désactive l'utilisation du caractère dollar comme
       délimiteur de corps de fonctions, et force leur délimitation en tant
       que chaîne SQL standard.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--disable-triggers</option></term>
     <listitem>
      <para>
       Cette option ne s'applique que dans le cas d'un export incluant les
       données mais pas la structure.
       Ceci demande à <application>pg_dumpall</application> d'inclure des
       commandes pour désactiver temporairement les triggers sur les tables
       cibles pendant que les données sont rechargées. Utilisez cette option si,
       sur vos tables, vous avez des contraintes d'intégrité ou des triggers que
       vous ne voulez pas invoquer pendant le rechargement.
      </para>

      <para>
       À l'heure actuelle, les commandes émises par
       <option>--disable-triggers</option> doivent être exécutées en tant que
       superutilisateur. Par conséquent, vous devez aussi spécifier un nom de
       superutilisateur avec <option>-S</option>, ou préférablement faire
       attention à lancer le script généré en tant que superutilisateur.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--exclude-database=<replaceable class="parameter">motif</replaceable></option></term>
     <listitem>
      <para>
       N'exporte pas les bases de données dont le nom correspond au <replaceable
        class="parameter">motif</replaceable>. Plusieurs motifs peuvent être
       spécifiés en répétant l'option <option>--exclude-database</option>.
       Le paramètre <replaceable class="parameter">motif</replaceable> est
       interprété selon les mêmes règles que que celles utilisées par les
       méta-commandes <literal>\d</literal> de <application>psql</application>
       (voir <xref linkend="app-psql-patterns"/>).
       Il est donc possible d'exclure plusieurs bases de données en utilisant
       les caractères joker dans le motif. Si vous utilisez des jokers,
       faites attention à mettre le motif entre guillemets pour éviter qu'il
       ne soit interprété par le shell.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--extra-float-digits=<replaceable class="parameter">nchiffres</replaceable></option></term>
     <listitem>
      <para>
       Utilise la valeur spécifiée pour <option>extra_float_digits</option>
       lors de l'export de valeurs en virgule flottante, au lieu de la précision
       maximale disponible. Cette option ne doit pas être utilisée pour des
       exports de routine effectués à des fins de sauvegarde.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--filter=<replaceable class="parameter">nom_fichier</replaceable></option></term>
     <listitem>
      <para>
       Indique un fichier contenant les motifs des bases de données à exclure
       de l'export. Ces motifs sont interprétés selon les mêmes règles que pour
       <option>--exclude-database</option>.
       Pour lire à partir de l'entrée standard (<literal>STDIN</literal>),
       utilisez <filename>-</filename> comme nom de fichier. L'option
       <option>--filter</option> peut être utilisée en combinaison avec
       <option>--exclude-database</option>, et peut être spécifiée
       plusieurs fois pour indiquer plusieurs fichiers de filtres.
      </para>

      <para>
       Le fichier contient un motif de base de données par ligne, selon le
       format suivant&nbsp;:
<synopsis>
exclude database <replaceable class="parameter">MOTIF</replaceable>
</synopsis>
      </para>

      <para>
       Les lignes commençant par <literal>#</literal> sont interprétées comme
       des commentaires et sont ignorées. Il est également possible d'ajouter
       des commentaires à la fin d'une ligne contenant un motif. Les lignes vides
       sont elles aussi ignorées. Voir <xref linkend="app-psql-patterns"/> pour
       plus d'informations sur le traitement des guillemets dans les motifs.
      </para>

     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--if-exists</option></term>
     <listitem>
      <para>
       Utilise des commandes <literal>DROP ... IF EXISTS</literal> pour
       supprimer les objets dans le mode <option>--clean</option>. Cela
       permet d'éviter les erreurs <quote>does not exist</quote> qui
       seraient sinon renvoyées. Cette option n'est valable que si
       <option>--clean</option> est aussi spécifiée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--inserts</option></term>
     <listitem>
      <para>
       Extrait les données en tant que commandes <command>INSERT</command>
       (plutôt que <command>COPY</command>). Cela rendra la restauration très
       lente&nbsp;; c'est surtout utile pour créer des exports pouvant être
       chargés dans des bases de données autres que
       <productname>PostgreSQL</productname>. Notez que la restauration peut
       échouer complètement si l'ordre des colonnes a été modifié. L'option
       <option>--column-inserts</option> est plus sûre, mais encore plus
       lente.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--load-via-partition-root</option></term>
     <listitem>
      <para>
       Lors de l'export de données d'une partition, les instructions
       <command>COPY</command> ou <command>INSERT</command> cibleront la racine
       du partitionnement à laquelle elle appartient, plutôt que la
       partition elle-même. Cela entraîne une réévaluation de la partition
       appropriée pour chaque ligne au moment du chargement. Ceci peut être
       utile lors de la restauration sur un serveur où les lignes ne seraient pas
       forcément réparties dans les mêmes partitions que sur le serveur d'origine.
       Cela peut se produire, par exemple, si la colonne de partitionnement est
       de type text et que les deux systèmes ont des définitions différentes du
       collationnement utilisé pour trier cette colonne.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--lock-wait-timeout=<replaceable class="parameter">expiration</replaceable></option></term>
     <listitem>
      <para>
       Ne pas attendre indéfiniment l'acquisition de verrous partagés sur
       les tables au démarrage de l'export. L'opération échoue s'il est
       impossible de verrouiller une table dans le délai spécifié par le
       paramètre <replaceable class="parameter">expiration</replaceable>.
       Le délai peut être exprimé dans l'un des formats acceptés par la commande
       <command>SET statement_timeout</command>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-comments</option></term>
     <listitem>
      <para>
       Ne pas générer les commandes <command>COMMENT</command>.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-data</option></term>
     <listitem>
      <para>
       Ne pas exporter les données.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-policies</option></term>
     <listitem>
      <para>
       Ne pas exporter les politiques de sécurité au niveau ligne.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-publications</option></term>
     <listitem>
      <para>
       Ne pas exporter les publications.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-role-passwords</option></term>
     <listitem>
      <para>
       Ne pas exporter les mots de passe des rôles. Lors de la restauration,
       les rôles auront un mot de passe vide et l'authentification par mot de
       passe échouera systématiquement tant qu'un mot de passe n'aura pas été défini.
       Puisque les valeurs des mots de passe ne sont pas nécessaires quand
       cette option est spécifiée, l'information sur le rôle est lue depuis le
       catalogue système <structname>pg_roles</structname> au lieu de
       <structname>pg_authid</structname>. Cette option est donc également utile
       si l'accès à <structname>pg_authid</structname> est restreint par
       certaines politiques de sécurité.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-schema</option></term>
     <listitem>
      <para>
       Ne pas exporter le schéma (définitions des données).
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-security-labels</option></term>
     <listitem>
      <para>
       Ne pas exporter les labels de sécurité.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-statistics</option></term>
     <listitem>
      <para>
       Ne pas exporter les statistiques. C'est le comportement par défaut.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-subscriptions</option></term>
     <listitem>
      <para>
       Ne pas exporter les souscriptions.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-sync</option></term>
     <listitem>
      <para>
       Par défaut, <command>pg_dumpall</command> attend que tous les fichiers
       soient correctement écrits sur disque. Cette option permet à
       <command>pg_dumpall</command> de rendre la main immédiatement, sans attendre,
       ce qui est plus rapide, mais peut entraîner une corruption de l'export
       en cas d'arrêt brutal du système d'exploitation.
       De manière générale, cette option est utile pour les tests, mais ne
       doit pas être utilisée dans un environnement de production.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-table-access-method</option></term>
     <listitem>
      <para>
       Ne pas générer de commandes pour sélectionner les méthodes d'accès aux
       tables. Avec cette option, tous les objets seront créés avec la méthode
       d'accès aux tables par défaut lors de la restauration.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-tablespaces</option></term>
     <listitem>
      <para>
       Ne pas générer de commandes pour créer des tablespaces, ni sélectionner
       de tablespace pour les objets. Avec cette option, tous les objets
       seront créés dans le tablespace par défaut durant la restauration.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-toast-compression</option></term>
     <listitem>
      <para>
       N'émet pas de commandes pour définir les méthodes de compression
       des colonnes <acronym>TOAST</acronym>. Avec cette option, toutes les
       colonnes seront restaurées avec les paramètres de compression par défaut.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--no-unlogged-table-data</option></term>
     <listitem>
      <para>
       Ne pas exporter le contenu des tables non journalisées
       (<quote>unlogged</quote>). Cette option n'a aucun effet sur l'export des
       définitions de ces tables&nbsp;; elle empêche uniquement l'export
       de leurs données.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--on-conflict-do-nothing</option></term>
     <listitem>
      <para>
       Ajoute <literal>ON CONFLICT DO NOTHING</literal> aux commandes
       <command>INSERT</command>. Cette option n'est valable que si
       <option>--inserts</option> ou <option>--column-inserts</option> est
       aussi indiquée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--quote-all-identifiers</option></term>
     <listitem>
      <para>
       Forcer la mise entre guillemets de tous les identifiants. Cette option
       est recommandée lorsqu'on exporte une base de données depuis un serveur
       dont la version majeure de <productname>PostgreSQL</productname> diffère
       de celle de <application>pg_dumpall</application>, ou lorsque l'export
       est destiné à être rechargé dans une version majeure différente.
       Par défaut, <application>pg_dumpall</application> ne met entre guillemets
       que les identifiants correspondants à des mots réservés dans sa propre
       version majeure. Cela peut parfois entraîner des problèmes de compatibilité
       avec des serveurs de versions différentes, dont la liste des mots
       réservés peut légèrement varier. L'utilisation de l'option
       <option>--quote-all-identifiers</option> permet d'éviter ce type de problème,
       au prix d'un script d'export moins lisible.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--restrict-key=<replaceable class="parameter">restrict_key</replaceable></option></term>
     <listitem>
      <para>
       Utilise la chaîne fournie comme clé de <command>\restrict</command>
       dans <application>psql</application> dans la sortie de la sauvegarde.
       Si aucune clé de restriction n'est indiqué,
       <application>pg_dumpall</application> en générera une aléatoirement si
       nécessaire. Les clés doivent contenir uniquement des caractères
       alphanumériques.
      </para>
      <para>
       Cette option a principalement pour but des tests et d'autres scénarios
       nécessitant une sortie répétable (par exemple pour comparer les fichiers
       de sauvegarde). Ce n'est pas recommandé pour une utilisation standard,
       car un serveur malicieux avec une connaissance de la clé pourrait
       injecter un code arbitraire qui sera exécuté sur la machine qui lance
       <application>psql</application> avec la sauvegarde en sortie.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--rows-per-insert=<replaceable class="parameter">nlignes</replaceable></option></term>
     <listitem>
      <para>
       Exporter les données sous la forme de commandes
       <command>INSERT</command> (au lieu de <command>COPY</command>).
       Contrôle le nombre maximum de lignes par commande
       <command>INSERT</command>. La valeur indiquée doit être strictement
       positive. Toute erreur lors du rechargement provoquera uniquement la
       perte des lignes faisant partie du <command>INSERT</command>
       problématique, et non pas le contenu complet de la table.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--statistics</option></term>
     <listitem>
      <para>
       Sauvegarde les statistiques.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--statistics-only</option></term>
     <listitem>
      <para>
       Exporter uniquement les statistiques, sans le schéma (définitions des
       données) ni les données. Les statistiques des tables, vues matérialisées,
       tables distantes et index sont exportées.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--sequence-data</option></term>
     <listitem>
      <para>
       Inclure les données des séquences dans l'export. C'est le comportement par
       défaut, sauf si <option>--no-data</option>, <option>--schema-only</option>
       ou <option>--statistics-only</option> est spécifié.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--use-set-session-authorization</option></term>
     <listitem>
      <para>
       Émettre des commandes SQL standard <command>SET SESSION
       AUTHORIZATION</command> à la place de commandes <command>ALTER
       OWNER</command> pour définir la propriété des objets. Ceci rend
       l'extraction davantage compatible avec les standards, mais, suivant
       l'historique des objets exportés, la restauration pourrait ne pas fonctionner
       correctement.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-?</option></term>
     <term><option>--help</option></term>
     <listitem>
      <para>
       Afficher l'aide sur les arguments en ligne de commande de
       <application>pg_dumpall</application>, puis quitter.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>

  <para>
   Les options suivantes en ligne de commande contrôlent les paramètres de
   connexion à la base de données.

   <variablelist>
    <varlistentry>
     <term><option>-d <replaceable class="parameter">connstr</replaceable></option></term>
     <term><option>--dbname=<replaceable class="parameter">connstr</replaceable></option></term>
     <listitem>
      <para>
       Indique les paramètres de connexion au serveur, sous la forme d'une
       <link linkend="libpq-connstring">chaîne de connexion</link>&nbsp;; ils
       prévaudront sur toute option en ligne de commande conflictuelle.
      </para>

      <para>
       Cette option est appelée <literal>--dbname</literal> par cohérence avec
       les autres applications clientes. Toutefois, comme
       <application>pg_dumpall</application> doit se connecter à plusieurs bases
       de données, le nom de la base indiqué dans la chaîne de connexion sera
       ignoré. Utilisez l'option <literal>-l</literal> pour spécifier le nom de
       la base à utiliser pour la connexion initiale, qui servira à exporter les
       objets globaux et à déterminer les bases de données à extraire.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-h <replaceable>hôte</replaceable></option></term>
     <term><option>--host=<replaceable>hôte</replaceable></option></term>
     <listitem>
      <para>
       Indique le nom d'hôte de la machine sur laquelle le serveur de bases de
       données est en cours d'exécution. Si la valeur commence par une barre
       oblique (/), elle est interprétée comme le répertoire du socket de
       domaine Unix. Par défaut, la valeur est tirée de la variable
       d'environnement <envar>PGHOST</envar>, si elle est définie&nbsp;;
       sinon, une connexion via socket de domaine Unix est tentée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-l <replaceable>dbname</replaceable></option></term>
     <term><option>--database=<replaceable>dbname</replaceable></option></term>
     <listitem>
      <para>
       Spécifie le nom de la base de données à laquelle se connecter pour
       exporter les objets globaux et déterminer les bases de données à
       extraire. Si cette option n'est pas précisée, la base
       <literal>postgres</literal> sera utilisée et, si elle n'existe pas,
       <literal>template1</literal> sera utilisée.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-p <replaceable>port</replaceable></option></term>
     <term><option>--port=<replaceable>port</replaceable></option></term>
     <listitem>
      <para>
       Indique le port TCP ou le suffixe du fichier socket de domaine Unix local
       sur lequel le serveur écoute les connexions. La valeur par défaut est
       celle de la variable d'environnement <envar>PGPORT</envar>, si elle est
       définie. Dans le cas contraire, il s'agit de la valeur fournie à la
       compilation.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-U <replaceable>nomutilisateur</replaceable></option></term>
     <term><option>--username=<replaceable>nomutilisateur</replaceable></option></term>
     <listitem>
      <para>
       Indique le nom d'utilisateur utilisé pour la connexion.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-w</option></term>
     <term><option>--no-password</option></term>
     <listitem>
      <para>
       Ne jamais demander de mot de passe. Si le serveur requiert une
       authentification par mot de passe et qu'aucun mot de passe n'est disponible
       par un autre moyen (par exemple via le fichier <filename>.pgpass</filename>),
       la tentative de connexion échouera. Cette option peut être utile dans les
       scripts ou les traitements de type batch, où aucun utilisateur
       n'est présent pour saisir un mot de passe.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>-W</option></term>
     <term><option>--password</option></term>
     <listitem>
      <para>
       Force <application>pg_dumpall</application> à demander un mot de passe
       avant la connexion à une base de données.
      </para>

      <para>
       Cette option n'est jamais indispensable car
       <application>pg_dumpall</application> demande automatiquement un mot de
       passe si le serveur exige une authentification par mot de passe.
       Néanmoins, <application>pg_dumpall</application> perd une tentative de
       connexion pour tester si le serveur requiert un mot de passe. Dans
       certains cas, il est préférable d'ajouter l'option <option>-W</option>
       pour éviter cette tentative de connexion supplémentaire.
      </para>

      <para>
       Notez que le mot de passe sera demandé pour chaque base de données à
       exporter. Il est généralement préférable de configurer un fichier
       <filename>~/.pgpass</filename> plutôt que de saisir manuellement
       le mot de passe à chaque fois.
      </para>
     </listitem>
    </varlistentry>

    <varlistentry>
     <term><option>--role=<replaceable class="parameter">nomrole</replaceable></option></term>
     <listitem>
      <para>
       Spécifie un rôle à utiliser pour réaliser l'export. Avec cette option,
       <application>pg_dumpall</application> émet une commande <command>SET
        ROLE</command> <replaceable class="parameter">nomrole</replaceable>
       après s'être connecté à la base. C'est utile quand l'utilisateur
       authentifié (indiqué par <option>-U</option>) n'a pas les droits dont
       <application>pg_dumpall</application> a besoin, mais peut basculer vers
       un rôle qui les a. Certaines installations ont une politique qui est
       contre se connecter directement en tant que superutilisateur, et
       l'utilisation de cette option permet que les exports soient faites
       sans violer cette politique.
      </para>
     </listitem>
    </varlistentry>
   </variablelist>
  </para>
 </refsect1>


 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGOPTIONS</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Paramètres de connexion par défaut.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>PG_COLOR</envar></term>
    <listitem>
     <para>
      Indique s'il faut utiliser la couleur pour les messages de diagnostic.
      Les valeurs possibles sont <literal>always</literal>,
      <literal>auto</literal>, <literal>never</literal>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Cet outil, comme la plupart des autres outils
   <productname>PostgreSQL</productname>, utilise aussi les variables
   d'environnement supportées par la bibliothèque
   <application>libpq</application> (voir <xref linkend="libpq-envars"/>).
  </para>

 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Comme <application>pg_dumpall</application> appelle
   <application>pg_dump</application> en interne, certains messages de
   diagnostic feront en fait référence à <application>pg_dump</application>.
  </para>

  <para>
   L'option <option>--clean</option> peut être utile même si vous prévoyez de
   restaurer l'export dans une instance vide. Son utilisation autorise le script
   à supprimer puis recréer les bases de données système
   <literal>postgres</literal> et <literal>template1</literal>, garantissant
   ainsi qu'elles conservent les mêmes propriétés (par exemple la locale et
   l'encodage) que dans l'instance source. Sans cette option, ces bases
   conserveront leurs propriétés actuelles au niveau de la base, ainsi que tout
   contenu préexistant.
  </para>

  <para>
   Si l'option <option>--with-statistics</option> est spécifiée,
   <command>pg_dumpall</command> inclura la plupart des statistiques de l'optimiseur
   dans le fichier d'export généré. Toutefois, certaines statistiques peuvent ne pas
   être incluses, notamment celles créées explicitement via
   <xref linkend="sql-createstatistics"/> ou celles ajoutées par une extension.
   Il peut donc être utile d'exécuter <command>ANALYZE</command> sur chaque base
   de données après la restauration d'un export afin de garantir des performances
   optimales. Vous pouvez également exécuter <command>vacuumdb -a -z</command>
   pour analyser toutes les bases de données.
  </para>

  <para>
   Il ne faut pas s'attendre à ce que le script d'export s'exécute sans aucune
   erreur. En particulier, comme le script exécutera une commande <command>CREATE
    ROLE</command> pour chaque rôle présent dans l'instance d'origine, une erreur
   <quote>role already exists</quote> est inévitable pour le
   superutilisateur initial, sauf si l'instance de destination a été initialisée
   avec un nom différent pour ce dernier. Cette erreur est sans conséquence et
   peut être ignorée. L'utilisation de l'option <option>--clean</option> risque
   également de générer d'autres messages d'erreur sans gravité concernant des
   objets inexistants. Vous pouvez minimiser ces erreurs en ajoutant l'option
   <option>--if-exists</option>.
  </para>

  <para>
   <application>pg_dumpall</application> requiert que tous les tablespaces
   nécessaires existent avant la restauration. Dans le cas contraire, la
   création de la base échouera pour les bases situées en dehors de
   l'emplacement par défaut.
  </para>

  <para>
   Il est généralement recommandé d'utiliser l'option <option>-X</option>
   (<option>--no-psqlrc</option>) lors de la restauration d'une base de données
   à partir d’un script <application>pg_dumpall</application>, afin de garantir
   une restauration propre et d’éviter d’éventuels conflits avec une configuration
   personnalisée de <application>psql</application>. Par ailleurs, comme un script
   <application>pg_dumpall</application> peut inclure des méta-commandes
   <application>psql</application>, il pourrait être incompatible avec des
   outils clients autres que <application>psql</application>.
  </para>
 </refsect1>

 <refsect1 id="app-pg-dumpall-ex">
  <title>Exemples</title>
  <para>
   Pour exporter toutes les bases de données&nbsp;:

   <screen><prompt>$</prompt> <userinput>pg_dumpall &gt; db.out</userinput>
   </screen>
  </para>

  <para>
   Pour restaurer les bases de données à partir de ce fichier, vous pouvez
   utiliser&nbsp;:
   <screen><prompt>$</prompt> <userinput>psql -X -f db.out postgres</userinput>
   </screen>
   Il n'est pas important de se connecter à une base spécifique ici, car le
   script généré par <application>pg_dumpall</application> contient les
   commandes nécessaires pour créer et se connecter aux bases de données
   exportées. Une exception existe si vous avez utilisé l'option
   <option>--clean</option> : vous devez alors vous connecter d'abord
   à la base <literal>postgres</literal>&nbsp;; le script tentera de supprimer
   les autres bases immédiatement, ce qui échouera pour la base à laquelle
   vous êtes connecté.
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <para>
   Consultez <xref linkend="app-pgdump"/> pour plus de détails sur les erreurs
   susceptibles de se produire.
  </para>
 </refsect1>

</refentry>
