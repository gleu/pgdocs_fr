<!-- $PostgreSQL: pgsql/doc/src/sgml/release-9.0.sgml,v 2.39.2.14 2010-09-16 18:15:28 tgl Exp $ -->
<!-- See header comment in release.sgml about typical markup -->

 <sect1 id="release-9-0-8">
  <title>Release 9.0.8</title>

  <note>
  <title>Release Date</title>
  <simpara>2012-06-04</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.7.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.8</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

   <para>
    However, if you are upgrading from a version earlier than 9.0.6,
    see the release notes for 9.0.6.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Fix incorrect password transformation in
      <filename>contrib/pgcrypto</filename>'s DES <function>crypt()</function> function
      (Solar Designer)
     </para>

     <para>
      If a password string contained the byte value <literal>0x80</literal>, the
      remainder of the password was ignored, causing the password to be much
      weaker than it appeared.  With this fix, the rest of the string is
      properly included in the DES hash.  Any stored password values that are
      affected by this bug will thus no longer match, so the stored values may
      need to be updated.  (CVE-2012-2143)
     </para>
    </listitem>

    <listitem>
     <para>
      Ignore <literal>SECURITY DEFINER</literal> and <literal>SET</literal> attributes for
      a procedural language's call handler (Tom Lane)
     </para>

     <para>
      Applying such attributes to a call handler could crash the server.
      (CVE-2012-2655)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow numeric timezone offsets in <type>timestamp</type> input to be up to
      16 hours away from UTC (Tom Lane)
     </para>

     <para>
      Some historical time zones have offsets larger than 15 hours, the
      previous limit.  This could result in dumped data values being rejected
      during reload.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix timestamp conversion to cope when the given time is exactly the
      last DST transition time for the current timezone (Tom Lane)
     </para>

     <para>
      This oversight has been there a long time, but was not noticed
      previously because most DST-using zones are presumed to have an
      indefinite sequence of future DST transitions.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <type>text</type> to <type>name</type> and <type>char</type> to <type>name</type>
      casts to perform string truncation correctly in multibyte encodings
      (Karl Schnaitter)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix memory copying bug in <function>to_tsquery()</function> (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Ensure <function>txid_current()</function> reports the correct epoch when
      executed in hot standby (Simon Riggs)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix planner's handling of outer PlaceHolderVars within subqueries (Tom
      Lane)
     </para>

     <para>
      This bug concerns sub-SELECTs that reference variables coming from the
      nullable side of an outer join of the surrounding query.
      In 9.1, queries affected by this bug would fail with <quote>ERROR:
      Upper-level PlaceHolderVar found where not expected</quote>.  But in 9.0 and
      8.4, you'd silently get possibly-wrong answers, since the value
      transmitted into the subquery wouldn't go to null when it should.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix slow session startup when <structname>pg_attribute</structname> is very large
      (Tom Lane)
     </para>

     <para>
      If <structname>pg_attribute</structname> exceeds one-fourth of
      <varname>shared_buffers</varname>, cache rebuilding code that is sometimes
      needed during session start would trigger the synchronized-scan logic,
      causing it to take many times longer than normal.  The problem was
      particularly acute if many new sessions were starting at once.
     </para>
    </listitem>

    <listitem>
     <para>
      Ensure sequential scans check for query cancel reasonably often (Merlin
      Moncure)
     </para>

     <para>
      A scan encountering many consecutive pages that contain no live tuples
      would not respond to interrupts meanwhile.
     </para>
    </listitem>

    <listitem>
     <para>
      Ensure the Windows implementation of <function>PGSemaphoreLock()</function>
      clears <varname>ImmediateInterruptOK</varname> before returning (Tom Lane)
     </para>

     <para>
      This oversight meant that a query-cancel interrupt received later
      in the same query could be accepted at an unsafe time, with
      unpredictable but not good consequences.
     </para>
    </listitem>

    <listitem>
     <para>
      Show whole-row variables safely when printing views or rules
      (Abbas Butt, Tom Lane)
     </para>

     <para>
      Corner cases involving ambiguous names (that is, the name could be
      either a table or column name of the query) were printed in an
      ambiguous way, risking that the view or rule would be interpreted
      differently after dump and reload.  Avoid the ambiguous case by
      attaching a no-op cast.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <command>COPY FROM</command> to properly handle null marker strings that
      correspond to invalid encoding (Tom Lane)
     </para>

     <para>
      A null marker string such as <literal>E'\\0'</literal> should work, and did
      work in the past, but the case got broken in 8.4.
     </para>
    </listitem>

    <listitem>
     <para>
      Ensure autovacuum worker processes perform stack depth checking
      properly (Heikki Linnakangas)
     </para>

     <para>
      Previously, infinite recursion in a function invoked by
      auto-<command>ANALYZE</command> could crash worker processes.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix logging collector to not lose log coherency under high load (Andrew
      Dunstan)
     </para>

     <para>
      The collector previously could fail to reassemble large messages if it
      got too busy.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix logging collector to ensure it will restart file rotation
      after receiving <systemitem>SIGHUP</systemitem> (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix WAL replay logic for GIN indexes to not fail if the index was
      subsequently dropped (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix memory leak in PL/pgSQL's <command>RETURN NEXT</command> command (Joe
      Conway)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix PL/pgSQL's <command>GET DIAGNOSTICS</command> command when the target
      is the function's first variable (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix potential access off the end of memory in <application>psql</application>'s
      expanded display (<command>\x</command>) mode (Peter Eisentraut)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix several performance problems in <application>pg_dump</application> when
      the database contains many objects (Jeff Janes, Tom Lane)
     </para>

     <para>
      <application>pg_dump</application> could get very slow if the database contained
      many schemas, or if many objects are in dependency loops, or if there
      are many owned sequences.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>pg_upgrade</application> for the case that a database stored in a
      non-default tablespace contains a table in the cluster's default
      tablespace (Bruce Momjian)
     </para>
    </listitem>

    <listitem>
     <para>
      In <application>ecpg</application>, fix rare memory leaks and possible overwrite
      of one byte after the <structname>sqlca_t</structname> structure (Peter Eisentraut)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <filename>contrib/dblink</filename>'s <function>dblink_exec()</function> to not leak
      temporary database connections upon error (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <filename>contrib/dblink</filename> to report the correct connection name in
      error messages (Kyotaro Horiguchi)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <filename>contrib/vacuumlo</filename> to use multiple transactions when
      dropping many large objects (Tim Lewis, Robert Haas, Tom Lane)
     </para>

     <para>
      This change avoids exceeding <varname>max_locks_per_transaction</varname> when
      many objects need to be dropped.  The behavior can be adjusted with the
      new <literal>-l</literal> (limit) option.
     </para>
    </listitem>

    <listitem>
     <para>
      Update time zone data files to <application>tzdata</application> release 2012c
      for DST law changes in Antarctica, Armenia, Chile, Cuba, Falkland
      Islands, Gaza, Haiti, Hebron, Morocco, Syria, and Tokelau Islands;
      also historical corrections for Canada.
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

  <sect1 id="release-9-0-7">
  <title>Release 9.0.7</title>

  <note>
  <title>Release Date</title>
  <simpara>2012-02-27</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.6.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.7</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

   <para>
    However, if you are upgrading from a version earlier than 9.0.6,
    see the release notes for 9.0.6.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Require execute permission on the trigger function for
      <command>CREATE TRIGGER</command> (Robert Haas)
     </para>

     <para>
      This missing check could allow another user to execute a trigger
      function with forged input data, by installing it on a table he owns.
      This is only of significance for trigger functions marked
      <literal>SECURITY DEFINER</literal>, since otherwise trigger functions run
      as the table owner anyway.  (CVE-2012-0866)
     </para>
    </listitem>

    <listitem>
     <para>
      Remove arbitrary limitation on length of common name in SSL
      certificates (Heikki Linnakangas)
     </para>

     <para>
      Both <application>libpq</application> and the server truncated the common name
      extracted from an SSL certificate at 32 bytes.  Normally this would
      cause nothing worse than an unexpected verification failure, but there
      are some rather-implausible scenarios in which it might allow one
      certificate holder to impersonate another.  The victim would have to
      have a common name exactly 32 bytes long, and the attacker would have
      to persuade a trusted CA to issue a certificate in which the common
      name has that string as a prefix.  Impersonating a server would also
      require some additional exploit to redirect client connections.
      (CVE-2012-0867)
     </para>
    </listitem>

    <listitem>
     <para>
      Convert newlines to spaces in names written in <application>pg_dump</application>
      comments (Robert Haas)
     </para>

     <para>
      <application>pg_dump</application> was incautious about sanitizing object names
      that are emitted within SQL comments in its output script.  A name
      containing a newline would at least render the script syntactically
      incorrect.  Maliciously crafted object names could present a SQL
      injection risk when the script is reloaded.  (CVE-2012-0868)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix btree index corruption from insertions concurrent with vacuuming
      (Tom Lane)
     </para>

     <para>
      An index page split caused by an insertion could sometimes cause a
      concurrently-running <command>VACUUM</command> to miss removing index entries
      that it should remove.  After the corresponding table rows are removed,
      the dangling index entries would cause errors (such as <quote>could not
      read block N in file ...</quote>) or worse, silently wrong query results
      after unrelated rows are re-inserted at the now-free table locations.
      This bug has been present since release 8.2, but occurs so infrequently
      that it was not diagnosed until now.  If you have reason to suspect
      that it has happened in your database, reindexing the affected index
      will fix things.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix transient zeroing of shared buffers during WAL replay (Tom Lane)
     </para>

     <para>
      The replay logic would sometimes zero and refill a shared buffer, so
      that the contents were transiently invalid.  In hot standby mode this
      can result in a query that's executing in parallel seeing garbage data.
      Various symptoms could result from that, but the most common one seems
      to be <quote>invalid memory alloc request size</quote>.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix postmaster to attempt restart after a hot-standby crash (Tom Lane)
     </para>

     <para>
      A logic error caused the postmaster to terminate, rather than attempt
      to restart the cluster, if any backend process crashed while operating
      in hot standby mode.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <command>CLUSTER</command>/<command>VACUUM FULL</command> handling of toast
      values owned by recently-updated rows (Tom Lane)
     </para>

     <para>
      This oversight could lead to <quote>duplicate key value violates unique
      constraint</quote> errors being reported against the toast table's index
      during one of these commands.
     </para>
    </listitem>

    <listitem>
     <para>
      Update per-column permissions, not only per-table permissions, when
      changing table owner (Tom Lane)
     </para>

     <para>
      Failure to do this meant that any previously granted column permissions
      were still shown as having been granted by the old owner.  This meant
      that neither the new owner nor a superuser could revoke the
      now-untraceable-to-table-owner permissions.
     </para>
    </listitem>

    <listitem>
     <para>
      Support foreign data wrappers and foreign servers in
      <command>REASSIGN OWNED</command> (Alvaro Herrera)
     </para>

     <para>
      This command failed with <quote>unexpected classid</quote> errors if
      it needed to change the ownership of any such objects.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow non-existent values for some settings in <command>ALTER
      USER/DATABASE SET</command> (Heikki Linnakangas)
     </para>

     <para>
      Allow <varname>default_text_search_config</varname>,
      <varname>default_tablespace</varname>, and <varname>temp_tablespaces</varname> to be
      set to names that are not known.  This is because they might be known
      in another database where the setting is intended to be used, or for the
      tablespace cases because the tablespace might not be created yet.  The
      same issue was previously recognized for <varname>search_path</varname>, and
      these settings now act like that one.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid crashing when we have problems deleting table files post-commit
      (Tom Lane)
     </para>

     <para>
      Dropping a table should lead to deleting the underlying disk files only
      after the transaction commits.  In event of failure then (for instance,
      because of wrong file permissions) the code is supposed to just emit a
      warning message and go on, since it's too late to abort the
      transaction.  This logic got broken as of release 8.4, causing such
      situations to result in a PANIC and an unrestartable database.
     </para>
    </listitem>

    <listitem>
     <para>
      Recover from errors occurring during WAL replay of <command>DROP
      TABLESPACE</command> (Tom Lane)
     </para>

     <para>
      Replay will attempt to remove the tablespace's directories, but there
      are various reasons why this might fail (for example, incorrect
      ownership or permissions on those directories).  Formerly the replay
      code would panic, rendering the database unrestartable without manual
      intervention.  It seems better to log the problem and continue, since
      the only consequence of failure to remove the directories is some
      wasted disk space.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix race condition in logging AccessExclusiveLocks for hot standby
      (Simon Riggs)
     </para>

     <para>
      Sometimes a lock would be logged as being held by <quote>transaction
      zero</quote>.  This is at least known to produce assertion failures on
      slave servers, and might be the cause of more serious problems.
     </para>
    </listitem>

    <listitem>
     <para>
      Track the OID counter correctly during WAL replay, even when it wraps
      around (Tom Lane)
     </para>

     <para>
      Previously the OID counter would remain stuck at a high value until the
      system exited replay mode.  The practical consequences of that are
      usually nil, but there are scenarios wherein a standby server that's
      been promoted to master might take a long time to advance the OID
      counter to a reasonable value once values are needed.
     </para>
    </listitem>

    <listitem>
     <para>
      Prevent emitting misleading <quote>consistent recovery state reached</quote>
      log message at the beginning of crash recovery (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix initial value of
      <structname>pg_stat_replication</structname>.<structfield>replay_location</structfield>
      (Fujii Masao)
     </para>

     <para>
      Previously, the value shown would be wrong until at least one WAL
      record had been replayed.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix regular expression back-references with <literal>*</literal> attached
      (Tom Lane)
     </para>

     <para>
      Rather than enforcing an exact string match, the code would effectively
      accept any string that satisfies the pattern sub-expression referenced
      by the back-reference symbol.
     </para>

     <para>
      A similar problem still afflicts back-references that are embedded in a
      larger quantified expression, rather than being the immediate subject
      of the quantifier.  This will be addressed in a future
      <productname>PostgreSQL</productname> release.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix recently-introduced memory leak in processing of
      <type>inet</type>/<type>cidr</type> values (Heikki Linnakangas)
     </para>

     <para>
      A patch in the December 2011 releases of <productname>PostgreSQL</productname>
      caused memory leakage in these operations, which could be significant
      in scenarios such as building a btree index on such a column.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix dangling pointer after <command>CREATE TABLE AS</command>/<command>SELECT
      INTO</command> in a SQL-language function (Tom Lane)
     </para>

     <para>
      In most cases this only led to an assertion failure in assert-enabled
      builds, but worse consequences seem possible.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid double close of file handle in syslogger on Windows (MauMau)
     </para>

     <para>
      Ordinarily this error was invisible, but it would cause an exception
      when running on a debug version of Windows.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix I/O-conversion-related memory leaks in plpgsql
      (Andres Freund, Jan Urbanski, Tom Lane)
     </para>

     <para>
      Certain operations would leak memory until the end of the current
      function.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve <application>pg_dump</application>'s handling of inherited table columns
      (Tom Lane)
     </para>

     <para>
      <application>pg_dump</application> mishandled situations where a child column has
      a different default expression than its parent column.  If the default
      is textually identical to the parent's default, but not actually the
      same (for instance, because of schema search path differences) it would
      not be recognized as different, so that after dump and restore the
      child would be allowed to inherit the parent's default.  Child columns
      that are <literal>NOT NULL</literal> where their parent is not could also be
      restored subtly incorrectly.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>pg_restore</application>'s direct-to-database mode for
      INSERT-style table data (Tom Lane)
     </para>

     <para>
      Direct-to-database restores from archive files made with
      <option>--inserts</option> or <option>--column-inserts</option> options fail when
      using <application>pg_restore</application> from a release dated September or
      December 2011, as a result of an oversight in a fix for another
      problem.  The archive file itself is not at fault, and text-mode
      output is okay.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <application>pg_upgrade</application> to process tables containing
      <type>regclass</type> columns (Bruce Momjian)
     </para>

     <para>
      Since <application>pg_upgrade</application> now takes care to preserve
      <structname>pg_class</structname> OIDs, there was no longer any reason for this
      restriction.
     </para>
    </listitem>

    <listitem>
     <para>
      Make <application>libpq</application> ignore <literal>ENOTDIR</literal> errors
      when looking for an SSL client certificate file
      (Magnus Hagander)
     </para>

     <para>
      This allows SSL connections to be established, though without a
      certificate, even when the user's home directory is set to something
      like <literal>/dev/null</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix some more field alignment issues in <application>ecpg</application>'s SQLDA area
      (Zoltan Boszormenyi)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <literal>AT</literal> option in <application>ecpg</application>
      <literal>DEALLOCATE</literal> statements (Michael Meskes)
     </para>

     <para>
      The infrastructure to support this has been there for awhile, but
      through an oversight there was still an error check rejecting the case.
     </para>
    </listitem>

    <listitem>
     <para>
      Do not use the variable name when defining a varchar structure in ecpg
      (Michael Meskes)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <filename>contrib/auto_explain</filename>'s JSON output mode to produce
      valid JSON (Andrew Dunstan)
     </para>

     <para>
      The output used brackets at the top level, when it should have used
      braces.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix error in <filename>contrib/intarray</filename>'s <literal>int[] &amp;
      int[]</literal> operator (Guillaume Lelarge)
     </para>

     <para>
      If the smallest integer the two input arrays have in common is 1,
      and there are smaller values in either array, then 1 would be
      incorrectly omitted from the result.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix error detection in <filename>contrib/pgcrypto</filename>'s
      <function>encrypt_iv()</function> and <function>decrypt_iv()</function>
      (Marko Kreen)
     </para>

     <para>
      These functions failed to report certain types of invalid-input errors,
      and would instead return random garbage values for incorrect input.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix one-byte buffer overrun in <filename>contrib/test_parser</filename>
      (Paul Guyot)
     </para>

     <para>
      The code would try to read one more byte than it should, which would
      crash in corner cases.
      Since <filename>contrib/test_parser</filename> is only example code, this is
      not a security issue in itself, but bad example code is still bad.
     </para>
    </listitem>

    <listitem>
     <para>
      Use <function>__sync_lock_test_and_set()</function> for spinlocks on ARM, if
      available (Martin Pitt)
     </para>

     <para>
      This function replaces our previous use of the <literal>SWPB</literal>
      instruction, which is deprecated and not available on ARMv6 and later.
      Reports suggest that the old code doesn't fail in an obvious way on
      recent ARM boards, but simply doesn't interlock concurrent accesses,
      leading to bizarre failures in multiprocess operation.
     </para>
    </listitem>

    <listitem>
     <para>
      Use <option>-fexcess-precision=standard</option> option when building with
      gcc versions that accept it (Andrew Dunstan)
     </para>

     <para>
      This prevents assorted scenarios wherein recent versions of gcc will
      produce creative results.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow use of threaded Python on FreeBSD (Chris Rees)
     </para>

     <para>
      Our configure script previously believed that this combination wouldn't
      work; but FreeBSD fixed the problem, so remove that error check.
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0-6">
  <title>Release 9.0.6</title>

  <note>
  <title>Release Date</title>
  <simpara>2011-12-05</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.5.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.6</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

   <para>
    However, a longstanding error was discovered in the definition of the
    <literal>information_schema.referential_constraints</literal> view.  If you
    rely on correct results from that view, you should replace its
    definition as explained in the first changelog item below.
   </para>

   <para>
    Also, if you are upgrading from a version earlier than 9.0.4,
    see the release notes for 9.0.4.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Fix bugs in <literal>information_schema.referential_constraints</literal> view
      (Tom Lane)
     </para>

     <para>
      This view was being insufficiently careful about matching the
      foreign-key constraint to the depended-on primary or unique key
      constraint.  That could result in failure to show a foreign key
      constraint at all, or showing it multiple times, or claiming that it
      depends on a different constraint than the one it really does.
     </para>

     <para>
      Since the view definition is installed by <application>initdb</application>,
      merely upgrading will not fix the problem.  If you need to fix this
      in an existing installation, you can (as a superuser) drop the
      <literal>information_schema</literal> schema then re-create it by sourcing
      <filename><replaceable>SHAREDIR</replaceable>/information_schema.sql</filename>.
      (Run <literal>pg_config --sharedir</literal> if you're uncertain where
      <replaceable>SHAREDIR</replaceable> is.)  This must be repeated in each database
      to be fixed.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix possible crash during <command>UPDATE</command> or <command>DELETE</command> that
      joins to the output of a scalar-returning function (Tom Lane)
     </para>

     <para>
      A crash could only occur if the target row had been concurrently
      updated, so this problem surfaced only intermittently.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect replay of WAL records for GIN index updates
      (Tom Lane)
     </para>

     <para>
      This could result in transiently failing to find index entries after
      a crash, or on a hot-standby server.  The problem would be repaired
      by the next <command>VACUUM</command> of the index, however.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix TOAST-related data corruption during <literal>CREATE TABLE dest AS
      SELECT * FROM src</literal> or <literal>INSERT INTO dest SELECT * FROM src</literal>
      (Tom Lane)
     </para>

     <para>
      If a table has been modified by <command>ALTER TABLE ADD COLUMN</command>,
      attempts to copy its data verbatim to another table could produce
      corrupt results in certain corner cases.
      The problem can only manifest in this precise form in 8.4 and later,
      but we patched earlier versions as well in case there are other code
      paths that could trigger the same bug.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix possible failures during hot standby startup (Simon Riggs)
     </para>
    </listitem>

    <listitem>
     <para>
      Start hot standby faster when initial snapshot is incomplete
      (Simon Riggs)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix race condition during toast table access from stale syscache entries
      (Tom Lane)
     </para>

     <para>
      The typical symptom was transient errors like <quote>missing chunk
      number 0 for toast value NNNNN in pg_toast_2619</quote>, where the cited
      toast table would always belong to a system catalog.
     </para>
    </listitem>

    <listitem>
     <para>
      Track dependencies of functions on items used in parameter default
      expressions (Tom Lane)
     </para>

     <para>
      Previously, a referenced object could be dropped without having dropped
      or modified the function, leading to misbehavior when the function was
      used.  Note that merely installing this update will not fix the missing
      dependency entries; to do that, you'd need to <command>CREATE OR
      REPLACE</command> each such function afterwards.  If you have functions whose
      defaults depend on non-built-in objects, doing so is recommended.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow inlining of set-returning SQL functions with multiple OUT
      parameters (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Don't trust deferred-unique indexes for join removal (Tom Lane and Marti
      Raudsepp)
     </para>

     <para>
      A deferred uniqueness constraint might not hold intra-transaction,
      so assuming that it does could give incorrect query results.
     </para>
    </listitem>

    <listitem>
     <para>
      Make <function>DatumGetInetP()</function> unpack inet datums that have a 1-byte
      header, and add a new macro, <function>DatumGetInetPP()</function>, that does
      not (Heikki Linnakangas)
     </para>

     <para>
      This change affects no core code, but might prevent crashes in add-on
      code that expects <function>DatumGetInetP()</function> to produce an unpacked
      datum as per usual convention.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve locale support in <type>money</type> type's input and output
      (Tom Lane)
     </para>

     <para>
      Aside from not supporting all standard
      <link linkend="guc-lc-monetary"><varname>lc_monetary</varname></link>
      formatting options, the input and output functions were inconsistent,
      meaning there were locales in which dumped <type>money</type> values could
      not be re-read.
     </para>
    </listitem>

    <listitem>
     <para>
      Don't let <link
      linkend="guc-transform-null-equals"><varname>transform_null_equals</varname></link>
      affect <literal>CASE foo WHEN NULL ...</literal> constructs
      (Heikki Linnakangas)
     </para>

     <para>
      <varname>transform_null_equals</varname> is only supposed to affect
      <literal>foo = NULL</literal> expressions written directly by the user, not
      equality checks generated internally by this form of <literal>CASE</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Change foreign-key trigger creation order to better support
      self-referential foreign keys (Tom Lane)
     </para>

     <para>
      For a cascading foreign key that references its own table, a row update
      will fire both the <literal>ON UPDATE</literal> trigger and the
      <literal>CHECK</literal> trigger as one event.  The <literal>ON UPDATE</literal>
      trigger must execute first, else the <literal>CHECK</literal> will check a
      non-final state of the row and possibly throw an inappropriate error.
      However, the firing order of these triggers is determined by their
      names, which generally sort in creation order since the triggers have
      auto-generated names following the convention
      <quote>RI_ConstraintTrigger_NNNN</quote>.  A proper fix would require
      modifying that convention, which we will do in 9.2, but it seems risky
      to change it in existing releases.  So this patch just changes the
      creation order of the triggers.  Users encountering this type of error
      should drop and re-create the foreign key constraint to get its
      triggers into the right order.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid floating-point underflow while tracking buffer allocation rate
      (Greg Matthews)
     </para>

     <para>
      While harmless in itself, on certain platforms this would result in
      annoying kernel log messages.
     </para>
    </listitem>

    <listitem>
     <para>
      Preserve configuration file name and line number values when starting
      child processes under Windows (Tom Lane)
     </para>

     <para>
      Formerly, these would not be displayed correctly in the
      <structname>pg_settings</structname> view.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect field alignment in <application>ecpg</application>'s SQLDA area
      (Zoltan Boszormenyi)
     </para>
    </listitem>

    <listitem>
     <para>
      Preserve blank lines within commands in <application>psql</application>'s command
      history (Robert Haas)
     </para>

     <para>
      The former behavior could cause problems if an empty line was removed
      from within a string literal, for example.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>pg_dump</application> to dump user-defined casts between
      auto-generated types, such as table rowtypes (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Assorted fixes for <application>pg_upgrade</application> (Bruce Momjian)
     </para>

     <para>
      Handle exclusion constraints correctly, avoid failures on Windows,
      don't complain about mismatched toast table names in 8.4 databases.
     </para>
    </listitem>

    <listitem>
     <para>
      Use the preferred version of <application>xsubpp</application> to build PL/Perl,
      not necessarily the operating system's main copy
      (David Wheeler and Alex Hunsaker)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect coding in <filename>contrib/dict_int</filename> and
      <filename>contrib/dict_xsyn</filename> (Tom Lane)
     </para>

     <para>
      Some functions incorrectly assumed that memory returned by
      <function>palloc()</function> is guaranteed zeroed.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix assorted errors in <filename>contrib/unaccent</filename>'s configuration
      file parsing (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Honor query cancel interrupts promptly in <function>pgstatindex()</function>
      (Robert Haas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect quoting of log file name in Mac OS X start script
      (Sidar Lopez)
     </para>
    </listitem>

    <listitem>
     <para>
      Ensure VPATH builds properly install all server header files
      (Peter Eisentraut)
     </para>
    </listitem>

    <listitem>
     <para>
      Shorten file names reported in verbose error messages (Peter Eisentraut)
     </para>

     <para>
      Regular builds have always reported just the name of the C file
      containing the error message call, but VPATH builds formerly
      reported an absolute path name.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix interpretation of Windows timezone names for Central America
      (Tom Lane)
     </para>

     <para>
      Map <quote>Central America Standard Time</quote> to <literal>CST6</literal>, not
      <literal>CST6CDT</literal>, because DST is generally not observed anywhere in
      Central America.
     </para>
    </listitem>

    <listitem>
     <para>
      Update time zone data files to <application>tzdata</application> release 2011n
      for DST law changes in Brazil, Cuba, Fiji, Palestine, Russia, and Samoa;
      also historical corrections for Alaska and British East Africa.
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0-5">
  <title>Release 9.0.5</title>

  <note>
  <title>Release Date</title>
  <simpara>2011-09-26</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.4.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.5</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

   <para>
    However, if you are upgrading from a version earlier than 9.0.4,
    see the release notes for 9.0.4.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Fix catalog cache invalidation after a <command>VACUUM FULL</command> or
      <command>CLUSTER</command> on a system catalog (Tom Lane)
     </para>

     <para>
      In some cases the relocation of a system catalog row to another place
      would not be recognized by concurrent server processes, allowing catalog
      corruption to occur if they then tried to update that row.  The
      worst-case outcome could be as bad as complete loss of a table.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect order of operations during sinval reset processing,
      and ensure that TOAST OIDs are preserved in system catalogs (Tom
      Lane)
     </para>

     <para>
      These mistakes could lead to transient failures after a <command>VACUUM
      FULL</command> or <command>CLUSTER</command> on a system catalog.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix bugs in indexing of in-doubt HOT-updated tuples (Tom Lane)
     </para>

     <para>
      These bugs could result in index corruption after reindexing a system
      catalog.  They are not believed to affect user indexes.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix multiple bugs in GiST index page split processing (Heikki
      Linnakangas)
     </para>

     <para>
      The probability of occurrence was low, but these could lead to index
      corruption.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix possible buffer overrun in <function>tsvector_concat()</function>
      (Tom Lane)
     </para>

     <para>
      The function could underestimate the amount of memory needed for its
      result, leading to server crashes.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix crash in <function>xml_recv</function> when processing a
      <quote>standalone</quote> parameter (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Make <function>pg_options_to_table</function> return NULL for an option with no
      value (Tom Lane)
     </para>

     <para>
      Previously such cases would result in a server crash.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid possibly accessing off the end of memory in <command>ANALYZE</command>
      and in SJIS-2004 encoding conversion (Noah Misch)
     </para>

     <para>
      This fixes some very-low-probability server crash scenarios.
     </para>
    </listitem>

    <listitem>
     <para>
      Protect <function>pg_stat_reset_shared()</function> against NULL input (Magnus
      Hagander)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix possible failure when a recovery conflict deadlock is detected
      within a sub-transaction (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid spurious conflicts while recycling btree index pages during hot
      standby (Noah Misch, Simon Riggs)
     </para>
    </listitem>

    <listitem>
     <para>
      Shut down WAL receiver if it's still running at end of recovery (Heikki
      Linnakangas)
     </para>

     <para>
      The postmaster formerly panicked in this situation, but it's actually a
      legitimate case.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix race condition in relcache init file invalidation (Tom Lane)
     </para>

     <para>
      There was a window wherein a new backend process could read a stale init
      file but miss the inval messages that would tell it the data is stale.
      The result would be bizarre failures in catalog accesses, typically
      <quote>could not read block 0 in file ...</quote> later during startup.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix memory leak at end of a GiST index scan (Tom Lane)
     </para>

     <para>
      Commands that perform many separate GiST index scans, such as
      verification of a new GiST-based exclusion constraint on a table
      already containing many rows, could transiently require large amounts of
      memory due to this leak.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix memory leak when encoding conversion has to be done on incoming
      command strings and <command>LISTEN</command> is active (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect memory accounting (leading to possible memory bloat) in
      tuplestores supporting holdable cursors and plpgsql's <literal>RETURN
      NEXT</literal> command (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix trigger <literal>WHEN</literal> conditions when both <literal>BEFORE</literal> and
      <literal>AFTER</literal> triggers exist (Tom Lane)
     </para>

     <para>
      Evaluation of <literal>WHEN</literal> conditions for <literal>AFTER ROW
      UPDATE</literal> triggers could crash if there had been a <literal>BEFORE
      ROW</literal> trigger fired for the same update.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix performance problem when constructing a large, lossy bitmap
      (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix join selectivity estimation for unique columns (Tom Lane)
     </para>

     <para>
      This fixes an erroneous planner heuristic that could lead to poor
      estimates of the result size of a join.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix nested PlaceHolderVar expressions that appear only in sub-select
      target lists (Tom Lane)
     </para>

     <para>
      This mistake could result in outputs of an outer join incorrectly
      appearing as NULL.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow the planner to assume that empty parent tables really are empty
      (Tom Lane)
     </para>

     <para>
      Normally an empty table is assumed to have a certain minimum size for
      planning purposes; but this heuristic seems to do more harm than good
      for the parent table of an inheritance hierarchy, which often is
      permanently empty.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow nested <literal>EXISTS</literal> queries to be optimized properly (Tom
      Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix array- and path-creating functions to ensure padding bytes are
      zeroes (Tom Lane)
     </para>

     <para>
      This avoids some situations where the planner will think that
      semantically-equal constants are not equal, resulting in poor
      optimization.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <command>EXPLAIN</command> to handle gating Result nodes within
      inner-indexscan subplans (Tom Lane)
     </para>

     <para>
      The usual symptom of this oversight was <quote>bogus varno</quote> errors.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix btree preprocessing of <replaceable>indexedcol</replaceable> <literal>IS
      NULL</literal> conditions (Dean Rasheed)
     </para>

     <para>
      Such a condition is unsatisfiable if combined with any other type of
      btree-indexable condition on the same index column.  The case was
      handled incorrectly in 9.0.0 and later, leading to query output where
      there should be none.
     </para>
    </listitem>

    <listitem>
     <para>
      Work around gcc 4.6.0 bug that breaks WAL replay (Tom Lane)
     </para>

     <para>
      This could lead to loss of committed transactions after a server crash.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix dump bug for <literal>VALUES</literal> in a view (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Disallow <literal>SELECT FOR UPDATE/SHARE</literal> on sequences (Tom Lane)
     </para>

     <para>
      This operation doesn't work as expected and can lead to failures.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <command>VACUUM</command> so that it always updates
      <literal>pg_class</literal>.<literal>reltuples</literal>/<literal>relpages</literal> (Tom
      Lane)
     </para>

     <para>
      This fixes some scenarios where autovacuum could make increasingly poor
      decisions about when to vacuum tables.
     </para>
    </listitem>

    <listitem>
     <para>
      Defend against integer overflow when computing size of a hash table (Tom
      Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix cases where <command>CLUSTER</command> might attempt to access
      already-removed TOAST data (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix premature timeout failures during initial authentication transaction
      (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix portability bugs in use of credentials control messages for
      <quote>peer</quote> authentication (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix SSPI login when multiple roundtrips are required (Ahmed Shinwari,
      Magnus Hagander)
     </para>

     <para>
      The typical symptom of this problem was <quote>The function requested is
      not supported</quote> errors during SSPI login.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix failure when adding a new variable of a custom variable class to
      <filename>postgresql.conf</filename> (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Throw an error if <filename>pg_hba.conf</filename> contains <literal>hostssl</literal>
      but SSL is disabled (Tom Lane)
     </para>

     <para>
      This was concluded to be more user-friendly than the previous behavior
      of silently ignoring such lines.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix failure when <command>DROP OWNED BY</command> attempts to remove default
      privileges on sequences (Shigeru Hanada)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix typo in <function>pg_srand48</function> seed initialization (Andres Freund)
     </para>

     <para>
      This led to failure to use all bits of the provided seed.  This function
      is not used on most platforms (only those without <function>srandom</function>),
      and the potential security exposure from a less-random-than-expected
      seed seems minimal in any case.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid integer overflow when the sum of <literal>LIMIT</literal> and
      <literal>OFFSET</literal> values exceeds 2^63 (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Add overflow checks to <type>int4</type> and <type>int8</type> versions of
      <function>generate_series()</function> (Robert Haas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix trailing-zero removal in <function>to_char()</function> (Marti Raudsepp)
     </para>

     <para>
      In a format with <literal>FM</literal> and no digit positions
      after the decimal point, zeroes to the left of the decimal point could
      be removed incorrectly.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <function>pg_size_pretty()</function> to avoid overflow for inputs close to
      2^63 (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Weaken plpgsql's check for typmod matching in record values (Tom Lane)
     </para>

     <para>
      An overly enthusiastic check could lead to discarding length modifiers
      that should have been kept.
     </para>
    </listitem>

    <listitem>
     <para>
      Correctly handle quotes in locale names during <application>initdb</application>
      (Heikki Linnakangas)
     </para>

     <para>
      The case can arise with some Windows locales, such as <quote>People's
      Republic of China</quote>.
     </para>
    </listitem>

    <listitem>
     <para>
      In <application>pg_upgrade</application>, avoid dumping orphaned temporary tables
      (Bruce Momjian)
     </para>

     <para>
      This prevents situations wherein table OID assignments could get out of
      sync between old and new installations.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>pg_upgrade</application> to preserve toast tables' relfrozenxids
      during an upgrade from 8.3 (Bruce Momjian)
     </para>

     <para>
      Failure to do this could lead to <filename>pg_clog</filename> files being
      removed too soon after the upgrade.
     </para>
    </listitem>

    <listitem>
     <para>
      In <application>pg_upgrade</application>, fix the <literal>-l</literal> (log) option to
      work on Windows (Bruce Momjian)
     </para>
    </listitem>

    <listitem>
     <para>
      In <application>pg_ctl</application>, support silent mode for service registrations
      on Windows (MauMau)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>psql</application>'s counting of script file line numbers during
      <literal>COPY</literal> from a different file (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>pg_restore</application>'s direct-to-database mode for
      <varname>standard_conforming_strings</varname> (Tom Lane)
     </para>

     <para>
      <application>pg_restore</application> could emit incorrect commands when restoring
      directly to a database server from an archive file that had been made
      with <varname>standard_conforming_strings</varname> set to <literal>on</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Be more user-friendly about unsupported cases for parallel
      <application>pg_restore</application> (Tom Lane)
     </para>

     <para>
      This change ensures that such cases are detected and reported before
      any restore actions have been taken.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix write-past-buffer-end and memory leak in <application>libpq</application>'s
      LDAP service lookup code (Albe Laurenz)
     </para>
    </listitem>

    <listitem>
     <para>
      In <application>libpq</application>, avoid failures when using nonblocking I/O
      and an SSL connection (Martin Pihlak, Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Improve libpq's handling of failures during connection startup
      (Tom Lane)
     </para>

     <para>
      In particular, the response to a server report of <function>fork()</function>
      failure during SSL connection startup is now saner.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve <application>libpq</application>'s error reporting for SSL failures (Tom
      Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <function>PQsetvalue()</function> to avoid possible crash when adding a new
      tuple to a <structname>PGresult</structname> originally obtained from a server
      query (Andrew Chernow)
     </para>
    </listitem>

    <listitem>
     <para>
      Make <application>ecpglib</application> write <type>double</type> values with 15 digits
      precision (Akira Kurosawa)
     </para>
    </listitem>

    <listitem>
     <para>
      In <application>ecpglib</application>, be sure <literal>LC_NUMERIC</literal> setting is
      restored after an error (Michael Meskes)
     </para>
    </listitem>

    <listitem>
     <para>
      Apply upstream fix for blowfish signed-character bug (CVE-2011-2483)
      (Tom Lane)
     </para>

     <para>
      <filename>contrib/pg_crypto</filename>'s blowfish encryption code could give
      wrong results on platforms where char is signed (which is most),
      leading to encrypted passwords being weaker than they should be.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix memory leak in <filename>contrib/seg</filename> (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <function>pgstatindex()</function> to give consistent results for empty
      indexes (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow building with perl 5.14 (Alex Hunsaker)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix assorted issues with build and install file paths containing spaces
      (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Update time zone data files to <application>tzdata</application> release 2011i
      for DST law changes in Canada, Egypt, Russia, Samoa, and South Sudan.
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0-4">
  <title>Release 9.0.4</title>

  <note>
  <title>Release Date</title>
  <simpara>2011-04-18</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.3.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.4</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

   <para>
    However, if your installation was upgraded from a previous major
    release by running <application>pg_upgrade</application>, you should take
    action to prevent possible data loss due to a now-fixed bug in
    <application>pg_upgrade</application>.  The recommended solution is to run
    <command>VACUUM FREEZE</command> on all TOAST tables.
    More information is available at <ulink
    url="http://wiki.postgresql.org/wiki/20110408pg_upgrade_fix">
    http://wiki.postgresql.org/wiki/20110408pg_upgrade_fix</ulink>.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Fix <application>pg_upgrade</application>'s handling of TOAST tables
      (Bruce Momjian)
     </para>

     <para>
      The <structname>pg_class</structname>.<structfield>relfrozenxid</structfield> value for
      TOAST tables was not correctly copied into the new installation
      during <application>pg_upgrade</application>.  This could later result in
      <literal>pg_clog</literal> files being discarded while they were still
      needed to validate tuples in the TOAST tables, leading to
      <quote>could not access status of transaction</quote> failures.
     </para>

     <para>
      This error poses a significant risk of data loss for installations
      that have been upgraded with <application>pg_upgrade</application>.  This patch
      corrects the problem for future uses of <application>pg_upgrade</application>,
      but does not in itself cure the issue in installations that have been
      processed with a buggy version of <application>pg_upgrade</application>.
     </para>
    </listitem>

    <listitem>
     <para>
      Suppress incorrect <quote>PD_ALL_VISIBLE flag was incorrectly set</quote>
      warning (Heikki Linnakangas)
     </para>

     <para>
      <command>VACUUM</command> would sometimes issue this warning in cases that
      are actually valid.
     </para>
    </listitem>

    <listitem>
     <para>
      Use better SQLSTATE error codes for hot standby conflict cases
      (Tatsuo Ishii and Simon Riggs)
     </para>

     <para>
      All retryable conflict errors now have an error code that indicates
      that a retry is possible.  Also, session closure due to the database
      being dropped on the master is now reported as
      <literal>ERRCODE_DATABASE_DROPPED</literal>, rather than
      <literal>ERRCODE_ADMIN_SHUTDOWN</literal>, so that connection poolers can
      handle the situation correctly.
     </para>
    </listitem>

    <listitem>
     <para>
      Prevent intermittent hang in interactions of startup process with
      bgwriter process (Simon Riggs)
     </para>

     <para>
      This affected recovery in non-hot-standby cases.
     </para>
    </listitem>

    <listitem>
     <para>
      Disallow including a composite type in itself (Tom Lane)
     </para>

     <para>
      This prevents scenarios wherein the server could recurse infinitely
      while processing the composite type.  While there are some possible
      uses for such a structure, they don't seem compelling enough to
      justify the effort required to make sure it always works safely.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid potential deadlock during catalog cache initialization
      (Nikhil Sontakke)
     </para>

     <para>
      In some cases the cache loading code would acquire share lock on a
      system index before locking the index's catalog.  This could deadlock
      against processes trying to acquire exclusive locks in the other,
      more standard order.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix dangling-pointer problem in <literal>BEFORE ROW UPDATE</literal> trigger
      handling when there was a concurrent update to the target tuple
      (Tom Lane)
     </para>

     <para>
      This bug has been observed to result in intermittent <quote>cannot
      extract system attribute from virtual tuple</quote> failures while trying to
      do <literal>UPDATE RETURNING ctid</literal>.  There is a very small probability
      of more serious errors, such as generating incorrect index entries for
      the updated tuple.
     </para>
    </listitem>

    <listitem>
     <para>
      Disallow <command>DROP TABLE</command> when there are pending deferred trigger
      events for the table (Tom Lane)
     </para>

     <para>
      Formerly the <command>DROP</command> would go through, leading to
      <quote>could not open relation with OID nnn</quote> errors when the
      triggers were eventually fired.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <quote>replication</quote> as a user name in
      <filename>pg_hba.conf</filename> (Andrew Dunstan)
     </para>

     <para>
      <quote>replication</quote> is special in the database name column, but it
      was mistakenly also treated as special in the user name column.
     </para>
    </listitem>

    <listitem>
     <para>
      Prevent crash triggered by constant-false WHERE conditions during
      GEQO optimization (Tom Lane)
     </para>

     <para>
     </para>
    </listitem>

    <listitem>
     <para>
      Improve planner's handling of semi-join and anti-join cases
      (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix handling of <literal>SELECT FOR UPDATE</literal> in a sub-SELECT
      (Tom Lane)
     </para>

     <para>
      This bug typically led to <quote>cannot extract system attribute from
      virtual tuple</quote> errors.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix selectivity estimation for text search to account for NULLs
      (Jesper Krogh)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix get_actual_variable_range() to support hypothetical indexes
      injected by an index adviser plugin (Gurjeet Singh)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix PL/Python memory leak involving array slices (Daniel Popowich)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <application>libpq</application>'s SSL initialization to succeed when
      user's home directory is unavailable (Tom Lane)
     </para>

     <para>
      If the SSL mode is such that a root certificate file is not required,
      there is no need to fail.  This change restores the behavior to what
      it was in pre-9.0 releases.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>libpq</application> to return a useful error message for errors
      detected in <function>conninfo_array_parse</function> (Joseph Adams)
     </para>

     <para>
      A typo caused the library to return NULL, rather than the
      <structname>PGconn</structname> structure containing the error message, to the
      application.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>ecpg</application> preprocessor's handling of float constants
      (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix parallel <application>pg_restore</application> to handle comments on
      POST_DATA items correctly (Arnd Hannemann)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>pg_restore</application> to cope with long lines (over 1KB) in
      TOC files (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Put in more safeguards against crashing due to division-by-zero
      with overly enthusiastic compiler optimization (Aurelien Jarno)
     </para>
    </listitem>

    <listitem>
     <para>
      Support use of dlopen() in FreeBSD and OpenBSD on MIPS (Tom Lane)
     </para>

     <para>
      There was a hard-wired assumption that this system function was not
      available on MIPS hardware on these systems.  Use a compile-time test
      instead, since more recent versions have it.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix compilation failures on HP-UX (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid crash when trying to write to the Windows console very early
      in process startup (Rushabh Lathia)
     </para>
    </listitem>

    <listitem>
     <para>
      Support building with MinGW 64 bit compiler for Windows
      (Andrew Dunstan)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix version-incompatibility problem with <application>libintl</application> on
      Windows (Hiroshi Inoue)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix usage of <application>xcopy</application> in Windows build scripts to
      work correctly under Windows 7 (Andrew Dunstan)
     </para>

     <para>
      This affects the build scripts only, not installation or usage.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix path separator used by <application>pg_regress</application> on Cygwin
      (Andrew Dunstan)
     </para>
    </listitem>

    <listitem>
     <para>
      Update time zone data files to <application>tzdata</application> release 2011f
      for DST law changes in Chile, Cuba, Falkland Islands, Morocco, Samoa,
      and Turkey; also historical corrections for South Australia, Alaska,
      and Hawaii.
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0-3">
  <title>Release 9.0.3</title>

  <note>
  <title>Release date</title>
  <simpara>2011-01-31</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.2.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.3</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Before exiting <application>walreceiver</application>, ensure all the received WAL
      is fsync'd to disk (Heikki Linnakangas)
     </para>

     <para>
      Otherwise the standby server could replay some un-synced WAL, conceivably
      leading to data corruption if the system crashes just at that point.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid excess fsync activity in <application>walreceiver</application>
      (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Make <command>ALTER TABLE</command> revalidate uniqueness and exclusion
      constraints when needed (Noah Misch)
     </para>

     <para>
      This was broken in 9.0 by a change that was intended to suppress
      revalidation during <command>VACUUM FULL</command> and <command>CLUSTER</command>,
      but unintentionally affected <command>ALTER TABLE</command> as well.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix EvalPlanQual for <command>UPDATE</command> of an inheritance tree in which
      the tables are not all alike (Tom Lane)
     </para>

     <para>
      Any variation in the table row types (including dropped columns present
      in only some child tables) would confuse the EvalPlanQual code, leading
      to misbehavior or even crashes.  Since EvalPlanQual is only executed
      during concurrent updates to the same row, the problem was only seen
      intermittently.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid failures when <command>EXPLAIN</command> tries to display a simple-form
      <literal>CASE</literal> expression (Tom Lane)
     </para>

     <para>
      If the <literal>CASE</literal>'s test expression was a constant, the planner
      could simplify the <literal>CASE</literal> into a form that confused the
      expression-display code, resulting in <quote>unexpected CASE WHEN
      clause</quote> errors.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix assignment to an array slice that is before the existing range
      of subscripts (Tom Lane)
     </para>

     <para>
      If there was a gap between the newly added subscripts and the first
      pre-existing subscript, the code miscalculated how many entries needed
      to be copied from the old array's null bitmap, potentially leading to
      data corruption or crash.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid unexpected conversion overflow in planner for very distant date
      values (Tom Lane)
     </para>

     <para>
      The <type>date</type> type supports a wider range of dates than can be
      represented by the <type>timestamp</type> types, but the planner assumed it
      could always convert a date to timestamp with impunity.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix PL/Python crash when an array contains null entries (Alex Hunsaker)
     </para>
    </listitem>

    <listitem>
     <para>
      Remove <application>ecpg</application>'s fixed length limit for constants defining
      an array dimension (Michael Meskes)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix erroneous parsing of <type>tsquery</type> values containing
      <literal>... &amp; !(subexpression) | ...</literal> (Tom Lane)
     </para>

     <para>
      Queries containing this combination of operators were not executed
      correctly.  The same error existed in <filename>contrib/intarray</filename>'s
      <type>query_int</type> type and <filename>contrib/ltree</filename>'s
      <type>ltxtquery</type> type.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix buffer overrun in <filename>contrib/intarray</filename>'s input function
      for the <type>query_int</type> type (Apple)
     </para>

     <para>
      This bug is a security risk since the function's return address could
      be overwritten.  Thanks to Apple Inc's security team for reporting this
      issue and supplying the fix.  (CVE-2010-4015)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix bug in <filename>contrib/seg</filename>'s GiST picksplit algorithm
      (Alexander Korotkov)
     </para>

     <para>
      This could result in considerable inefficiency, though not actually
      incorrect answers, in a GiST index on a <type>seg</type> column.
      If you have such an index, consider <command>REINDEX</command>ing it after
      installing this update.  (This is identical to the bug that was fixed in
      <filename>contrib/cube</filename> in the previous update.)
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0-2">
  <title>Release 9.0.2</title>

  <note>
  <title>Release date</title>
  <simpara>2010-12-16</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.1.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.2</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Force the default
      <link linkend="guc-wal-sync-method"><varname>wal_sync_method</varname></link>
      to be <literal>fdatasync</literal> on Linux (Tom Lane, Marti Raudsepp)
     </para>

     <para>
      The default on Linux has actually been <literal>fdatasync</literal> for many
      years, but recent kernel changes caused <productname>PostgreSQL</productname> to
      choose <literal>open_datasync</literal> instead.  This choice did not result
      in any performance improvement, and caused outright failures on
      certain filesystems, notably <literal>ext4</literal> with the
      <literal>data=journal</literal> mount option.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <quote>too many KnownAssignedXids</quote> error during Hot Standby
      replay (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix race condition in lock acquisition during Hot Standby (Simon Riggs)
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid unnecessary conflicts during Hot Standby (Simon Riggs)
     </para>

     <para>
      This fixes some cases where replay was considered to conflict with
      standby queries (causing delay of replay or possibly cancellation of
      the queries), but there was no real conflict.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix assorted bugs in WAL replay logic for GIN indexes (Tom Lane)
     </para>

     <para>
      This could result in <quote>bad buffer id: 0</quote> failures or
      corruption of index contents during replication.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix recovery from base backup when the starting checkpoint WAL record
      is not in the same WAL segment as its redo point (Jeff Davis)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix corner-case bug when streaming replication is enabled immediately
      after creating the master database cluster (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix persistent slowdown of autovacuum workers when multiple workers
      remain active for a long time (Tom Lane)
     </para>

     <para>
      The effective <varname>vacuum_cost_limit</varname> for an autovacuum worker
      could drop to nearly zero if it processed enough tables, causing it
      to run extremely slowly.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix long-term memory leak in autovacuum launcher (Alvaro Herrera)
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid failure when trying to report an impending transaction
      wraparound condition from outside a transaction (Tom Lane)
     </para>

     <para>
      This oversight prevented recovery after transaction wraparound got
      too close, because database startup processing would fail.
     </para>
    </listitem>

    <listitem>
     <para>
      Add support for detecting register-stack overrun on <literal>IA64</literal>
      (Tom Lane)
     </para>

     <para>
      The <literal>IA64</literal> architecture has two hardware stacks.  Full
      prevention of stack-overrun failures requires checking both.
     </para>
    </listitem>

    <listitem>
     <para>
      Add a check for stack overflow in <function>copyObject()</function> (Tom Lane)
     </para>

     <para>
      Certain code paths could crash due to stack overflow given a
      sufficiently complex query.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix detection of page splits in temporary GiST indexes (Heikki
      Linnakangas)
     </para>

     <para>
      It is possible to have a <quote>concurrent</quote> page split in a
      temporary index, if for example there is an open cursor scanning the
      index when an insertion is done.  GiST failed to detect this case and
      hence could deliver wrong results when execution of the cursor
      continued.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix error checking during early connection processing (Tom Lane)
     </para>

     <para>
      The check for too many child processes was skipped in some cases,
      possibly leading to postmaster crash when attempting to add the new
      child process to fixed-size arrays.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve efficiency of window functions (Tom Lane)
     </para>

     <para>
      Certain cases where a large number of tuples needed to be read in
      advance, but <varname>work_mem</varname> was large enough to allow them all
      to be held in memory, were unexpectedly slow.
      <function>percent_rank()</function>, <function>cume_dist()</function> and
      <function>ntile()</function> in particular were subject to this problem.
     </para>
    </listitem>

    <listitem>
     <para>
      Avoid memory leakage while <command>ANALYZE</command>'ing complex index
      expressions (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Ensure an index that uses a whole-row Var still depends on its table
      (Tom Lane)
     </para>

     <para>
      An index declared like <literal>create index i on t (foo(t.*))</literal>
      would not automatically get dropped when its table was dropped.
     </para>
    </listitem>

    <listitem>
     <para>
      Add missing support in <command>DROP OWNED BY</command> for removing foreign
      data wrapper/server privileges belonging to a user (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      Do not <quote>inline</quote> a SQL function with multiple <literal>OUT</literal>
      parameters (Tom Lane)
     </para>

     <para>
      This avoids a possible crash due to loss of information about the
      expected result rowtype.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix crash when inline-ing a set-returning function whose argument list
      contains a reference to an inline-able user function (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Behave correctly if <literal>ORDER BY</literal>, <literal>LIMIT</literal>,
      <literal>FOR UPDATE</literal>, or <literal>WITH</literal> is attached to the
      <literal>VALUES</literal> part of <literal>INSERT ... VALUES</literal> (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Make the <literal>OFF</literal> keyword unreserved (Heikki Linnakangas)
     </para>

     <para>
      This prevents problems with using <literal>off</literal> as a variable name in
      <application>PL/pgSQL</application>.  That worked before 9.0, but was now broken
      because <application>PL/pgSQL</application> now treats all core reserved words
      as reserved.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix constant-folding of <literal>COALESCE()</literal> expressions (Tom Lane)
     </para>

     <para>
      The planner would sometimes attempt to evaluate sub-expressions that
      in fact could never be reached, possibly leading to unexpected errors.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <quote>could not find pathkey item to sort</quote> planner failure
      with comparison of whole-row Vars (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix postmaster crash when connection acceptance
      (<function>accept()</function> or one of the calls made immediately after it)
      fails, and the postmaster was compiled with GSSAPI support (Alexander
      Chernikov)
     </para>
    </listitem>

    <listitem>
     <para>
      Retry after receiving an invalid response packet from a RADIUS
      authentication server (Magnus Hagander)
     </para>

     <para>
      This fixes a low-risk potential denial of service condition.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix missed unlink of temporary files when <varname>log_temp_files</varname>
      is active (Tom Lane)
     </para>

     <para>
      If an error occurred while attempting to emit the log message, the
      unlink was not done, resulting in accumulation of temp files.
     </para>
    </listitem>

    <listitem>
     <para>
      Add print functionality for <structname>InhRelation</structname> nodes (Tom Lane)
     </para>

     <para>
      This avoids a failure when <varname>debug_print_parse</varname> is enabled
      and certain types of query are executed.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect calculation of distance from a point to a horizontal
      line segment (Tom Lane)
     </para>

     <para>
      This bug affected several different geometric distance-measurement
      operators.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect calculation of transaction status in
      <application>ecpg</application> (Itagaki Takahiro)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix errors in <application>psql</application>'s Unicode-escape support (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Speed up parallel <application>pg_restore</application> when the archive
      contains many large objects (blobs) (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>PL/pgSQL</application>'s handling of <quote>simple</quote>
      expressions to not fail in recursion or error-recovery cases (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>PL/pgSQL</application>'s error reporting for no-such-column
      cases (Tom Lane)
     </para>

     <para>
      As of 9.0, it would sometimes report <quote>missing FROM-clause entry
      for table foo</quote> when <quote>record foo has no field bar</quote> would be
      more appropriate.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>PL/Python</application> to honor typmod (i.e., length or
      precision restrictions) when assigning to tuple fields (Tom Lane)
     </para>

     <para>
      This fixes a regression from 8.4.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <application>PL/Python</application>'s handling of set-returning functions
      (Jan Urbanski)
     </para>

     <para>
      Attempts to call SPI functions within the iterator generating a set
      result would fail.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix bug in <filename>contrib/cube</filename>'s GiST picksplit algorithm
      (Alexander Korotkov)
     </para>

     <para>
      This could result in considerable inefficiency, though not actually
      incorrect answers, in a GiST index on a <type>cube</type> column.
      If you have such an index, consider <command>REINDEX</command>ing it after
      installing this update.
     </para>
    </listitem>

    <listitem>
     <para>
      Don't emit <quote>identifier will be truncated</quote> notices in
      <filename>contrib/dblink</filename> except when creating new connections
      (Itagaki Takahiro)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix potential coredump on missing public key in
      <filename>contrib/pgcrypto</filename> (Marti Raudsepp)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix buffer overrun in <filename>contrib/pg_upgrade</filename> (Hernan Gonzalez)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix memory leak in <filename>contrib/xml2</filename>'s XPath query functions
      (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Update time zone data files to <application>tzdata</application> release 2010o
      for DST law changes in Fiji and Samoa;
      also historical corrections for Hong Kong.
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0-1">
  <title>Release 9.0.1</title>

  <note>
  <title>Release date</title>
  <simpara>2010-10-04</simpara>
  </note>

  <para>
   This release contains a variety of fixes from 9.0.0.
   For information about new features in the 9.0 major release, see
   <xref linkend="release-9-0"/>.
  </para>

  <sect2>
   <title>Migration to Version 9.0.1</title>

   <para>
    A dump/restore is not required for those running 9.0.X.
   </para>

  </sect2>

  <sect2>
   <title>Changes</title>

   <itemizedlist>

    <listitem>
     <para>
      Use a separate interpreter for each calling SQL userid in PL/Perl and
      PL/Tcl (Tom Lane)
     </para>

     <para>
      This change prevents security problems that can be caused by subverting
      Perl or Tcl code that will be executed later in the same session under
      another SQL user identity (for example, within a <literal>SECURITY
      DEFINER</literal> function).  Most scripting languages offer numerous ways that
      that might be done, such as redefining standard functions or operators
      called by the target function.  Without this change, any SQL user with
      Perl or Tcl language usage rights can do essentially anything with the
      SQL privileges of the target function's owner.
     </para>

     <para>
      The cost of this change is that intentional communication among Perl
      and Tcl functions becomes more difficult.  To provide an escape hatch,
      PL/PerlU and PL/TclU functions continue to use only one interpreter
      per session.  This is not considered a security issue since all such
      functions execute at the trust level of a database superuser already.
     </para>

     <para>
      It is likely that third-party procedural languages that claim to offer
      trusted execution have similar security issues.  We advise contacting
      the authors of any PL you are depending on for security-critical
      purposes.
     </para>

     <para>
      Our thanks to Tim Bunce for pointing out this issue (CVE-2010-3433).
     </para>
    </listitem>

    <listitem>
     <para>
      Improve <function>pg_get_expr()</function> security fix so that the function
      can still be used on the output of a sub-select (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix incorrect placement of placeholder evaluation (Tom Lane)
     </para>

     <para>
      This bug could result in query outputs being non-null when they
      should be null, in cases where the inner side of an outer join
      is a sub-select with non-strict expressions in its output list.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix join removal's handling of placeholder expressions (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Fix possible duplicate scans of <literal>UNION ALL</literal> member relations
      (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Prevent infinite loop in ProcessIncomingNotify() after unlistening
      (Jeff Davis)
     </para>
    </listitem>

    <listitem>
     <para>
      Prevent show_session_authorization() from crashing within autovacuum
      processes (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Re-allow input of Julian dates prior to 0001-01-01 AD (Tom Lane)
     </para>

     <para>
      Input such as <literal>'J100000'::date</literal> worked before 8.4,
      but was unintentionally broken by added error-checking.
     </para>
    </listitem>

    <listitem>
     <para>
      Make psql recognize <command>DISCARD ALL</command> as a command that should
      not be encased in a transaction block in autocommit-off mode
      (Itagaki Takahiro)
     </para>
    </listitem>

    <listitem>
     <para>
      Update build infrastructure and documentation to reflect the source code
      repository's move from CVS to Git (Magnus Hagander and others)
     </para>
    </listitem>

   </itemizedlist>

  </sect2>
 </sect1>

 <sect1 id="release-9-0">
  <title>Release 9.0</title>

  <note>
   <title>Release date</title>
   <simpara>2010-09-20</simpara>
  </note>

  <sect2>
   <title>Overview</title>

   <para>
    This release of
    <productname>PostgreSQL</productname> adds features that have been requested
    for years, such as easy-to-use replication, a mass permission-changing
    facility, and anonymous code blocks. While past major releases have
    been conservative in their scope, this release shows a
    bold new desire to provide facilities that new and existing
    users of <productname>PostgreSQL</productname> will embrace. This has all
    been done with few incompatibilities. Major enhancements include:
   </para>

   <itemizedlist>

    <!-- This list duplicates items below, but without authors or details-->

    <listitem>

     <para>
      Built-in replication based on log shipping.  This advance consists of
      two features: Streaming Replication, allowing continuous archive
      (<acronym>WAL</acronym>) files to be streamed over a network connection to a
      standby server, and Hot Standby, allowing continuous archive standby
      servers to execute read-only queries.  The net effect is to support a
      single master with multiple read-only slave servers.
     </para>
    </listitem>

    <listitem>
     <para>
      Easier database object permissions management. <link
      linkend="sql-grant"><command>GRANT</command>/<command>REVOKE IN
      SCHEMA</command></link> supports mass permissions changes on existing objects,
      while <link linkend="sql-alterdefaultprivileges"><command>ALTER DEFAULT
      PRIVILEGES</command></link> allows control of privileges for objects created in
      the future.  Large objects (BLOBs) now support permissions management as
      well.
     </para>
    </listitem>

    <listitem>
     <para>
      Broadly enhanced stored procedure support.
      The <link linkend="sql-do"><command>DO</command></link> statement supports
      ad-hoc or <quote>anonymous</quote> code blocks.
      Functions can now be called using named parameters.
      <link linkend="plpgsql">PL/pgSQL</link> is now installed by default, and
      <link linkend="plperl">PL/Perl</link> and <link
      linkend="plpython">PL/Python</link> have been enhanced in several ways,
      including support for Python3.
     </para>
    </listitem>

    <listitem>
     <para>
      Full support for <link linkend="install-windows">64-bit
      <productname>Windows</productname></link>.
     </para>
    </listitem>

    <listitem>
     <para>
      More advanced reporting queries, including additional windowing options
      (<literal>PRECEDING</literal> and <literal>FOLLOWING</literal>) and the ability to
      control the order in which values are fed to aggregate functions.
     </para>
    </listitem>

    <listitem>
     <para>
      New trigger features, including
      SQL-standard-compliant <link
      linkend="sql-createtrigger">per-column triggers</link> and
      conditional trigger execution.
     </para>
    </listitem>

    <listitem>
     <para>
      <link linkend="sql-createtable-compatibility">Deferrable
      unique constraints</link>. Mass updates to unique keys are now possible
      without trickery.
     </para>
    </listitem>

    <listitem>
     <para>
      <link linkend="ddl-constraints-exclusion">Exclusion constraints</link>.
      These provide a generalized version of unique constraints, allowing
      enforcement of complex conditions.
     </para>
    </listitem>

    <listitem>
     <para>
      New and enhanced security features, including RADIUS authentication,
      LDAP authentication improvements, and a new contrib module
      <link linkend="passwordcheck"><filename>passwordcheck</filename></link>
      for testing password strength.
     </para>
    </listitem>

    <listitem>
     <para>
      New high-performance implementation of the
      <link linkend="sql-listen"><command>LISTEN</command></link>/<link
      linkend="sql-notify"><command>NOTIFY</command></link> feature.
      Pending events are now stored in a memory-based queue rather than
      a table.  Also, a <quote>payload</quote> string can be sent with each
      event, rather than transmitting just an event name as before.
     </para>
    </listitem>

    <listitem>
     <para>
      New implementation of
      <link linkend="sql-vacuum"><command>VACUUM FULL</command></link>.
      This command now rewrites the entire table and indexes, rather than
      moving individual rows to compact space.  It is substantially faster
      in most cases, and no longer results in index bloat.
     </para>
    </listitem>

    <listitem>
     <para>
      New contrib module
      <link linkend="pgupgrade"><filename>pg_upgrade</filename></link>
      to support in-place upgrades from 8.3 or 8.4 to 9.0.
     </para>
    </listitem>

    <listitem>
     <para>
      Multiple performance enhancements for specific types of queries,
      including elimination of unnecessary joins.  This helps optimize some
      automatically-generated queries, such as those produced by
      object-relational mappers (ORMs).
     </para>
    </listitem>

    <listitem>
     <para>
      <link linkend="sql-explain"><command>EXPLAIN</command></link> enhancements.
      The output is now available in JSON, XML, or YAML format, and includes
      buffer utilization and other data not previously available.
     </para>
    </listitem>

    <listitem>
     <para>
      <link linkend="hstore"><filename>hstore</filename></link> improvements,
      including new functions and greater data capacity.
     </para>
    </listitem>

   </itemizedlist>

   <para>
    The above items are explained in more detail in the sections below.
   </para>

  </sect2>

  <sect2>

  <title>Migration to Version 9.0</title>

  <para>
   A dump/restore using <application>pg_dump</application>,
   or use of <application>pg_upgrade</application>, is required
   for those wishing to migrate data from any previous
   release.
  </para>

  <para>
   Version 9.0 contains a number of changes that selectively break backwards
   compatibility in order to support new features and code quality
   improvements.  In particular, users who make extensive use of PL/pgSQL,
   Point-In-Time Recovery (PITR), or Warm Standby should test their
   applications because of slight user-visible changes in those areas.
   Observe the following incompatibilities:
  </para>

  <sect3>
   <title>Server Settings</title>

   <itemizedlist>

    <listitem>
     <para>
      Remove server parameter <varname>add_missing_from</varname>, which was
      defaulted to off for many years (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Remove server parameter <varname>regex_flavor</varname>, which
      was defaulted to <link
      linkend="posix-syntax-details"><literal>advanced</literal></link>
      for many years (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      <link linkend="guc-archive-mode"><varname>archive_mode</varname></link>
      now only affects <link
      linkend="guc-archive-command"><varname>archive_command</varname></link>;
      a new setting, <link
      linkend="guc-wal-level"><varname>wal_level</varname></link>, affects
      the contents of the write-ahead log (Heikki Linnakangas)
     </para>
    </listitem>

    <listitem>
     <para>
      <link linkend="guc-log-temp-files"><varname>log_temp_files</varname></link>
      now uses default file size units of kilobytes (Robert Haas)
     </para>
    </listitem>

   </itemizedlist>

  </sect3>

  <sect3>
   <title>Queries</title>

   <itemizedlist>

   <listitem>
    <para>
     When querying a <link linkend="ddl-inherit">parent table</link>,
     do not do any separate permission checks on child tables
     scanned as part of the query (Peter Eisentraut)
    </para>

    <para>
     The SQL standard specifies this behavior, and it is also much more
     convenient in practice than the former behavior of checking permissions
     on each child as well as the parent.
    </para>
   </listitem>

   </itemizedlist>

  </sect3>

  <sect3>
   <title>Data Types</title>

   <itemizedlist>

    <listitem>
     <para>
      <link linkend="datatype-binary"><type>bytea</type></link> output now
      appears in hex format by default (Peter Eisentraut)
     </para>

     <para>
      The server parameter <link
      linkend="guc-bytea-output"><varname>bytea_output</varname></link> can be
      used to select the traditional output format if needed for
      compatibility.
     </para>
    </listitem>

    <listitem>
     <para>
      Array input now considers only plain ASCII whitespace characters
      to be potentially ignorable; it will never ignore non-ASCII characters,
      even if they are whitespace according to some locales (Tom Lane)
     </para>

     <para>
      This avoids some corner cases where array values could be interpreted
      differently depending on the server's locale settings.
     </para>
    </listitem>

   <listitem>
    <para>
     Improve standards compliance of <link
     linkend="functions-similarto-regexp"><literal>SIMILAR TO</literal></link>
     patterns and SQL-style <function>substring()</function> patterns (Tom Lane)
    </para>

    <para>
     This includes treating <literal>?</literal> and <literal>{...}</literal> as
     pattern metacharacters, while they were simple literal characters
     before; that corresponds to new features added in SQL:2008.
     Also, <literal>^</literal> and <literal>$</literal> are now treated as simple
     literal characters; formerly they were treated as metacharacters,
     as if the pattern were following POSIX rather than SQL rules.
     Also, in SQL-standard <function>substring()</function>, use of parentheses
     for nesting no longer interferes with capturing of a substring.
     Also, processing of bracket expressions (character classes) is
     now more standards-compliant.
    </para>
   </listitem>

   <listitem>
    <para>
     Reject negative length values in 3-parameter <link
     linkend="functions-string-sql"><function>substring()</function></link>
     for bit strings, per the SQL standard (Tom Lane)
    </para>
   </listitem>

   <listitem>
    <para>
     Make <function>date_trunc</function> truncate rather than round when reducing
     precision of fractional seconds (Tom Lane)
    </para>

    <para>
     The code always acted this way for integer-based dates/times.
     Now float-based dates/times behave similarly.
    </para>
   </listitem>

  </itemizedlist>

  </sect3>

  <sect3>
   <title>Object Renaming</title>

   <itemizedlist>

    <listitem>
     <para>
      Tighten enforcement of column name consistency during <command>RENAME</command>
      when a child table inherits the same column from multiple unrelated
      parents (KaiGai Kohei)
     </para>
    </listitem>

    <listitem>
     <para>
      No longer automatically rename indexes and index columns when the
      underlying table columns are renamed (Tom Lane)
     </para>

     <para>
      Administrators can still rename such indexes and columns manually.
      This change will require an update of the JDBC driver, and possibly other
      drivers, so that unique indexes are correctly recognized after a rename.
     </para>
    </listitem>

    <listitem>
     <para>
      <command>CREATE OR REPLACE FUNCTION</command> can no longer change
      the declared names of function parameters (Pavel Stehule)
     </para>

     <para>
      In order to avoid creating ambiguity in named-parameter calls, it is
      no longer allowed to change the aliases for input parameters
      in the declaration of an existing function (although names can still
      be assigned to previously unnamed parameters).  You now have to
      <command>DROP</command> and recreate the function to do that.
     </para>
    </listitem>

   </itemizedlist>

  </sect3>

  <sect3>
   <title>PL/pgSQL</title>

   <itemizedlist>

    <listitem>
     <para>
      PL/pgSQL now throws an error if a variable name conflicts with a
      column name used in a query (Tom Lane)
     </para>

     <para>
      The former behavior was to bind ambiguous names to PL/pgSQL variables
      in preference to query columns, which often resulted in surprising
      misbehavior. Throwing an error allows easy detection of ambiguous
      situations.  Although it's recommended that functions encountering this
      type of error be modified to remove the conflict, the old behavior can
      be restored if necessary via the configuration parameter <link
      linkend="plpgsql-var-subst"><varname>plpgsql.variable_conflict</varname></link>,
      or via the per-function option <literal>#variable_conflict</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      PL/pgSQL no longer allows variable names that match certain SQL
      reserved words (Tom Lane)
     </para>

     <para>
      This is a consequence of aligning the PL/pgSQL parser to match the
      core SQL parser more closely.  If necessary,
      variable names can be double-quoted to avoid this restriction.
     </para>
    </listitem>

    <listitem>
     <para>
      PL/pgSQL now requires columns of composite results to match the
      expected type modifier as well as base type (Pavel Stehule, Tom Lane)
     </para>

     <para>
      For example, if a column of the result type is declared as
      <literal>NUMERIC(30,2)</literal>, it is no longer acceptable to return a
      <literal>NUMERIC</literal> of some other precision in that column.  Previous
      versions neglected to check the type modifier and would thus allow
      result rows that didn't actually conform to the declared restrictions.
     </para>
    </listitem>

    <listitem>
     <para>
      PL/pgSQL now treats selection into composite fields more consistently
      (Tom Lane)
     </para>

     <para>
      Formerly, a statement like
      <literal>SELECT ... INTO <replaceable>rec</replaceable>.<replaceable>fld</replaceable> FROM ...</literal>
      was treated as a scalar assignment even if the record field
      <replaceable>fld</replaceable> was of composite type.  Now it is treated as a
      record assignment, the same as when the <literal>INTO</literal> target is a
      regular variable of composite type.  So the values to be assigned to the
      field's subfields should be written as separate columns of the
      <command>SELECT</command> list, not as a <literal>ROW(...)</literal> construct as in
      previous versions.
     </para>

     <para>
      If you need to do this in a way that will work in both 9.0 and previous
      releases, you can write something like
      <literal><replaceable>rec</replaceable>.<replaceable>fld</replaceable> := ROW(...) FROM ...</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Remove PL/pgSQL's <literal>RENAME</literal> declaration (Tom Lane)
     </para>

     <para>
      Instead of <literal>RENAME</literal>, use <link
      linkend="plpgsql-declaration-alias"><literal>ALIAS</literal></link>,
      which can now create an alias for any variable, not only dollar sign
      parameter names (such as <literal>$1</literal>) as before.
     </para>
    </listitem>
   </itemizedlist>

  </sect3>

  <sect3>
   <title>Other Incompatibilities</title>

   <itemizedlist>

    <listitem>
     <para>
      Deprecate use of <literal>=&gt;</literal> as an operator name (Robert Haas)
     </para>

     <para>
      Future versions of <productname>PostgreSQL</productname> will probably reject
      this operator name entirely, in order to support the SQL-standard
      notation for named function parameters.  For the moment, it is
      still allowed, but a warning is emitted when such an operator is
      defined.
     </para>
    </listitem>

    <listitem>
     <para>
      Remove support for platforms that don't have a working 64-bit
      integer data type (Tom Lane)
     </para>

     <para>
      It is believed all still-supported platforms have working 64-bit
      integer data types.
     </para>
    </listitem>

   </itemizedlist>
  </sect3>
 </sect2>

 <sect2>
  <title>Changes</title>
   <para>
    Version 9.0 has an unprecedented number of new major features,
    and over 200 enhancements, improvements, new commands,
    new functions, and other changes.
   </para>

  <sect3>
   <title>Server</title>

   <sect4>
    <title>Continuous Archiving and Streaming Replication</title>

    <para>
     PostgreSQL's existing standby-server capability has been expanded both to
     support read-only queries on standby servers and to greatly reduce
     the lag between master and standby servers.  For many users, this
     will be a useful and low-administration form of replication, either
     for high availability or for horizontal scalability.
    </para>

    <itemizedlist>
     <listitem>
      <para>
       Allow a standby server to accept read-only queries
       (Simon Riggs, Heikki Linnakangas)
      </para>

      <para>
       This feature is called Hot Standby. There are new
       <filename>postgresql.conf</filename> and <filename>recovery.conf</filename>
       settings to control this feature, as well as extensive
       <link linkend="hot-standby">documentation</link>.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow write-ahead log (<acronym>WAL</acronym>) data to be streamed to a
       standby server (Fujii Masao, Heikki Linnakangas)
      </para>

      <para>
       This feature is called Streaming Replication.
       Previously <acronym>WAL</acronym> data could be sent to standby servers only
       in units of entire <acronym>WAL</acronym> files (normally 16 megabytes each).
       Streaming Replication eliminates this inefficiency and allows updates
       on the master to be propagated to standby servers with very little
       delay.  There are new <filename>postgresql.conf</filename> and
       <filename>recovery.conf</filename> settings to control this feature, as well as
       extensive <link linkend="streaming-replication">documentation</link>.
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link
       linkend="functions-recovery-info-table"><function>pg_last_xlog_receive_location()</function></link>
       and <function>pg_last_xlog_replay_location()</function>, which
       can be used to monitor standby server <acronym>WAL</acronym>
       activity (Simon Riggs, Fujii Masao, Heikki Linnakangas)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Performance</title>

    <itemizedlist>

     <listitem>
      <para>
       Allow per-tablespace values to be set for sequential and random page
       cost estimates (<varname>seq_page_cost</varname>/<varname>random_page_cost</varname>)
       via <link linkend="sql-altertablespace"><command>ALTER TABLESPACE
       ... SET/RESET</command></link> (Robert Haas)
      </para>
     </listitem>

     <listitem>
      <para>
       Improve performance and reliability of EvalPlanQual rechecks in join
       queries (Tom Lane)
      </para>

      <para>
       <command>UPDATE</command>, <command>DELETE</command>, and <command>SELECT FOR
       UPDATE/SHARE</command> queries that involve joins will now behave much better
       when encountering freshly-updated rows.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve performance of <link
       linkend="sql-truncate"><command>TRUNCATE</command></link> when
       the table was created or truncated earlier in the same transaction
       (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Improve performance of finding inheritance child tables (Tom Lane)
      </para>
     </listitem>

     </itemizedlist>

   </sect4>

   <sect4>
    <title>Optimizer</title>

    <itemizedlist>

     <listitem>
      <para>
       Remove unnecessary <link linkend="queries-join">outer
       joins</link> (Robert Haas)
      </para>

      <para>
       Outer joins where the inner side is unique and not referenced above
       the join are unnecessary and are therefore now removed.  This will
       accelerate many automatically generated queries, such as those created
       by object-relational mappers (ORMs).
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <literal>IS NOT NULL</literal> restrictions to use indexes (Tom Lane)
      </para>

      <para>
       This is particularly useful for finding
       <function>MAX()</function>/<function>MIN()</function> values in indexes that
       contain many null values.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve the optimizer's choices about when to use materialize nodes,
       and when to use sorting versus hashing for <literal>DISTINCT</literal>
       (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Improve the optimizer's equivalence detection for expressions involving
       <type>boolean</type> <literal>&lt;&gt;</literal> operators (Tom Lane)
      </para>
     </listitem>
    </itemizedlist>
   </sect4>

   <sect4>
    <title><link linkend="geqo">GEQO</link></title>

    <itemizedlist>

     <listitem>
      <para>
       Use the same random seed every time GEQO plans a query (Andres
       Freund)
      </para>

      <para>
       While the Genetic Query Optimizer (GEQO) still selects
       random plans, it now always selects the same random plans for identical
       queries, thus giving more consistent performance. You can modify <link
       linkend="guc-geqo-seed"><varname>geqo_seed</varname></link> to experiment with
       alternative plans.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve GEQO plan selection (Tom Lane)
      </para>

      <para>
       This avoids the rare error <quote>failed to make a valid plan</quote>,
       and should also improve planning speed.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Optimizer Statistics</title>

    <itemizedlist>

     <listitem>
      <para>
       Improve <link linkend="sql-analyze"><command>ANALYZE</command></link>
       to support inheritance-tree statistics (Tom Lane)
      </para>

      <para>
       This is particularly useful for partitioned tables.  However,
       autovacuum does not yet automatically re-analyze parent tables
       when child tables change.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve <link linkend="routine-vacuuming">autovacuum</link>'s
       detection of when re-analyze is necessary (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Improve optimizer's estimation for greater/less-than comparisons
       (Tom Lane)
      </para>

      <para>
       When looking up statistics for greater/less-than comparisons,
       if the comparison value is in the first or last histogram bucket,
       use an index (if available) to fetch the current actual column
       minimum or maximum.  This greatly improves the accuracy of estimates
       for comparison values near the ends of the data range, particularly
       if the range is constantly changing due to addition of new data.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow setting of number-of-distinct-values statistics using <link
       linkend="sql-altertable"><command>ALTER TABLE</command></link>
       (Robert Haas)
      </para>

      <para>
       This allows users to override the estimated number or percentage of
       distinct values for a column. This statistic is normally computed by
       <command>ANALYZE</command>, but the estimate can be poor, especially on tables
       with very large numbers of rows.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Authentication</title>

    <itemizedlist>

     <listitem>
      <para>
       Add support for <link
       linkend="auth-radius"><acronym>RADIUS</acronym></link> (Remote
       Authentication Dial In User Service) authentication
       (Magnus Hagander)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <link linkend="auth-ldap"><acronym>LDAP</acronym></link>
       (Lightweight Directory Access Protocol) authentication
       to operate in <quote>search/bind</quote> mode
       (Robert Fleming, Magnus Hagander)
      </para>

      <para>
       This allows the user to be looked up first, then the system uses
       the <acronym>DN</acronym> (Distinguished Name) returned for that user.
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link
       linkend="auth-pg-hba-conf"><literal>samehost</literal></link>
       and <literal>samenet</literal> designations to
       <filename>pg_hba.conf</filename> (Stef Walter)
      </para>

      <para>
       These match the server's <acronym>IP</acronym> address and subnet address
       respectively.
      </para>
     </listitem>

     <listitem>
      <para>
       Pass trusted SSL root certificate names to the client so the client
       can return an appropriate client certificate (Craig Ringer)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Monitoring</title>

    <itemizedlist>

     <listitem>
      <para>
       Add the ability for clients to set an <link
       linkend="libpq-connect-application-name">application
       name</link>, which is displayed in
       <structname>pg_stat_activity</structname> (Dave Page)
      </para>

      <para>
       This allows administrators to characterize database traffic
       and troubleshoot problems by source application.
      </para>
     </listitem>

     <listitem>
      <para>
       Add a SQLSTATE option (<literal>%e</literal>) to <link
       linkend="guc-log-line-prefix"><varname>log_line_prefix</varname></link>
       (Guillaume Smet)
      </para>

      <para>
       This allows users to compile statistics on errors and messages
       by error code number.
      </para>

     </listitem>

     <listitem>
      <para>
       Write to the Windows event log in <acronym>UTF16</acronym> encoding
       (Itagaki Takahiro)
      </para>

      <para>
       Now there is true multilingual support for PostgreSQL log messages
       on Windows.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Statistics Counters</title>

    <itemizedlist>

     <listitem>
      <para>
       Add <link
       linkend="monitoring-stats-funcs-table"><function>pg_stat_reset_shared('bgwriter')</function></link>
       to reset the cluster-wide shared statistics for the
       background writer (Greg Smith)
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link
       linkend="monitoring-stats-funcs-table"><function>pg_stat_reset_single_table_counters()</function></link>
       and <function>pg_stat_reset_single_function_counters()</function>
       to allow resetting the statistics counters for individual
       tables and functions (Magnus Hagander)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Server Settings</title>

    <itemizedlist>

     <listitem>
      <para>
       Allow setting of configuration parameters based on <link
       linkend="sql-alterrole">database/role combinations</link>
       (Alvaro Herrera)
      </para>

      <para>
       Previously only per-database and per-role settings were possible,
       not combinations. All role and database settings are now stored
       in the new <structname>pg_db_role_setting</structname> system catalog. A new
       <application>psql</application> command <literal>\drds</literal> shows these settings.
       The legacy system views <structname>pg_roles</structname>,
       <structname>pg_shadow</structname>, and <structname>pg_user</structname>
       do not show combination settings, and therefore no longer
       completely represent the configuration for a user or database.
      </para>
     </listitem>

     <listitem>
      <para>
       Add server parameter <link
       linkend="guc-bonjour"><varname>bonjour</varname></link>, which
       controls whether a Bonjour-enabled server advertises
       itself via <productname>Bonjour</productname> (Tom Lane)
      </para>

      <para>
       The default is off, meaning it does not advertise.  This allows
       packagers to distribute Bonjour-enabled builds without worrying
       that individual users might not want the feature.
      </para>
     </listitem>

     <listitem>
      <para>
       Add server parameter <link
       linkend="guc-enable-material"><varname>enable_material</varname></link>, which
       controls the use of materialize nodes in the optimizer
       (Robert Haas)
      </para>

      <para>
       The default is on.  When off, the optimizer will not add
       materialize nodes purely for performance reasons, though they
       will still be used when necessary for correctness.
      </para>
     </listitem>

     <listitem>
      <para>
       Change server parameter <link
       linkend="guc-log-temp-files"><varname>log_temp_files</varname></link> to
       use default file size units of kilobytes (Robert Haas)
      </para>

      <para>
       Previously this setting was interpreted in bytes if no units were
       specified.
      </para>
     </listitem>

     <listitem>
      <para>
       Log changes of parameter values when <filename>postgresql.conf</filename> is
       reloaded (Peter Eisentraut)
      </para>

      <para>
       This lets administrators and security staff audit changes of database
       settings, and is also very convenient for checking the effects of
       <filename>postgresql.conf</filename> edits.
      </para>
     </listitem>

     <listitem>
      <para>
       Properly enforce superuser permissions for custom server parameters
       (Tom Lane)
      </para>

      <para>
       Non-superusers can no longer issue <command>ALTER
       ROLE</command>/<command>DATABASE SET</command> for parameters that are not currently
       known to the server.  This allows the server to correctly check that
       superuser-only parameters are only set by superusers.  Previously,
       the <literal>SET</literal> would be allowed and then ignored at session start,
       making superuser-only custom parameters much less useful than they
       should be.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Queries</title>

   <itemizedlist>

    <listitem>
     <para>
      Perform <link linkend="sql-for-update-share"><command>SELECT
      FOR UPDATE</command>/<literal>SHARE</literal></link> processing after
      applying <literal>LIMIT</literal>, so the number of rows returned
      is always predictable (Tom Lane)
     </para>

     <para>
      Previously, changes made by concurrent transactions could cause a
      <command>SELECT FOR UPDATE</command> to unexpectedly return fewer rows than
      specified by its <literal>LIMIT</literal>. <literal>FOR UPDATE</literal> in combination
      with <literal>ORDER BY</literal> can still produce surprising results, but that
      can be corrected by placing <literal>FOR UPDATE</literal> in a subquery.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow mixing of traditional and SQL-standard <link
      linkend="sql-limit"><literal>LIMIT</literal>/<literal>OFFSET</literal></link>
      syntax (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Extend the supported frame options in <link
      linkend="sql-window">window functions</link> (Hitoshi
      Harada)
     </para>

     <para>
      Frames can now start with <literal>CURRENT ROW</literal>, and the <literal>ROWS
      <replaceable>n</replaceable> PRECEDING</literal>/<literal>FOLLOWING</literal> options are now
      supported.
     </para>
    </listitem>

    <listitem>
     <para>
      Make <command>SELECT INTO</command> and <command>CREATE TABLE AS</command> return
      row counts to the client in their command tags
      (Boszormenyi Zoltan)
     </para>

     <para>
      This can save an entire round-trip to the client, allowing result counts
      and pagination to be calculated without an additional
      <command>COUNT</command> query.
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title>Unicode Strings</title>

    <itemizedlist>

     <listitem>
      <para>
       Support Unicode surrogate pairs (dual 16-bit representation) in
       <link
       linkend="sql-syntax-strings-uescape"><literal>U&amp;</literal></link>
       strings and identifiers (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Support Unicode escapes in <link
       linkend="sql-syntax-strings-escape"><literal>E'...'</literal></link>
       strings (Marko Kreen)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Object Manipulation</title>

   <itemizedlist>

    <listitem>
     <para>
      Speed up <link linkend="sql-createdatabase"><command>CREATE
      DATABASE</command></link> by deferring flushes to disk (Andres
      Freund, Greg Stark)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <link linkend="sql-comment">comments</link> on
      columns of tables, views, and composite types only, not other
      relation types such as indexes and <acronym>TOAST</acronym> tables (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow the creation of <link
      linkend="sql-createtype-enum">enumerated types</link> containing
      no values (Bruce Momjian)
     </para>
    </listitem>

    <listitem>
     <para>
      Let values of columns having storage type <literal>MAIN</literal> remain on
      the main heap page unless the row cannot fit on a page (Kevin Grittner)
     </para>

     <para>
      Previously <literal>MAIN</literal> values were forced out to <acronym>TOAST</acronym>
      tables until the row size was less than one-quarter of the page size.
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title><command>ALTER TABLE</command></title>

    <itemizedlist>

     <listitem>
      <para>
       Implement <literal>IF EXISTS</literal> for <literal>ALTER TABLE DROP COLUMN</literal>
       and <literal>ALTER TABLE DROP CONSTRAINT </literal> (Andres Freund)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <command>ALTER TABLE</command> commands that rewrite tables to skip
       <acronym>WAL</acronym> logging (Itagaki Takahiro)
      </para>

      <para>
       Such operations either produce a new copy of the table or are rolled
       back, so <acronym>WAL</acronym> archiving can be skipped, unless running in
       continuous archiving mode.  This reduces I/O overhead and improves
       performance.
      </para>
     </listitem>

     <listitem>
      <para>
       Fix failure of <literal>ALTER TABLE <replaceable>table</replaceable> ADD COLUMN
       <replaceable>col</replaceable> serial</literal> when done by non-owner of table
       (Tom Lane)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link linkend="sql-createtable"><command>CREATE TABLE</command></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Add support for copying <literal>COMMENTS</literal> and <literal>STORAGE</literal>
       settings in <command>CREATE TABLE ... LIKE</command> commands
       (Itagaki Takahiro)
      </para>
     </listitem>

     <listitem>
      <para>
       Add a shortcut for copying all properties in <command>CREATE
       TABLE ... LIKE</command> commands (Itagaki Takahiro)
      </para>
     </listitem>

     <listitem>
      <para>
       Add the SQL-standard
       <literal>CREATE TABLE ... OF <replaceable>type</replaceable></literal> command
       (Peter Eisentraut)
      </para>

      <para>
       This allows creation of a table that matches an existing composite
       type. Additional constraints and defaults can be specified in the
       command.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Constraints</title>

    <itemizedlist>

     <listitem>
      <para>
       Add <link linkend="sql-createtable-compatibility">deferrable
       unique constraints</link> (Dean Rasheed)
      </para>

      <para>
       This allows mass updates, such as
       <literal>UPDATE tab SET col = col + 1</literal>,
       to work reliably
       on columns that have unique indexes or are marked as primary keys.
       If the constraint is specified as <literal>DEFERRABLE</literal> it will be
       checked at the end of the statement, rather than after each row is
       updated. The constraint check can also be deferred until the end of the
       current transaction, allowing such updates to be spread over multiple
       SQL commands.
      </para>
     </listitem>

     <listitem>
      <para>
       Add
       <link linkend="ddl-constraints-exclusion">exclusion constraints</link>
       (Jeff Davis)
      </para>

      <para>
       Exclusion constraints generalize uniqueness constraints by allowing
       arbitrary comparison operators, not just equality.  They are created
       with the <link linkend="sql-createtable-exclude"><command>CREATE
       TABLE CONSTRAINT ... EXCLUDE</command></link> clause.
       The most common use of exclusion constraints is to specify that column
       entries must not overlap, rather than simply not be equal.  This is
       useful for time periods and other ranges, as well as arrays.
       This feature enhances checking of data integrity for many
       calendaring, time-management, and scientific applications.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve uniqueness-constraint violation error messages to
       report the values causing the failure (Itagaki Takahiro)
      </para>

      <para>
       For example, a uniqueness constraint violation might now report
       <literal>Key (x)=(2) already exists</literal>.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Object Permissions</title>

    <itemizedlist>

     <listitem>
      <para>
       Add the ability to make mass permission changes across a whole
       schema using the new <link
       linkend="sql-grant"><command>GRANT</command>/<command>REVOKE
       IN SCHEMA</command></link> clause (Petr Jelinek)
      </para>

      <para>
       This simplifies management of object permissions
       and makes it easier to utilize database roles for application
       data security.
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link linkend="sql-alterdefaultprivileges"><command>ALTER
       DEFAULT PRIVILEGES</command></link> command to control privileges
       of objects created later (Petr Jelinek)
      </para>

      <para>
       This greatly simplifies the assignment of object privileges in a
       complex database application.  Default privileges can be set for
       tables, views, sequences, and functions. Defaults may be assigned on a
       per-schema basis, or database-wide.
      </para>
     </listitem>

     <listitem>
      <para>
       Add the ability to control large object (BLOB) permissions with
       <command>GRANT</command>/<command>REVOKE</command> (KaiGai Kohei)
      </para>

      <para>
       Formerly, any database user could read or modify any large object.
       Read and write permissions can now be granted and revoked per
       large object, and the ownership of large objects is tracked.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Utility Operations</title>

   <itemizedlist>

    <listitem>
     <para>
      Make <link linkend="sql-listen"><command>LISTEN</command></link>/<link
      linkend="sql-notify"><command>NOTIFY</command></link> store pending events
      in a memory queue, rather than in a system table (Joachim
      Wieland)
     </para>

     <para>
      This substantially improves performance, while retaining the existing
      features of transactional support and guaranteed delivery.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <link linkend="sql-notify"><command>NOTIFY</command></link>
      to pass an optional <quote>payload</quote> string to listeners
      (Joachim Wieland)
     </para>

     <para>
      This greatly improves the usefulness of
      <command>LISTEN</command>/<command>NOTIFY</command> as a
      general-purpose event queue system.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow <link linkend="sql-cluster"><command>CLUSTER</command></link>
      on all per-database system catalogs (Tom Lane)
     </para>

     <para>
      Shared catalogs still cannot be clustered.
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title><link linkend="sql-copy"><command>COPY</command></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Accept <literal>COPY ... CSV FORCE QUOTE *</literal>
       (Itagaki Takahiro)
      </para>

      <para>
       Now <literal>*</literal> can be used as shorthand for <quote>all columns</quote>
       in the <literal>FORCE QUOTE</literal> clause.
      </para>
     </listitem>

     <listitem>
      <para>
       Add new <command>COPY</command> syntax that allows options to be
       specified inside parentheses (Robert Haas, Emmanuel Cecchet)
      </para>

      <para>
       This allows greater flexibility for future <command>COPY</command> options.
       The old syntax is still supported, but only for pre-existing options.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link linkend="sql-explain"><command>EXPLAIN</command></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Allow <command>EXPLAIN</command> to output in <acronym>XML</acronym>,
       <acronym>JSON</acronym>, or <acronym>YAML</acronym> format (Robert Haas, Greg
       Sabino Mullane)
      </para>

      <para>
       The new output formats are easily machine-readable, supporting the
       development of new tools for analysis of <command>EXPLAIN</command> output.
      </para>
     </listitem>

     <listitem>
      <para>
       Add new <literal>BUFFERS</literal> option to report query
       buffer usage during <command>EXPLAIN ANALYZE</command> (Itagaki Takahiro)
      </para>

      <para>
       This allows better query profiling for individual queries.
       Buffer usage is no longer reported in the output for <link
       linkend="runtime-config-statistics-monitor">log_statement_stats</link>
       and related settings.
      </para>
     </listitem>

     <listitem>
      <para>
       Add hash usage information to <command>EXPLAIN</command> output (Robert
       Haas)
      </para>
     </listitem>

     <listitem>
      <para>
       Add new <command>EXPLAIN</command> syntax that allows options to be
       specified inside parentheses (Robert Haas)
      </para>

      <para>
       This allows greater flexibility for future <command>EXPLAIN</command> options.
       The old syntax is still supported, but only for pre-existing options.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link linkend="sql-vacuum"><command>VACUUM</command></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Change <command>VACUUM FULL</command> to rewrite the entire table and
       rebuild its indexes, rather than moving individual rows around to
       compact space (Itagaki Takahiro, Tom Lane)
      </para>

      <para>
       The previous method was usually slower and caused index bloat.
       Note that the new method will use more disk space transiently
       during <command>VACUUM FULL</command>; potentially as much as twice
       the space normally occupied by the table and its indexes.
      </para>

     </listitem>

     <listitem>
      <para>
       Add new <command>VACUUM</command> syntax that allows options to be
       specified inside parentheses (Itagaki Takahiro)
      </para>

      <para>
       This allows greater flexibility for future <command>VACUUM</command> options.
       The old syntax is still supported, but only for pre-existing options.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Indexes</title>

    <itemizedlist>

     <listitem>
      <para>
       Allow an index to be named automatically by omitting the index name in
       <link linkend="sql-createindex"><command>CREATE INDEX</command></link>
       (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       By default, multicolumn indexes are now named after all their columns;
       and index expression columns are now named based on their expressions
       (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Reindexing shared system catalogs is now fully transactional
       and crash-safe (Tom Lane)
      </para>

      <para>
       Formerly, reindexing a shared index was only allowed in standalone
       mode, and a crash during the operation could leave the index in
       worse condition than it was before.
      </para>
     </listitem>

     <listitem>
      <para>
       Add <literal>point_ops</literal> operator class for <acronym>GiST</acronym>
      (Teodor Sigaev)
      </para>

      <para>
       This feature permits <acronym>GiST</acronym> indexing of <type>point</type>
       columns.  The index can be used for several types of queries
       such as <replaceable>point</replaceable> <literal>&lt;@</literal> <replaceable>polygon</replaceable>
       (point is in polygon).  This should make many
       <productname>PostGIS</productname> queries faster.
      </para>
     </listitem>

     <listitem>
      <para>
       Use red-black binary trees for <acronym>GIN</acronym> index creation
       (Teodor Sigaev)
      </para>

      <para>
       Red-black trees are self-balancing.  This avoids slowdowns in
       cases where the input is in nonrandom order.
      </para>

     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Data Types</title>

   <itemizedlist>

    <listitem>
     <para>
      Allow <link linkend="datatype-binary"><type>bytea</type></link> values
      to be written in hex notation (Peter Eisentraut)
     </para>

     <para>
      The server parameter <link
      linkend="guc-bytea-output"><varname>bytea_output</varname></link> controls
      whether hex or traditional format is used for <type>bytea</type>
      output.  Libpq's <function>PQescapeByteaConn()</function> function automatically
      uses the hex format when connected to <productname>PostgreSQL</productname> 9.0
      or newer servers.
     </para>

     <para>
      The new hex format will be directly compatible with more applications
      that use binary data, allowing them to store and retrieve it without
      extra conversion.  It is also significantly faster to read and write
      than the traditional format.
     </para>
    </listitem>

    <listitem>
     <para>
      Allow server parameter <link
      linkend="guc-extra-float-digits">extra_float_digits</link>
      to be increased to <literal>3</literal> (Tom Lane)
     </para>

     <para>
      The previous maximum <varname>extra_float_digits</varname> setting was
      <literal>2</literal>.  There are cases where 3 digits are needed to dump and
      restore <type>float4</type> values exactly.  <application>pg_dump</application> will
      now use the setting of 3 when dumping from a server that allows it.
     </para>
    </listitem>

    <listitem>
     <para>
      Tighten input checking for <type>int2vector</type> values (Caleb
      Welton)
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title><link linkend="textsearch">Full Text Search</link></title>

    <itemizedlist>

     <listitem>
      <para>
       Add prefix support in <literal>synonym</literal> dictionaries
       (Teodor Sigaev)
      </para>
     </listitem>

     <listitem>
      <para>
       Add <firstterm>filtering</firstterm> dictionaries (Teodor Sigaev)
      </para>

      <para>
       Filtering dictionaries allow tokens to be modified then passed to
       subsequent dictionaries.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow underscores in email-address tokens (Teodor Sigaev)
      </para>
     </listitem>

     <listitem>
      <para>
       Use more standards-compliant rules for parsing <acronym>URL</acronym> tokens
       (Tom Lane)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Functions</title>

   <itemizedlist>

    <listitem>
     <para>
      Allow function calls to supply parameter names and match them to named
      parameters in the function definition (Pavel Stehule)
     </para>

     <para>
      For example, if a function is defined to take parameters <literal>a</literal>
      and <literal>b</literal>, it can be called with <literal>func(a := 7, b
      := 12)</literal> or <literal>func(b := 12, a := 7)</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Support locale-specific <link
      linkend="functions-posix-regexp">regular expression</link>
      processing with <acronym>UTF-8</acronym> server encoding (Tom Lane)
     </para>

     <para>
      Locale-specific regular expression functionality includes
      case-insensitive matching and locale-specific character classes.
      Previously, these features worked correctly for non-<acronym>ASCII</acronym>
      characters only if the database used a single-byte server encoding (such
      as LATIN1).  They will still misbehave in multi-byte encodings other
      than <acronym>UTF-8</acronym>.
     </para>
    </listitem>

    <listitem>
     <para>
      Add support for scientific notation in <link
      linkend="functions-formatting"><function>to_char()</function></link>
      (<link linkend="functions-formatting-numeric-table"><literal>EEEE</literal>
      specification</link>)
      (Pavel Stehule, Brendan Jurd)
     </para>
    </listitem>

    <listitem>
     <para>
      Make <function>to_char()</function> honor <link
      linkend="functions-formatting-datetimemod-table"><literal>FM</literal></link>
      (fill mode) in <literal>Y</literal>, <literal>YY</literal>, and
      <literal>YYY</literal> specifications (Bruce Momjian, Tom Lane)
     </para>

     <para>
      It was already honored by <literal>YYYY</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Fix <function>to_char()</function> to output localized numeric and monetary
      strings in the correct encoding on <productname>Windows</productname>
      (Hiroshi Inoue, Itagaki Takahiro, Bruce Momjian)
     </para>
    </listitem>

    <listitem>
     <para>
      Correct calculations of <link
      linkend="functions-geometry-op-table"><quote>overlaps</quote></link>
      and <quote>contains</quote> operations for polygons (Teodor Sigaev)
     </para>

     <para>
      The polygon <literal>&amp;&amp;</literal> (overlaps) operator formerly just
      checked to see if the two polygons' bounding boxes overlapped.  It now
      does a more correct check.  The polygon <literal>@&gt;</literal> and
      <literal>&lt;@</literal> (contains/contained by) operators formerly checked
      to see if one polygon's vertexes were all contained in the other;
      this can wrongly report <quote>true</quote> for some non-convex polygons.
      Now they check that all line segments of one polygon are contained in
      the other.
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title>Aggregates</title>

    <itemizedlist>

     <listitem>
      <para>
       Allow aggregate functions to use <link
       linkend="syntax-aggregates"><literal>ORDER BY</literal></link> (Andrew Gierth)
      </para>

      <para>
       For example, this is now supported: <literal>array_agg(a ORDER BY
       b)</literal>.  This is useful with aggregates for which the order of input
       values is significant, and eliminates the need to use a nonstandard
       subquery to determine the ordering.
      </para>
     </listitem>

     <listitem>
      <para>
       Multi-argument aggregate functions can now use <literal>DISTINCT</literal>
       (Andrew Gierth)
      </para>
     </listitem>

     <listitem>
      <para>
       Add the <link
       linkend="functions-aggregate-table"><function>string_agg()</function></link>
       aggregate function to combine values into a single
       string (Pavel Stehule)
      </para>
     </listitem>

     <listitem>
      <para>
       Aggregate functions that are called with <literal>DISTINCT</literal> are
       now passed NULL values if the aggregate transition function is
       not marked as <literal>STRICT</literal> (Andrew Gierth)
      </para>

      <para>
       For example, <literal>agg(DISTINCT x)</literal> might pass a NULL <literal>x</literal>
       value to <function>agg()</function>.  This is more consistent with the behavior
       in non-<literal>DISTINCT</literal> cases.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Bit Strings</title>

    <itemizedlist>

     <listitem>
      <para>
       Add <link
       linkend="functions-binarystring-other"><function>get_bit()</function></link>
       and <function>set_bit()</function> functions for <type>bit</type>
       strings, mirroring those for <type>bytea</type> (Leonardo
       F)
      </para>
     </listitem>

     <listitem>
      <para>
       Implement <link
       linkend="functions-string-sql"><function>OVERLAY()</function></link>
       (replace) for <type>bit</type> strings and <type>bytea</type>
       (Leonardo F)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Object Information Functions</title>

    <itemizedlist>

     <listitem>
      <para>
       Add <link
       linkend="functions-admin-dbsize"><function>pg_table_size()</function></link>
       and <function>pg_indexes_size()</function> to provide a more
       user-friendly interface to the <function>pg_relation_size()</function>
       function (Bernd Helmle)
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link
       linkend="functions-info-access-table"><function>has_sequence_privilege()</function></link>
       for sequence permission checking (Abhijit Menon-Sen)
      </para>
     </listitem>

     <listitem>
      <para>
       Update the <link linkend="information-schema">information_schema</link>
       views to conform to SQL:2008
       (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Make the <literal>information_schema</literal> views correctly display maximum
       octet lengths for <type>char</type> and <type>varchar</type> columns (Peter
       Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Speed up <literal>information_schema</literal> privilege views
       (Joachim Wieland)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Function and Trigger Creation</title>

    <itemizedlist>

     <listitem>
      <para>
       Support execution of anonymous code blocks using the <link
       linkend="sql-do"><command>DO</command></link> statement
       (Petr Jelinek, Joshua Tolley, Hannu Valtonen)
      </para>

      <para>
       This allows execution of server-side code without the need to create
       and delete a temporary function definition.  Code can be executed in
       any language for which the user has permissions to define a function.
      </para>
     </listitem>

     <listitem>
      <para>
       Implement SQL-standard-compliant <link
       linkend="sql-createtrigger">per-column triggers</link>
       (Itagaki Takahiro)
      </para>

      <para>
       Such triggers are fired only when the specified column(s) are affected
       by the query, e.g. appear in an <command>UPDATE</command>'s <literal>SET</literal>
       list.
      </para>
     </listitem>

     <listitem>
      <para>
       Add the <literal>WHEN</literal> clause to <link
       linkend="sql-createtrigger"><command>CREATE TRIGGER</command></link>
       to allow control over whether a trigger is fired (Itagaki
       Takahiro)
      </para>

      <para>
       While the same type of check can always be performed inside the
       trigger, doing it in an external <literal>WHEN</literal> clause can have
       performance benefits.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Server-Side Languages</title>

   <itemizedlist>

    <listitem>
     <para>
      Add the <literal>OR REPLACE</literal> clause to <link
      linkend="sql-createlanguage"><command>CREATE LANGUAGE</command></link>
      (Tom Lane)
     </para>

     <para>
      This is helpful to optionally install a language if it does not
      already exist, and is particularly helpful now that PL/pgSQL is
      installed by default.
     </para>
    </listitem>

    </itemizedlist>

    <sect4>
    <title><link linkend="plpgsql">PL/PgSQL</link> Server-Side
    Language</title>

    <itemizedlist>

     <listitem>
      <para>
       Install PL/pgSQL by default (Bruce Momjian)
      </para>

      <para>
       The language can still be removed from a particular database if the
       administrator has security or performance concerns about making it
       available.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve handling of cases where PL/pgSQL variable names conflict with
       identifiers used in queries within a function
       (Tom Lane)
      </para>

      <para>
       The default behavior is now to throw an error when there is a conflict,
       so as to avoid surprising behaviors.  This can be modified, via the
       configuration parameter <link
       linkend="plpgsql-var-subst"><varname>plpgsql.variable_conflict</varname></link>
       or the per-function option <literal>#variable_conflict</literal>, to allow
       either the variable or the query-supplied column to be used.  In any
       case PL/pgSQL will no longer attempt to substitute variables in places
       where they would not be syntactically valid.
      </para>
     </listitem>

     <listitem>
      <para>
       Make PL/pgSQL use the main lexer, rather than its own version
       (Tom Lane)
      </para>

      <para>
       This ensures accurate tracking of the main system's behavior for details
       such as string escaping.  Some user-visible details, such as the set
       of keywords considered reserved in PL/pgSQL, have changed in
       consequence.
      </para>
     </listitem>

     <listitem>
      <para>
       Avoid throwing an unnecessary error for an invalid record reference
       (Tom Lane)
      </para>

      <para>
       An error is now thrown only if the reference is actually fetched,
       rather than whenever the enclosing expression is reached.  For
       example, many people have tried to do this in triggers:
<programlisting>
if TG_OP = 'INSERT' and NEW.col1 = ... then
</programlisting>
       This will now actually work as expected.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve PL/pgSQL's ability to handle row types with dropped columns
       (Pavel Stehule)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow input parameters to be assigned values within
       PL/pgSQL functions (Steve Prentice)
      </para>

      <para>
       Formerly, input parameters were treated as being declared
       <literal>CONST</literal>, so the function's code could not change their
       values.  This restriction has been removed to simplify
       porting of functions from other DBMSes that do not impose the
       equivalent restriction.  An input parameter now acts like a local
       variable initialized to the passed-in value.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve error location reporting in PL/pgSQL (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Add <replaceable>count</replaceable> and <literal>ALL</literal> options to <command>MOVE
       FORWARD</command>/<literal>BACKWARD</literal> in PL/pgSQL (Pavel Stehule)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow PL/pgSQL's <literal>WHERE CURRENT OF</literal> to use a cursor
       variable (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow PL/pgSQL's <command>OPEN <replaceable>cursor</replaceable> FOR EXECUTE</command> to
       use parameters (Pavel Stehule, Itagaki Takahiro)
      </para>

      <para>
       This is accomplished with a new <literal>USING</literal> clause.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link linkend="plperl">PL/Perl</link> Server-Side Language</title>

    <itemizedlist>

     <listitem>
      <para>
       Add new PL/Perl functions: <link
       linkend="plperl-utility-functions"><function>quote_literal()</function></link>,
       <function>quote_nullable()</function>, <function>quote_ident()</function>,
       <function>encode_bytea()</function>, <function>decode_bytea()</function>,
       <function>looks_like_number()</function>,
       <function>encode_array_literal()</function>,
       <function>encode_array_constructor()</function> (Tim Bunce)
      </para>
     </listitem>

     <listitem>
      <para>
       Add server parameter <link
       linkend="guc-plperl-on-init"><varname>plperl.on_init</varname></link> to
       specify a PL/Perl initialization function (Tim
       Bunce)
      </para>

      <para>
       <link
       linkend="guc-plperl-on-plperl-init"><varname>plperl.on_plperl_init</varname></link>
       and <link
       linkend="guc-plperl-on-plperl-init"><varname>plperl.on_plperlu_init</varname></link>
       are also available for initialization that is specific to the trusted
       or untrusted language respectively.
      </para>
     </listitem>

     <listitem>
      <para>
       Support <command>END</command> blocks in PL/Perl (Tim Bunce)
      </para>

      <para>
       <command>END</command> blocks do not currently allow database access.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <command>use strict</command> in PL/Perl (Tim Bunce)
      </para>

      <para>
       Perl <literal>strict</literal> checks can also be globally enabled with the
       new server parameter <link
       linkend="guc-plperl-use-strict"><varname>plperl.use_strict</varname></link>.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <command>require</command> in PL/Perl (Tim Bunce)
      </para>

      <para>
       This basically tests to see if the module is loaded, and if not,
       generates an error.  It will not allow loading of modules that
       the administrator has not preloaded via the initialization parameters.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <command>use feature</command> in PL/Perl if Perl version 5.10 or
       later is used (Tim Bunce)
      </para>
     </listitem>

     <listitem>
      <para>
       Verify that PL/Perl return values are valid in the server encoding
       (Andrew Dunstan)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link linkend="plpython">PL/Python</link> Server-Side Language</title>

    <itemizedlist>

     <listitem>
      <para>
       Add Unicode support in PL/Python (Peter Eisentraut)
      </para>

      <para>
       Strings are automatically converted from/to the server encoding as
       necessary.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve <type>bytea</type> support in PL/Python (Caleb Welton)
      </para>

      <para>
       <type>Bytea</type> values passed into PL/Python are now represented as
       binary, rather than the PostgreSQL <type>bytea</type> text format.
       <type>Bytea</type> values containing null bytes are now also output
       properly from PL/Python.  Passing of boolean, integer, and float
       values was also improved.
      </para>
     </listitem>

     <listitem>
      <para>
       Support <link linkend="plpython-arrays">arrays</link> as parameters and
       return values in PL/Python (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Improve mapping of SQL domains to Python types (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Add <application>Python</application> 3 support to PL/Python (Peter Eisentraut)
      </para>

      <para>
       The new server-side language is called <link
       linkend="plpython-python23"><literal>plpython3u</literal></link>.  This
       cannot be used in the same session with the
       <application>Python</application> 2 server-side language.
      </para>
     </listitem>

     <listitem>
      <para>
       Improve error location and exception reporting in PL/Python (Peter Eisentraut)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Client Applications</title>

   <itemizedlist>

    <listitem>
    <para>
     Add an <option>--analyze-only</option> option to <link
     linkend="app-vacuumdb"><command>vacuumdb</command></link>, to analyze without
     vacuuming (Bruce Momjian)
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title><link linkend="app-psql"><application>psql</application></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Add support for quoting/escaping the values of <application>psql</application>
       <link linkend="app-psql-variables">variables</link> as SQL strings or
       identifiers (Pavel Stehule, Robert Haas)
      </para>

      <para>
       For example, <literal>:'var'</literal> will produce the value of
       <literal>var</literal> quoted and properly escaped as a literal string, while
       <literal>:"var"</literal> will produce its value quoted and escaped as an
       identifier.
      </para>
     </listitem>

     <listitem>
      <para>
       Ignore a leading UTF-8-encoded Unicode byte-order marker in
       script files read by <application>psql</application> (Itagaki Takahiro)
      </para>

      <para>
       This is enabled when the client encoding is <acronym>UTF-8</acronym>.
       It improves compatibility with certain editors, mostly on Windows,
       that insist on inserting such markers.
      </para>
     </listitem>

     <listitem>
      <para>
       Fix <command>psql --file -</command> to properly honor <link
       linkend="r1-app-psql-3"><option>--single-transaction</option></link>
       (Bruce Momjian)
      </para>
     </listitem>

     <listitem>
      <para>
       Avoid overwriting of <application>psql</application>'s command-line history when
       two <application>psql</application> sessions are run concurrently (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Improve <application>psql</application>'s tab completion support (Itagaki
       Takahiro)
      </para>
     </listitem>

     <listitem>
      <para>
       Show <literal>\timing</literal> output when it is enabled, regardless of
       <quote>quiet</quote> mode (Peter Eisentraut)
      </para>
     </listitem>

    </itemizedlist>

    <sect5>
    <title><application>psql</application> Display</title>

     <itemizedlist>

      <listitem>
       <para>
        Improve display of wrapped columns in <application>psql</application> (Roger
        Leigh)
       </para>

       <para>
        This behavior is now the default.
        The previous formatting is available by using <command>\pset linestyle
        old-ascii</command>.
       </para>
      </listitem>

      <listitem>
       <para>
        Allow <application>psql</application> to use fancy Unicode line-drawing
        characters via <command>\pset linestyle unicode</command> (Roger Leigh)
       </para>
      </listitem>

     </itemizedlist>

    </sect5>

    <sect5>
     <title><application>psql</application> <link
     linkend="app-psql-meta-commands"><command>\d</command></link>
     Commands</title>

     <itemizedlist>

      <listitem>
       <para>
        Make <command>\d</command> show child tables that inherit from the specified
        parent (Damien Clochard)
       </para>

       <para>
        <command>\d</command> shows only the number of child tables, while
        <command>\d+</command> shows the names of all child tables.
       </para>
      </listitem>

      <listitem>
       <para>
        Show definitions of index columns in <command>\d index_name</command>
        (Khee Chin)
       </para>

       <para>
        The definition is useful for expression indexes.
       </para>
      </listitem>

      <listitem>
       <para>
        Show a view's defining query only in
        <command>\d+</command>, not in <command>\d</command> (Peter Eisentraut)
       </para>

       <para>
        Always including the query was deemed overly verbose.
       </para>
      </listitem>

     </itemizedlist>

    </sect5>
   </sect4>

   <sect4>
    <title><link linkend="app-pgdump"><application>pg_dump</application></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Make <application>pg_dump</application>/<application>pg_restore</application>
       <link linkend="pg-dump-options"><option>--clean</option></link>
       also remove large objects (Itagaki Takahiro)
      </para>
     </listitem>

     <listitem>
      <para>
       Fix <application>pg_dump</application> to properly dump large objects when
       <literal>standard_conforming_strings</literal> is enabled (Tom Lane)
      </para>

      <para>
       The previous coding could fail when dumping to an archive file
       and then generating script output from <application>pg_restore</application>.
      </para>
     </listitem>

     <listitem>
      <para>
       <application>pg_restore</application> now emits large-object data in hex format
       when generating script output (Tom Lane)
      </para>

      <para>
       This could cause compatibility problems if the script is then
       loaded into a pre-9.0 server.  To work around that, restore
       directly to the server, instead.
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <application>pg_dump</application> to dump comments attached to columns
       of composite types (Taro Minowa (Higepon))
      </para>
     </listitem>

     <listitem>
      <para>
       Make <application>pg_dump</application> <link
       linkend="pg-dump-options"><option>--verbose</option></link>
       output the <application>pg_dump</application> and server versions
       in text output mode (Jim Cox, Tom Lane)
      </para>

      <para>
       These were already provided in custom output mode.
      </para>
     </listitem>

     <listitem>
      <para>
       <application>pg_restore</application> now complains if any command-line arguments
       remain after the switches and optional file name (Tom Lane)
      </para>

      <para>
       Previously, it silently ignored any such arguments.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link
    linkend="app-pg-ctl"><application>pg_ctl</application></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Allow <application>pg_ctl</application> to be used safely to start the
       <application>postmaster</application> during a system reboot (Tom Lane)
      </para>

      <para>
       Previously, <application>pg_ctl</application>'s parent process could have been
       mistakenly identified as a running <application>postmaster</application> based on
       a stale <application>postmaster</application> lock file, resulting in a transient
       failure to start the database.
      </para>
     </listitem>

     <listitem>
      <para>
       Give <application>pg_ctl</application> the ability to initialize the database
       (by invoking <application>initdb</application>) (Zdenek Kotala)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title><application>Development Tools</application></title>

   <sect4>
    <title><link linkend="libpq"><application>libpq</application></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Add new <application>libpq</application> functions
       <link
       linkend="libpq-connect"><function>PQconnectdbParams()</function></link>
       and <function>PQconnectStartParams()</function> (Guillaume
       Lelarge)
      </para>

      <para>
       These functions are similar to <function>PQconnectdb()</function> and
       <function>PQconnectStart()</function> except that they accept a null-terminated
       array of connection options, rather than requiring all options to
       be provided in a single string.
      </para>
     </listitem>

     <listitem>
      <para>
       Add <application>libpq</application> functions <link
       linkend="libpq-exec-escape-string"><function>PQescapeLiteral()</function></link>
       and <function>PQescapeIdentifier()</function> (Robert Haas)
      </para>

      <para>
       These functions return appropriately quoted and escaped SQL string
       literals and identifiers. The caller is not required to pre-allocate
       the string result, as is required by <function>PQescapeStringConn()</function>.
      </para>
     </listitem>

     <listitem>
      <para>
       Add support for a per-user service file (<link
       linkend="libpq-pgservice"><filename>.pg_service.conf</filename></link>),
       which is checked before the site-wide service file
       (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Properly report an error if the specified <application>libpq</application> service
       cannot be found (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link linkend="libpq-keepalives">TCP keepalive settings</link>
       in libpq (Tollef Fog Heen, Fujii Masao, Robert Haas)
      </para>

      <para>
       Keepalive settings were already supported on the server end of
       TCP connections.
      </para>
     </listitem>

     <listitem>
      <para>
       Avoid extra system calls to block and unblock <literal>SIGPIPE</literal>
       in <application>libpq</application>, on platforms that offer alternative methods
       (Jeremy Kerr)
      </para>
     </listitem>

     <listitem>
      <para>
       When a <link linkend="libpq-pgpass"><filename>.pgpass</filename></link>-supplied
       password fails, mention where the password came from in the error
       message (Bruce Momjian)
      </para>
     </listitem>

     <listitem>
      <para>
       Load all SSL certificates given in the client certificate file
       (Tom Lane)
      </para>

      <para>
       This improves support for indirectly-signed SSL certificates.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title><link linkend="ecpg"><application>ecpg</application></link></title>

    <itemizedlist>

     <listitem>
      <para>
       Add <link linkend="ecpg-descriptors"><acronym>SQLDA</acronym></link>
       (SQL Descriptor Area) support to <application>ecpg</application>
       (Boszormenyi Zoltan)
      </para>
     </listitem>

     <listitem>
      <para>
       Add the <link linkend="ecpg-descriptors"><command>DESCRIBE</command>
       [ <literal>OUTPUT</literal> ]</link> statement to <application>ecpg</application>
       (Boszormenyi Zoltan)
      </para>
     </listitem>

     <listitem>
      <para>
       Add an <link linkend="ecpg-library">ECPGtransactionStatus</link>
       function to return the current transaction status (Bernd Helmle)
      </para>
     </listitem>

     <listitem>
      <para>
       Add the <literal>string</literal> data type in <application>ecpg</application>
       Informix-compatibility mode (Boszormenyi Zoltan)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <application>ecpg</application> to use <literal>new</literal> and <literal>old</literal>
       variable names without restriction (Michael Meskes)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow <application>ecpg</application> to use variable names in
       <function>free()</function> (Michael Meskes)
      </para>
     </listitem>

     <listitem>
      <para>
       Make <function>ecpg_dynamic_type()</function> return zero for non-SQL3 data
       types (Michael Meskes)
      </para>

      <para>
       Previously it returned the negative of the data type OID.
       This could be confused with valid type OIDs, however.
      </para>
     </listitem>

     <listitem>
      <para>
       Support <type>long long</type> types on platforms that already have 64-bit
       <type>long</type> (Michael Meskes)
      </para>
     </listitem>

     </itemizedlist>

     <sect5>
      <title><application>ecpg</application> Cursors</title>

      <itemizedlist>

      <listitem>
       <para>
        Add out-of-scope cursor support in <application>ecpg</application>'s native mode
        (Boszormenyi Zoltan)
       </para>

       <para>
        This allows <command>DECLARE</command> to use variables that are not in
        scope when <command>OPEN</command> is called. This facility already existed
        in <application>ecpg</application>'s Informix-compatibility mode.
       </para>
      </listitem>

      <listitem>
       <para>
        Allow dynamic cursor names in <application>ecpg</application> (Boszormenyi Zoltan)
       </para>
      </listitem>

      <listitem>
       <para>
        Allow <application>ecpg</application> to use noise words <literal>FROM</literal> and
        <literal>IN</literal> in <command>FETCH</command> and <command>MOVE</command> (Boszormenyi
        Zoltan)
       </para>
      </listitem>

     </itemizedlist>

    </sect5>

   </sect4>

  </sect3>

  <sect3>
   <title>Build Options</title>

   <itemizedlist>

    <listitem>
     <para>
      Enable client thread safety by default (Bruce Momjian)
     </para>

     <para>
      The thread-safety option can be disabled with <link
      linkend="configure"><literal>configure</literal></link>
      <option>--disable-thread-safety</option>.
     </para>
    </listitem>

    <listitem>
     <para>
      Add support for controlling the Linux out-of-memory killer
      (Alex Hunsaker, Tom Lane)
     </para>

     <para>
      Now that <filename>/proc/self/oom_adj</filename> allows disabling
      of the <productname>Linux</productname> out-of-memory (<acronym>OOM</acronym>)
      killer, it's recommendable to disable OOM kills for the postmaster.
      It may then be desirable to re-enable OOM kills for the postmaster's
      child processes.  The new compile-time option <link
      linkend="linux-memory-overcommit"><literal>LINUX_OOM_ADJ</literal></link>
      allows the killer to be reactivated for child processes.
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title>Makefiles</title>

    <itemizedlist>

     <listitem>
      <para>
       New <filename>Makefile</filename> targets <link
       linkend="build"><literal>world</literal></link>,
       <literal>install-world</literal>, and <literal>installcheck-world</literal>
       (Andrew Dunstan)
      </para>

      <para>
       These are similar to the existing <literal>all</literal>, <literal>install</literal>,
       and <literal>installcheck</literal> targets, but they also build the
       <acronym>HTML</acronym> documentation, build and test <filename>contrib</filename>,
       and test server-side languages and <application>ecpg</application>.
      </para>
     </listitem>

     <listitem>
      <para>
       Add data and documentation installation location control to <link
       linkend="xfunc-c-pgxs"><acronym>PGXS</acronym></link> Makefiles
       (Mark Cave-Ayland)
      </para>
     </listitem>

    <listitem>
     <para>
      Add Makefile rules to build the <productname>PostgreSQL</productname> documentation
      as a single <acronym>HTML</acronym> file or as a single plain-text file
      (Peter Eisentraut, Bruce Momjian)
     </para>
    </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Windows</title>

    <itemizedlist>

     <listitem>
      <para>
       Support compiling on <link
       linkend="install-windows">64-bit
       <productname>Windows</productname></link> and running in 64-bit
       mode (Tsutomu Yamada, Magnus Hagander)
      </para>

      <para>
       This allows for large shared memory sizes on <productname>Windows</productname>.
      </para>
     </listitem>

     <listitem>
      <para>
       Support server builds using <link
       linkend="install-windows-full"><productname>Visual Studio
       2008</productname></link> (Magnus Hagander)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Source Code</title>

   <itemizedlist>

    <listitem>
     <para>
      Distribute prebuilt documentation in a subdirectory tree, rather than
      as tar archive files inside the distribution tarball
      (Peter Eisentraut)
     </para>

     <para>
      For example, the prebuilt <acronym>HTML</acronym> documentation is now in
      <filename>doc/src/sgml/html/</filename>; the manual pages are packaged
      similarly.
     </para>
    </listitem>

    <listitem>
     <para>
      Make the server's lexer reentrant (Tom Lane)
     </para>

     <para>
      This was needed for use of the lexer by PL/pgSQL.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve speed of memory allocation (Tom Lane, Greg Stark)
     </para>
    </listitem>

    <listitem>
     <para>
      User-defined constraint triggers now have entries in
      <structname>pg_constraint</structname> as well as <structname>pg_trigger</structname>
      (Tom Lane)
     </para>

     <para>
      Because of this change,
      <structname>pg_constraint</structname>.<structfield>pgconstrname</structfield> is now
      redundant and has been removed.
     </para>
    </listitem>

    <listitem>
     <para>
      Add system catalog columns
      <structname>pg_constraint</structname>.<structfield>conindid</structfield> and
      <structname>pg_trigger</structname>.<structfield>tgconstrindid</structfield>
      to better document the use of indexes for constraint
      enforcement (Tom Lane)
     </para>
    </listitem>

    <listitem>
     <para>
      Allow multiple conditions to be communicated to backends using a single
      operating system signal (Fujii Masao)
     </para>

     <para>
      This allows new features to be added without a platform-specific
      constraint on the number of signal conditions.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve source code test coverage, including <filename>contrib</filename>, PL/Python,
      and PL/Perl (Peter Eisentraut, Andrew Dunstan)
     </para>
    </listitem>

    <listitem>
     <para>
      Remove the use of flat files for system table bootstrapping
      (Tom Lane, Alvaro Herrera)
     </para>

     <para>
      This improves performance when using many roles or
      databases, and eliminates some possible failure conditions.
     </para>
    </listitem>

    <listitem>
     <para>
      Automatically generate the initial contents of
      <structname>pg_attribute</structname> for <quote>bootstrapped</quote> catalogs
      (John Naylor)
     </para>

     <para>
      This greatly simplifies changes to these catalogs.
     </para>
    </listitem>

    <listitem>
     <para>
      Split the processing of
      <command>INSERT</command>/<command>UPDATE</command>/<command>DELETE</command> operations out
      of <filename>execMain.c</filename> (Marko Tiikkaja)
     </para>

     <para>
      Updates are now executed in a separate ModifyTable node.  This change is
      necessary infrastructure for future improvements.
     </para>
    </listitem>

    <listitem>
     <para>
      Simplify translation of <application>psql</application>'s SQL help text
      (Peter Eisentraut)
     </para>
    </listitem>

    <listitem>
     <para>
      Reduce the lengths of some file names so that all file paths in the
      distribution tarball are less than 100 characters (Tom Lane)
     </para>

     <para>
      Some decompression programs have problems with longer file paths.
     </para>
    </listitem>

    <listitem>
     <para>
      Add a new <link
      linkend="errcodes-table"><literal>ERRCODE_INVALID_PASSWORD</literal></link>
      <literal>SQLSTATE</literal> error code (Bruce Momjian)
     </para>
    </listitem>

    <listitem>
     <para>
      With authors' permissions, remove the few remaining personal source code
      copyright notices (Bruce Momjian)
     </para>

     <para>
      The personal copyright notices were insignificant but the community
      occasionally had to answer questions about them.
     </para>
    </listitem>

    <listitem>
     <para>
      Add new documentation <link linkend="non-durability">section</link>
      about running <productname>PostgreSQL</productname> in non-durable mode
      to improve performance (Bruce Momjian)
     </para>
    </listitem>

    <listitem>
     <para>
      Restructure the <acronym>HTML</acronym> documentation
      <filename>Makefile</filename> rules to make their dependency checks work
      correctly, avoiding unnecessary rebuilds (Peter Eisentraut)
     </para>
    </listitem>

    <listitem>
     <para>
      Use <productname>DocBook</productname> <acronym>XSL</acronym> stylesheets for man page
      building, rather than <productname>Docbook2X</productname> (Peter Eisentraut)
     </para>

     <para>
      This changes the set of tools needed to build the man pages.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve PL/Perl code structure (Tim Bunce)
     </para>
    </listitem>

    <listitem>
     <para>
      Improve error context reports in PL/Perl (Alexey Klyukin)
     </para>
    </listitem>

   </itemizedlist>

   <sect4>
    <title>New Build Requirements</title>

     <para>
      Note that these requirements do not apply when building from a
      distribution tarball, since tarballs include the files that these
      programs are used to build.
     </para>

    <itemizedlist>
     <listitem>
      <para>
       Require <application>Autoconf</application> 2.63 to build
       <application>configure</application> (Peter Eisentraut)
      </para>
     </listitem>

     <listitem>
      <para>
       Require <application>Flex</application> 2.5.31 or later to build
       from a <acronym>CVS</acronym> checkout (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Require <application>Perl</application> version 5.8 or later to build
       from a <acronym>CVS</acronym> checkout (John Naylor, Andrew Dunstan)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Portability</title>

    <itemizedlist>

     <listitem>
      <para>
       Use a more modern <acronym>API</acronym> for <application>Bonjour</application> (Tom Lane)
      </para>

      <para>
       Bonjour support now requires <productname>OS X</productname> 10.3 or later.
       The older API has been deprecated by Apple.
      </para>
     </listitem>

     <listitem>
      <para>
       Add spinlock support for the <productname>SuperH</productname>
       architecture (Nobuhiro Iwamatsu)
      </para>
     </listitem>

     <listitem>
      <para>
       Allow non-<application>GCC</application> compilers to use inline functions if
       they support them (Kurt Harriman)
      </para>
     </listitem>

     <listitem>
      <para>
       Remove support for platforms that don't have a working 64-bit
       integer data type (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Restructure use of <literal>LDFLAGS</literal> to be more consistent
       across platforms (Tom Lane)
      </para>

      <para>
       <literal>LDFLAGS</literal> is now used for linking both executables and shared
       libraries, and we add on <literal>LDFLAGS_EX</literal> when linking
       executables, or <literal>LDFLAGS_SL</literal> when linking shared libraries.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Server Programming</title>

    <itemizedlist>

     <listitem>
      <para>
       Make backend header files safe to include in <productname>C++</productname>
       (Kurt Harriman, Peter Eisentraut)
      </para>

      <para>
       These changes remove keyword conflicts that previously made
       <productname>C++</productname> usage difficult in backend code.  However, there
       are still other complexities when using <productname>C++</productname> for backend
       functions. <literal>extern "C" { }</literal> is still necessary in
       appropriate places, and memory management and error handling are
       still problematic.
      </para>
     </listitem>

     <listitem>
      <para>
       Add <link
       linkend="xaggr"><function>AggCheckCallContext()</function></link>
       for use in detecting if a <productname>C</productname> function is
       being called as an aggregate (Hitoshi Harada)
      </para>
     </listitem>

     <listitem>
      <para>
       Change calling convention for <function>SearchSysCache()</function> and related
       functions to avoid hard-wiring the maximum number of cache keys
       (Robert Haas)
      </para>

      <para>
       Existing calls will still work for the moment, but can be expected to
       break in 9.1 or later if not converted to the new style.
      </para>
     </listitem>

     <listitem>
      <para>
       Require calls of <function>fastgetattr()</function> and
       <function>heap_getattr()</function> backend macros to provide a non-NULL fourth
       argument (Robert Haas)
      </para>
     </listitem>

     <listitem>
      <para>
       Custom typanalyze functions should no longer rely on
       <structname>VacAttrStats</structname>.<structfield>attr</structfield> to determine the type
       of data they will be passed (Tom Lane)
      </para>

      <para>
       This was changed to allow collection of statistics on index columns
       for which the storage type is different from the underlying column
       data type.  There are new fields that tell the actual datatype being
       analyzed.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Server Hooks</title>

    <itemizedlist>

     <listitem>
      <para>
       Add parser hooks for processing ColumnRef and ParamRef nodes
       (Tom Lane)
      </para>
     </listitem>

     <listitem>
      <para>
       Add a ProcessUtility hook so loadable modules can control utility
       commands (Itagaki Takahiro)
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

   <sect4>
    <title>Binary Upgrade Support</title>

    <itemizedlist>

    <listitem>
     <para>
      Add <link linkend="pgupgrade"><filename>contrib/pg_upgrade</filename></link>
      to support in-place upgrades (Bruce Momjian)
     </para>

     <para>
      This avoids the requirement of dumping/reloading the database when
      upgrading to a new major release of PostgreSQL, thus reducing downtime
      by orders of magnitude. It supports upgrades to 9.0
      from PostgreSQL 8.3 and 8.4.
     </para>
    </listitem>

     <listitem>
      <para>
       Add support for preserving relation <link
       linkend="catalog-pg-class"><structname>relfilenode</structname></link> values
       during binary upgrades (Bruce Momjian)
      </para>
     </listitem>

     <listitem>
      <para>
       Add support for preserving <structname>pg_type</structname>
       and <structname>pg_enum</structname> OIDs during binary upgrades
       (Bruce Momjian)
      </para>
     </listitem>

     <listitem>
      <para>
       Move data files within tablespaces into
       <productname>PostgreSQL</productname>-version-specific subdirectories
       (Bruce Momjian)
      </para>

      <para>
       This simplifies binary upgrades.
      </para>
     </listitem>

    </itemizedlist>

   </sect4>

  </sect3>

  <sect3>
   <title>Contrib</title>

   <itemizedlist>

    <listitem>
     <para>
      Add multithreading option (<option>-j</option>) to <link
      linkend="pgbench"><filename>contrib/pgbench</filename></link>
      (Itagaki Takahiro)
     </para>

     <para>
      This allows multiple <acronym>CPU</acronym>s to be used by pgbench,
      reducing the risk of pgbench itself becoming the test bottleneck.
     </para>
    </listitem>

    <listitem>
     <para>
      Add <command>\shell</command> and <command>\setshell</command> meta
      commands to <link
      linkend="pgbench"><filename>contrib/pgbench</filename></link>
      (Michael Paquier)
     </para>
    </listitem>

    <listitem>
     <para>
      New features for <link
      linkend="dict-xsyn"><filename>contrib/dict_xsyn</filename></link>
      (Sergey Karpov)
     </para>

     <para>
      The new options are <literal>matchorig</literal>, <literal>matchsynonyms</literal>,
      and <literal>keepsynonyms</literal>.
     </para>
    </listitem>

    <listitem>
     <para>
      Add full text dictionary <link
      linkend="unaccent"><filename>contrib/unaccent</filename></link>
      (Teodor Sigaev)
     </para>

     <para>
      This filtering dictionary removes accents from letters, which
      makes full-text searches over multiple languages much easier.
     </para>
    </listitem>

    <listitem>
     <para>
      Add <link
      linkend="contrib-dblink-get-notify"><function>dblink_get_notify()</function></link>
      to <filename>contrib/dblink</filename> (Marcus Kempe)
     </para>

     <para>
      This allows asynchronous notifications in <productname>dblink</productname>.
     </para>
    </listitem>

    <listitem>
     <para>
      Improve <filename>contrib/dblink</filename>'s handling of dropped columns
      (Tom Lane)
     </para>

     <para>
      This affects <link
      linkend="contrib-dblink-build-sql-insert"><function>dblink_build_sql_insert()</function></link>
      and related functions.  These functions now number columns according
      to logical not physical column numbers.
     </para>
    </listitem>

    <listitem>
     <para>
      Greatly increase <link
      linkend="hstore"><filename>contrib/hstore</filename></link>'s data
      length limit, and add B-tree and hash support so <literal>GROUP
      BY</literal> and <literal>DISTINCT</literal> operations are possible on
      <type>hstore</type> columns (Andrew Gierth)
     </para>

     <para>
      New functions and operators were also added.  These improvements
      make <type>hstore</type> a full-function key-value store embedded in
      <productname>PostgreSQL</productname>.
     </para>
    </listitem>

    <listitem>
     <para>
      Add <link
      linkend="passwordcheck"><filename>contrib/passwordcheck</filename></link>
      to support site-specific password strength policies (Laurenz
      Albe)
     </para>

     <para>
      The source code of this module should be modified to implement
      site-specific password policies.
     </para>
    </listitem>

    <listitem>
     <para>
      Add <link
      linkend="pgarchivecleanup"><filename>contrib/pg_archivecleanup</filename></link>
      tool (Simon Riggs)
     </para>

     <para>
      This is designed to be used in the
      <literal>archive_cleanup_command</literal>
      server parameter, to remove no-longer-needed archive files.
     </para>
    </listitem>

    <listitem>
     <para>
      Add query text to <link
      linkend="auto-explain"><filename>contrib/auto_explain</filename></link>
      output (Andrew Dunstan)
     </para>
    </listitem>

    <listitem>
     <para>
      Add buffer access counters to <link
      linkend="pgstatstatements"><filename>contrib/pg_stat_statements</filename></link>
      (Itagaki Takahiro)
     </para>
    </listitem>

    <listitem>
     <para>
      Update <link
      linkend="server-start"><filename>contrib/start-scripts/linux</filename></link>
      to use <filename>/proc/self/oom_adj</filename> to disable the
      <link linkend="linux-memory-overcommit"><productname>Linux</productname>
      out-of-memory</link> (<acronym>OOM</acronym>) killer (Alex
      Hunsaker, Tom Lane)
     </para>
    </listitem>

   </itemizedlist>

  </sect3>
 </sect2>
</sect1>
