<?xml version="1.0" encoding="ISO-8859-15"?>
<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/create_operator.sgml,v 1.10 2005/07/15 06:14:31 guillaume Exp $
PostgreSQL documentation
-->
<!-- SAS 20060618 -->

<refentry id="sql-createoperator">
 <refmeta>
  <refentrytitle id="sql-createoperator-title">CREATE OPERATOR</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>CREATE OPERATOR</refname>
  <refpurpose>Définir un nouvel opérateur</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<synopsis>CREATE OPERATOR <replaceable>nom</replaceable> (
    PROCEDURE = <replaceable class="parameter">nomfonc</replaceable>
    [, LEFTARG = <replaceable class="parameter">typegauche</replaceable> ]
    [, RIGHTARG = <replaceable class="parameter">typedroit</replaceable> ]
    [, COMMUTATOR = <replaceable class="parameter">op_com</replaceable> ]
    [, NEGATOR = <replaceable class="parameter">op_neg</replaceable> ]
    [, RESTRICT = <replaceable class="parameter">proc_res</replaceable> ]
    [, JOIN = <replaceable class="parameter">proc_join</replaceable> ]
    [, HASHES ] [, MERGES ]
    [, SORT1 = <replaceable class="parameter">op_tri_gauche</replaceable> ]
    [, SORT2 = <replaceable class="parameter">op_tri_droit</replaceable> ]
    [, LTCMP = <replaceable class="parameter">op_inf</replaceable> ]
    [, GTCMP = <replaceable class="parameter">op_sup</replaceable> ]
)
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>
  <indexterm zone="sql-createoperator">
   <primary>CREATE OPERATOR</primary>
  </indexterm>

  <para>
   <command>CREATE OPERATOR</command> définit un nouvel opérateur,
   <replaceable class="parameter">nom</replaceable>. L'utilisateur qui définit
   un opérateur en devient propriétaire. Si un nom de schéma est donné,
   l'opérateur est créé dans le schéma spécifié. Sinon, il est créé dans
   le schéma courant.
  </para>

  <para>
   Le nom de l'opérateur est une séquence d'au plus <symbol>NAMEDATALEN</symbol>-1
   (63 par défaut) caractères parmi la liste suivante&nbsp;:
<literallayout>+ - * / &lt; &gt; = ~ ! @ # % ^ &amp; | ` ?
</literallayout>

   Il existe quelques restrictions dans le choix du nom&nbsp;:
   <itemizedlist>
    <listitem>
     <para>
     <literal>--</literal> et <literal>/*</literal> ne peuvent pas apparaître
     dans le nom d'un opérateur car ils sont pris pour le début
     d'un commentaire.
     </para>
    </listitem>
    <listitem>
     <para>
     Un nom d'opérateur multicaractères ne peut pas finir avec
     <literal>+</literal> ou <literal>-</literal> sauf si le nom contient
     l'un, au moins, de ces caractères&nbsp;:
<literallayout>~ ! @ # % ^ &amp; | ` ?
</literallayout>
     Par exemple, <literal>@-</literal> est un nom d'opérateur autorisé mais
     <literal>*-</literal> n'en est pas un. Cette restriction permet à
     <productname>PostgreSQL</productname> d'analyser les commandes compatibles
     SQL sans nécessiter d'espaces entre les lexèmes.
     </para>
    </listitem>
   </itemizedlist>
  </para>

  <para>
   L'opérateur <literal>!=</literal> est remplacé par
   <literal>&lt;&gt;</literal> à la saisie, ces deux noms sont donc toujours
   équivalents.
  </para>

  <para>
   Au moins un des deux <literal>LEFTARG</literal> et <literal>RIGHTARG</literal> doit être défini.
   Pour les opérateurs binaires, les deux doivent l'être. Pour les
   opérateurs unaires droits, seul <literal>LEFTARG</literal> doit l'être,
   <literal>RIGHTARG</literal> pour les opérateurs unaires gauches.
  </para>

  <para>
   La procédure <replaceable class="parameter">nomfonc</replaceable> doit avoir
   été précédemment définie par <command>CREATE FUNCTION</command> et
   doit accepter le bon nombre d'arguments (un ou deux) des types indiqués.
  </para>

  <para>
   Les autres clauses spécifient des clauses optionnelles d'optimisation
   d'opérateur. Leur signification est détaillée dans <xref linkend="xoper-optimization"/>.
  </para>
 </refsect1>

 <refsect1>
  <title>Paramètres</title>

    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">nom</replaceable></term>
      <listitem>
       <para>
	Le nom de l'opérateur à définir. Voir ci-dessus pour les caractères
	autorisés. Le nom peut être qualifié du nom du schéma, par
	exemple <literal>CREATE OPERATOR monschema.+ (...)</literal>. Dans le cas contraire,
	il est créé dans le schéma courant. Deux opérateurs dans le
	même schéma peuvent avoir le même nom s'ils opérent sur des types de
	données différents. On parle alors de <firstterm>surchargement</firstterm>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">nomfonc</replaceable></term>
      <listitem>
       <para>
	La fonction utilisée pour implanter cet opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">typegauche</replaceable></term>
      <listitem>
       <para>
	Le type de données de l'opérande gauche de l'opérateur, s'il existe.
	Cette option est omise pour un opérateur unaire gauche.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">typedroit</replaceable></term>
      <listitem>
       <para>
	Le type de données de l'opérande droit de l'opérateur, s'il existe.
	Cette option est omise pour un opérateur unaire droit.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">op_com</replaceable></term>
      <listitem>
       <para>
	Le commutateur de cet opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">op_neg</replaceable></term>
      <listitem>
       <para>
	La négation de cet opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">proc_res</replaceable></term>
      <listitem>
       <para>
	La fonction d'estimation de la sélectivité de restriction pour cet
	opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">proc_join</replaceable></term>
      <listitem>
       <para>
	La fonction d'estimation de la sélectivité de jointure pour cet
	opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>HASHES</literal></term>
      <listitem>
       <para>
        L'opérateur peut supporter une jointure de hachage.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><literal>MERGES</literal></term>
      <listitem>
       <para>
        L'opérateur peut supporter une jointure de fusion.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">op_tri_gauche</replaceable></term>
      <listitem>
       <para>
	Si l'opérateur supporte une jointure de fusion,
	cette clause spécifie l'opérateur inférieur de tri du type de données gauche de 
	l'opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">op_tri_droit</replaceable></term>
      <listitem>
       <para>
	Si l'opérateur supporte une jointure de fusion,
	cette clause spécifie l'opérateur inférieur de tri du type de données droite de
	l'opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">op_inf</replaceable></term>
      <listitem>
       <para>
	Si l'opérateur supporte une jointure de fusion,
	cette clause spécifie l'opérateur inférieur de comparaison des types de données
	en entrée de l'opérateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">op_sup</replaceable></term>
      <listitem>
       <para>
	Si l'opérateur supporte une jointure de fusion,
	cette clause spécifie l'opérateur supérieur de comparaison des types de données 
	en entrée de l'opérateur.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>

  <para>
   La syntaxe <literal>OPERATOR()</literal> est utilisée pour préciser un nom
   d'opérateur qualifié d'un schéma dans <replaceable class="parameter">op_com</replaceable>
   ou dans les autres arguments optionnels.
   Par exemple
<programlisting>COMMUTATOR = OPERATOR(mon_schema.===) ,
</programlisting>  
  </para>
 </refsect1>
  
 <refsect1>
  <title>Notes</title>

  <para>
   <xref linkend="xoper"/> fournit de plus amples informations.
  </para>

  <para>
   <xref linkend="sql-dropoperator" endterm="sql-dropoperator-title"/> 
   est utilisé pour supprimer les opérateurs utilisateur,
   <xref linkend="sql-alteroperator" endterm="sql-alteroperator-title"/> pour les modifier.
  </para>
 </refsect1>
  
 <refsect1>
  <title>Exemples</title>

  <para>
   La commande suivante définit un nouvel opérateur,
   <quote>area-equality</quote>, pour le type de données <type>box</type>&nbsp;:
<programlisting>CREATE OPERATOR === (
    LEFTARG = box,
    RIGHTARG = box,
    PROCEDURE = area_equal_procedure,
    COMMUTATOR = ===,
    NEGATOR = !==,
    RESTRICT = area_restriction_procedure,
    JOIN = area_join_procedure,
    HASHES,
    SORT1 = &lt;&lt;&lt;,
    SORT2 = &lt;&lt;&lt;
    -- Puisque les opérateurs de tri sont précisés, MERGES est assumé.
    -- LTCMP et GTCMP sont respectivement &lt; et &gt;.
);
</programlisting>  
  </para>
 </refsect1>
 
 <refsect1>
  <title>Compatibilité</title>

  <para>
   <command>CREATE OPERATOR</command> est une extension
   <productname>PostgreSQL</productname>. Il n'existe pas d'opérateurs utilisateur dans le standard SQL.
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="sql-alteroperator" endterm="sql-alteroperator-title"/></member>
   <member><xref linkend="sql-createopclass" endterm="sql-createopclass-title"/></member>
   <member><xref linkend="sql-dropoperator" endterm="sql-dropoperator-title"/></member>
  </simplelist>
 </refsect1>
</refentry>
